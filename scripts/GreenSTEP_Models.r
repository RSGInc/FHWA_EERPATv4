#this script contains the models that used to be stored in GreenSTEP_.RData

GreenSTEP_$IncomeModel = list(AK = "0.84385055103065 * PowPerCapInc + -1.52946317920024 * Age0to14 + 0.656111731551324 * Age15to19 + 8.00650651788122 * Age20to29 + 14.9847806706599 * Age30to54 + 12.5599165621676 * Age55to64 + 7.00251743779904 * Age65Plus" ,
AL = "0.744622371736599 * PowPerCapInc + -1.25349890814553 * Age0to14 + 0.104577729022258 * Age15to19 + 9.34998300565595 * Age20to29 + 16.3745507960663 * Age30to54 + 13.0445663555882 * Age55to64 + 7.91454737186559 * Age65Plus" ,
AR = "0.754445896994421 * PowPerCapInc + -1.00842002204005 * Age0to14 + 0.888809968875912 * Age15to19 + 9.6934231514414 * Age20to29 + 15.1109555631494 * Age30to54 + 12.5909774862202 * Age55to64 + 8.42133188730241 * Age65Plus" ,
AZ = "0.885006220851102 * PowPerCapInc + -1.94922388690309 * Age0to14 + -0.349135857054331 * Age15to19 + 6.51891464498153 * Age20to29 + 13.5289233661086 * Age30to54 + 10.8581271727811 * Age55to64 + 6.72577582901994 * Age65Plus" ,
CA = "0.901846302101867 * PowPerCapInc + -2.63940693151957 * Age0to14 + -1.63944719821257 * Age15to19 + 4.50383474848539 * Age20to29 + 12.1582415472594 * Age30to54 + 9.50385170670456 * Age55to64 + 3.88217725363173 * Age65Plus" ,
CO = "0.78044959064424 * PowPerCapInc + -1.32525277822597 * Age0to14 + 0.21380360824226 * Age15to19 + 8.2693048591379 * Age20to29 + 16.1911293978439 * Age30to54 + 13.030040291441 * Age55to64 + 7.55771860079991 * Age65Plus" ,
CT = "0.737181278298757 * PowPerCapInc + -1.2256904221985 * Age0to14 + -0.831777098204224 * Age15to19 + 8.60960590402445 * Age20to29 + 17.4351089779026 * Age30to54 + 14.4000197946637 * Age55to64 + 6.86219420359288 * Age65Plus" ,
DC = "0.788670325060403 * PowPerCapInc + -4.27895017127692 * Age0to14 + -3.82633490727309 * Age15to19 + 6.68145660485047 * Age20to29 + 13.8257854308761 * Age30to54 + 9.77560473287873 * Age55to64 + 4.22864799227649 * Age65Plus" ,
DE = "0.824672790880367 * PowPerCapInc + -1.14188820813372 * Age0to14 + 0.130530358048004 * Age15to19 + 8.21815486518243 * Age20to29 + 15.7202263047952 * Age30to54 + 12.4350140509161 * Age55to64 + 7.40687861292729 * Age65Plus" ,
FL = "0.806260886105096 * PowPerCapInc + -1.31271200462584 * Age0to14 + -0.289866525748436 * Age15to19 + 7.32610373469611 * Age20to29 + 14.1491866787841 * Age30to54 + 11.3295789145732 * Age55to64 + 7.67288909226388 * Age65Plus" ,
GA = "0.807243172858876 * PowPerCapInc + -1.64557255775096 * Age0to14 + -0.699767229731093 * Age15to19 + 8.14183545411898 * Age20to29 + 15.2465297206001 * Age30to54 + 11.2465699262994 * Age55to64 + 5.30187529879641 * Age65Plus" ,
HI = "0.867204339116791 * PowPerCapInc + -1.59680881003028 * Age0to14 + -0.23740700583719 * Age15to19 + 5.72456068426994 * Age20to29 + 13.3912501788763 * Age30to54 + 11.9214088981128 * Age55to64 + 6.97589613362471 * Age65Plus" ,
IA = "0.731772792891311 * PowPerCapInc + -0.317857516610592 * Age0to14 + 1.65052507797058 * Age15to19 + 10.5628894453995 * Age20to29 + 17.0482261022336 * Age30to54 + 14.9210218549932 * Age55to64 + 9.96280913154979 * Age65Plus" ,
ID = "0.778967770921228 * PowPerCapInc + -0.945786421273755 * Age0to14 + 1.13306753268214 * Age15to19 + 8.52909141188356 * Age20to29 + 15.7793231029535 * Age30to54 + 13.5763197170668 * Age55to64 + 8.16604883924723 * Age65Plus" ,
IL = "0.806227016321334 * PowPerCapInc + -1.49974760480278 * Age0to14 + -0.23641964669005 * Age15to19 + 7.83104525347887 * Age20to29 + 15.3367739691736 * Age30to54 + 11.8565434163151 * Age55to64 + 6.2056288729852 * Age65Plus" ,
IN = "0.763027057240902 * PowPerCapInc + -0.801556663271002 * Age0to14 + 1.25769489701244 * Age15to19 + 10.1966228790522 * Age20to29 + 17.0415357428528 * Age30to54 + 14.125328658483 * Age55to64 + 8.11517498481781 * Age65Plus" ,
KS = "0.72703537561518 * PowPerCapInc + -0.670867538111384 * Age0to14 + 1.09362059067034 * Age15to19 + 10.0352272195368 * Age20to29 + 17.1443862235785 * Age30to54 + 15.1724378298216 * Age55to64 + 9.83671510504628 * Age65Plus" ,
KY = "0.736472181236697 * PowPerCapInc + -0.794072291113109 * Age0to14 + 0.671877086015999 * Age15to19 + 10.1587325679047 * Age20to29 + 16.1855465173113 * Age30to54 + 12.5149713472129 * Age55to64 + 8.3387621649625 * Age65Plus" ,
LA = "0.772780366744718 * PowPerCapInc + -1.42012791043566 * Age0to14 + -0.743246147158651 * Age15to19 + 8.40073840298322 * Age20to29 + 15.2194018849132 * Age30to54 + 11.6378583991493 * Age55to64 + 7.19977525799888 * Age65Plus" ,
MA = "0.739969378914576 * PowPerCapInc + -1.45132300140113 * Age0to14 + -0.477845497385597 * Age15to19 + 9.80876815417409 * Age20to29 + 17.6520808610788 * Age30to54 + 13.7328050493814 * Age55to64 + 6.68339420934621 * Age65Plus" ,
MD = "0.828011909384292 * PowPerCapInc + -1.15864688157297 * Age0to14 + -0.307779444871662 * Age15to19 + 7.67729363428874 * Age20to29 + 15.4901385637725 * Age30to54 + 12.5560387387688 * Age55to64 + 6.53125482265356 * Age65Plus" ,
ME = "0.700112691671932 * PowPerCapInc + -0.426063791109277 * Age0to14 + 1.58383217669932 * Age15to19 + 10.5986479990739 * Age20to29 + 16.8662455215984 * Age30to54 + 14.2693524492997 * Age55to64 + 9.19306736438235 * Age65Plus" ,
MI = "0.783289462921321 * PowPerCapInc + -1.14357871127961 * Age0to14 + 0.685098790027314 * Age15to19 + 9.33252059706979 * Age20to29 + 16.5572970044143 * Age30to54 + 12.7733350219042 * Age55to64 + 7.00115162421559 * Age65Plus" ,
MN = "0.731861240890617 * PowPerCapInc + -0.838163827397944 * Age0to14 + 0.727452669588046 * Age15to19 + 10.7980249517403 * Age20to29 + 17.616544987758 * Age30to54 + 14.5136732581092 * Age55to64 + 8.28187415619384 * Age65Plus" ,
MO = "0.724466194244583 * PowPerCapInc + -0.888774674138814 * Age0to14 + 1.06383049788746 * Age15to19 + 10.2447677915341 * Age20to29 + 16.6379839864639 * Age30to54 + 13.6583802367444 * Age55to64 + 8.88876551273716 * Age65Plus" ,
MS = "0.774960923354844 * PowPerCapInc + -1.39381400365789 * Age0to14 + -0.854150648623472 * Age15to19 + 8.5824501299486 * Age20to29 + 14.9702278652796 * Age30to54 + 11.947584116904 * Age55to64 + 7.2413966110882 * Age65Plus" ,
MT = "0.740621251776539 * PowPerCapInc + -0.794893601781516 * Age0to14 + 0.201085293459516 * Age15to19 + 8.81584909677948 * Age20to29 + 15.7524924714155 * Age30to54 + 14.5846328100534 * Age55to64 + 10.7340402908687 * Age65Plus" ,
NC = "0.772141031442044 * PowPerCapInc + -1.24280672286086 * Age0to14 + -0.0380004543579855 * Age15to19 + 8.84072875710752 * Age20to29 + 15.8098335351941 * Age30to54 + 12.5544600889866 * Age55to64 + 7.07393040701191 * Age65Plus" ,
ND = "0.706851072242783 * PowPerCapInc + -0.70761722138606 * Age0to14 + 0.890960335295988 * Age15to19 + 10.4375605726105 * Age20to29 + 17.3904088890538 * Age30to54 + 14.5829157464417 * Age55to64 + 10.7060745601423 * Age65Plus" ,
NE = "0.723003276549993 * PowPerCapInc + -0.623367708663392 * Age0to14 + 0.692618571983632 * Age15to19 + 10.2197926290099 * Age20to29 + 16.6184365197469 * Age30to54 + 14.3466825436823 * Age55to64 + 9.65449348633888 * Age65Plus" ,
NH = "0.749469420814226 * PowPerCapInc + -0.402960061419119 * Age0to14 + 1.43421403056922 * Age15to19 + 10.4559180974837 * Age20to29 + 17.1163685058654 * Age30to54 + 14.5915320951536 * Age55to64 + 8.7560626450583 * Age65Plus" ,
NJ = "0.820157979703959 * PowPerCapInc + -1.5473321321262 * Age0to14 + -1.1880043782336 * Age15to19 + 7.18377333369669 * Age20to29 + 15.2322171837105 * Age30to54 + 12.1375795638359 * Age55to64 + 4.98703220179293 * Age65Plus" ,
NM = "0.845551362218969 * PowPerCapInc + -1.91441839149772 * Age0to14 + -0.346857438998682 * Age15to19 + 6.50057019427802 * Age20to29 + 13.8808753445773 * Age30to54 + 10.9999201614991 * Age55to64 + 7.43613158042422 * Age65Plus" ,
NV = "0.820256876458708 * PowPerCapInc + -1.45597233472219 * Age0to14 + 1.1529404161651 * Age15to19 + 7.85128689041328 * Age20to29 + 13.9201553254621 * Age30to54 + 11.5207890123915 * Age55to64 + 6.85473946998785 * Age65Plus" ,
NY = "0.775535637168819 * PowPerCapInc + -1.92390561103149 * Age0to14 + -1.06163088747341 * Age15to19 + 6.83946224148629 * Age20to29 + 14.7980406011285 * Age30to54 + 11.7793784022983 * Age55to64 + 6.00313682253099 * Age65Plus" ,
OH = "0.741641697964633 * PowPerCapInc + -0.829198014403611 * Age0to14 + 0.948507119304088 * Age15to19 + 9.95158761672467 * Age20to29 + 17.2105302383657 * Age30to54 + 14.0167762340343 * Age55to64 + 8.37800477722705 * Age65Plus" ,
OK = "0.746885809275778 * PowPerCapInc + -0.879097361012854 * Age0to14 + 1.23857798131835 * Age15to19 + 9.17350162227642 * Age20to29 + 15.3154470590031 * Age30to54 + 13.1302091930121 * Age55to64 + 9.21521980499323 * Age65Plus" ,
OR = "0.792759230952103 * PowPerCapInc + -1.18927011727805 * Age0to14 + 0.662615384125645 * Age15to19 + 7.89677373436281 * Age20to29 + 15.2321757054789 * Age30to54 + 12.7125920221975 * Age55to64 + 7.8851163821963 * Age65Plus" ,
PA = "0.74029791032794 * PowPerCapInc + -0.983616048462842 * Age0to14 + 0.270076870013365 * Age15to19 + 9.36696948725646 * Age20to29 + 16.438552355887 * Age30to54 + 12.7760122005382 * Age55to64 + 7.41898731558611 * Age65Plus" ,
RI = "0.748432747547536 * PowPerCapInc + -1.71359540841562 * Age0to14 + 0.169343880477251 * Age15to19 + 9.14383188821708 * Age20to29 + 18.0436885473643 * Age30to54 + 14.8870411085912 * Age55to64 + 7.52921645560106 * Age65Plus" ,
SC = "0.776523143470257 * PowPerCapInc + -1.19736560504053 * Age0to14 + -0.416941751100086 * Age15to19 + 9.16891618511163 * Age20to29 + 15.6226499005805 * Age30to54 + 12.848261864828 * Age55to64 + 7.85228339667249 * Age65Plus" ,
SD = "0.733388486448702 * PowPerCapInc + -0.933461939991128 * Age0to14 + 1.27802966194938 * Age15to19 + 9.60087460016906 * Age20to29 + 15.8567011318862 * Age30to54 + 13.4413265694954 * Age55to64 + 8.96799305372742 * Age65Plus" ,
TN = "0.737499059210941 * PowPerCapInc + -0.819094271858121 * Age0to14 + 0.657109965879956 * Age15to19 + 9.75350568527726 * Age20to29 + 15.8294632541918 * Age30to54 + 12.4913389418119 * Age55to64 + 7.61490756383161 * Age65Plus" ,
TX = "0.851793597938083 * PowPerCapInc + -2.10936009520188 * Age0to14 + -1.19768335473786 * Age15to19 + 6.27479234254126 * Age20to29 + 13.8048222539837 * Age30to54 + 10.1760207201254 * Age55to64 + 4.79108969279849 * Age65Plus" ,
UT = "0.868616552376766 * PowPerCapInc + -0.517127312467563 * Age0to14 + 1.55896041707393 * Age15to19 + 7.48052722746475 * Age20to29 + 14.9301881381421 * Age30to54 + 12.740190256305 * Age55to64 + 7.92874325083861 * Age65Plus" ,
VA = "0.803650608485871 * PowPerCapInc + -1.26167027227955 * Age0to14 + -0.290034665208355 * Age15to19 + 8.05222000918348 * Age20to29 + 15.486800119329 * Age30to54 + 12.4467725097009 * Age55to64 + 7.08262245147674 * Age65Plus" ,
VT = "0.743321355769821 * PowPerCapInc + -0.390158393993395 * Age0to14 + 1.78863615261983 * Age15to19 + 8.96810798765967 * Age20to29 + 16.6420576879056 * Age30to54 + 14.3876801634033 * Age55to64 + 8.76309081042609 * Age65Plus" ,
WA = "0.773931526830572 * PowPerCapInc + -1.52885413519803 * Age0to14 + 0.209745239760828 * Age15to19 + 8.11041179787285 * Age20to29 + 16.0930494275835 * Age30to54 + 13.4142329216353 * Age55to64 + 8.09916612012196 * Age65Plus" ,
WI = "0.765624135990694 * PowPerCapInc + -0.841186516236663 * Age0to14 + 1.14601996121834 * Age15to19 + 10.0925790464743 * Age20to29 + 16.9599878653484 * Age30to54 + 13.975078241946 * Age55to64 + 7.66265996577339 * Age65Plus" ,
WV = "0.724331139330307 * PowPerCapInc + -0.73716427307156 * Age0to14 + 0.751724962149871 * Age15to19 + 8.46007404718417 * Age20to29 + 15.2880138941854 * Age30to54 + 12.5947153997478 * Age55to64 + 9.34909180093426 * Age65Plus" ,
WY = "0.704398556415029 * PowPerCapInc + -0.970814114897191 * Age0to14 + 1.72514124316618 * Age15to19 + 9.2242497046129 * Age20to29 + 16.8841578164496 * Age30to54 + 14.8903057187112 * Age55to64 + 9.65562773845822 * Age65Plus")





GreenSTEP_$LtTruckModels_ <- list(Northeast = list(OwnModel = "-1.37606406210238 * Intercept + 4.39809437334355e-06 * Hhincttl + -0.166670758748738 * LogDen + -0.138883323472727 * Urban + 0.708291250278256 * Hhvehcnt + 0.440029051066346 * Hhsize + 1.58631601576859e-06 * Hhincttl * Hhsize + -3.89185375075911e-06 * Hhincttl * Hhvehcnt + -0.128571699851535 * Hhvehcnt * Hhsize"),
                                  West = list(OwnModel = "-0.786596031795022 * Intercept + 5.0096283625617e-06 * Hhincttl + -0.151743860056697 * LogDen + -0.19343908057384 * Urban + 0.600876902111923 * Hhvehcnt + 0.287299051164498 * Hhsize + 1.74355011513854e-06 * Hhincttl * Hhsize + -3.79266132566609e-06 * Hhincttl * Hhvehcnt + -0.0862684834097631 * Hhvehcnt * Hhsize"),
                                  South = list(OwnModel = "-0.72919168996282 * Intercept + 3.92471625648909e-06 * Hhincttl + -0.173361935414855 * LogDen + -0.226589730928886 * Urban + 0.652024758466486 * Hhvehcnt + 0.305250064931044 * Hhsize + 1.90595899125904e-06 * Hhincttl * Hhsize + -3.04412915566455e-06 * Hhincttl * Hhvehcnt + -0.115327158748208 * Hhvehcnt * Hhsize"),
                                  Midwest = list(OwnModel = "-1.30845884700488 * Intercept + 1.17881550991963e-05 * Hhincttl + -0.14842543306564 * LogDen + -0.271626298684106 * Urban + 0.549682733627673 * Hhvehcnt + 0.441091368638295 * Hhsize + 3.30641240971387e-07 * Hhincttl * Hhsize + -3.85536905777639e-06 * Hhincttl * Hhvehcnt + -0.102395396662014 * Hhvehcnt * Hhsize"))








GreenSTEP_$createHhByAge <- function (Prsn.Ap, HtProb.HtAp, TargetHhSizeDistribution = NULL, MaxIter = 100, Type = "mean") 
{
    if (!(Type %in% c("min", "mean"))) {
        stop("Valid values for Type are \"min\" and \"mean\"")
    }
    Ap <- colnames(HtProb.HtAp)
    Ht <- rownames(HtProb.HtAp)
    Prsn.HtAp <- sweep(HtProb.HtAp, 2, Prsn.Ap, "*")
    PrsnFactors_Ht.Ap <- lapply(strsplit(Ht, "-"), function(x) as.numeric(x))
    PrsnFactors.HtAp <- do.call(rbind, PrsnFactors_Ht.Ap)
    dimnames(PrsnFactors.HtAp) <- dimnames(Prsn.HtAp)
    rm(PrsnFactors_Ht.Ap)


    if (!is.null(TargetHhSizeDistribution )){
    
    #############################################
    #get an estimate for number of each type of household
    Hsld.HtAp <- Prsn.HtAp/PrsnFactors.HtAp
    Hsld.HtAp[is.na(Hsld.HtAp)] <- 0
    if (Type == "mean") {
        ResolveHh.HtAp <- t(apply(Hsld.HtAp, 1, function(x) {
            if (sum(x > 0) > 1) {
              x[x > 0] <- mean(x[x > 0])
            }
                x
        }))
    }
    if (Type == "min") {
        ResolveHh.HtAp <- t(apply(Hsld.HtAp, 1, function(x) {
            if (sum(x > 0) > 1) {
              x[x > 0] <- min(x[x > 0])
            }
            x
        }))
    }
    ResolveHh.Ht <- apply(ResolveHh.HtAp, 1, max)
    
    #adjust that estimate to match hh size distribution
    HhSize = apply(cbind(rowSums(PrsnFactors.HtAp), 7), 1, min)
    HhSizeDistribution = tapply(ResolveHh.Ht, HhSize, sum)

    TargetHhSizeDistribution =  unname(unlist(TargetHhSizeDistribution))

    HhSizeDistributionErrors = TargetHhSizeDistribution / HhSizeDistribution
    
    
    ResolveHh.Ht = ResolveHh.Ht * HhSizeDistributionErrors[HhSize]

    #generate a new Prsn.HtAp that matches the target size distribution
    Prsn.HtAp = sweep(PrsnFactors.HtAp, 1, ResolveHh.Ht, "*")

    }




    #proceed with the fitting process as usual
    





    MaxDiff. <- numeric(MaxIter)
    for (i in 1:MaxIter) {
        Hsld.HtAp <- Prsn.HtAp/PrsnFactors.HtAp
        Hsld.HtAp[is.na(Hsld.HtAp)] <- 0
        if (Type == "mean") {
            ResolveHh.HtAp <- t(apply(Hsld.HtAp, 1, function(x) {
                if (sum(x > 0) > 1) {
                  x[x > 0] <- mean(x[x > 0])
                }
                x
            }))
        }
        if (Type == "min") {
            ResolveHh.HtAp <- t(apply(Hsld.HtAp, 1, function(x) {
                if (sum(x > 0) > 1) {
                  x[x > 0] <- min(x[x > 0])
                }
                x
            }))
        }
        MaxHh.Ht <- apply(Hsld.HtAp, 1, max)
        ResolveHh.Ht <- apply(ResolveHh.HtAp, 1, max)
        Diff.Ht <- abs(MaxHh.Ht - ResolveHh.Ht)
        PropDiff.Ht <- Diff.Ht/ResolveHh.Ht
        if (all(PropDiff.Ht < 0.001)) 
            break
        MaxDiff.[i] <- max(PropDiff.Ht)
        ResolvePrsn.HtAp <- ResolveHh.HtAp * PrsnFactors.HtAp
        PrsnProb.HtAp <- sweep(ResolvePrsn.HtAp, 2, colSums(ResolvePrsn.HtAp), 
            "/")
        PrsnDiff.Ap <- Prsn.Ap - colSums(ResolvePrsn.HtAp)
        AddPrsn.HtAp <- sweep(PrsnProb.HtAp, 2, PrsnDiff.Ap, 
            "*")
        Prsn.HtAp <- ResolvePrsn.HtAp + AddPrsn.HtAp
    }
    Hsld.Ht <- round(apply(ResolveHh.HtAp, 1, max))
    Prsn.HtAp <- sweep(PrsnFactors.HtAp, 1, Hsld.Ht, "*")
    Hsld.Hh <- rep(names(Hsld.Ht), Hsld.Ht)
    Hsld_Hh.Ap <- strsplit(Hsld.Hh, "-")
    Hsld_Hh.Ap <- lapply(Hsld_Hh.Ap, function(x) as.numeric(x))
    Hsld.HhAp <- do.call(rbind, Hsld_Hh.Ap)
    colnames(Hsld.HhAp) <- Ap
    list(Hsld.HhAp[sample(1:nrow(Hsld.HhAp), nrow(Hsld.HhAp), 
        replace = FALSE), ], Hsld.Ht, Prsn.HtAp, i, MaxDiff.)
}


GreenSTEP_$predictDensityUrban <- function (ForecastDen, UbzDenModel_, UrbProp = NA) 
{
    harmonicMean <- function(Probs., Values.) {
        1/sum(Probs./Values.)
    }
    NormLogDenDist. <- rnorm(1e+06, mean = UbzDenModel_$Mean, 
        sd = UbzDenModel_$Sd)
    MaxVal <- UbzDenModel_$Mean + 4 * UbzDenModel_$Sd
    NormLogDenDist.[NormLogDenDist. > MaxVal] <- MaxVal
    DenDist. <- exp(NormLogDenDist. * log(ForecastDen))
    DenBreaks. <- seq(min(DenDist.), max(DenDist.), length = 40)
    DenCut. <- cut(DenDist., DenBreaks.)
    MidPoints. <- DenBreaks.[-length(DenBreaks.)] + diff(DenBreaks.)
    DenProbs. <- as.vector(table(DenCut.))/sum(table(DenCut.))
    AveDen <- harmonicMean(DenProbs., MidPoints.)
    DenAdj <- ForecastDen/AveDen
    MidPoints. <- MidPoints. * DenAdj
    Result_ <- list(DenProbs. = DenProbs., DenValues. = MidPoints., 
        DenBreaks. = DenBreaks.)
    Result_$UrbanProbs. <- 0
    UrbanData.. <- data.frame(list(Intercept = rep(1, length(MidPoints.)), 
        Htppopdn = MidPoints.))
    if (is.na(UrbProp)) {
        UrbanResults. <- eval(parse(text = UbzDenModel_$UrbanModel), 
            envir = UrbanData..)
        UrbanOdds. <- exp(UrbanResults.)
        UrbanProbs. <- UrbanOdds./(1 + UrbanOdds.)
        Result_$UrbanProbs. <- UrbanProbs.
        i <- 1
    }
    else {
        Adj <- 1
        PropDiff <- 1
        while (PropDiff > 0.01) {
            for (i in 1:100) {
                UrbanData..$Intercept <- UrbanData..$Intercept * 
                  Adj
                UrbanResults. <- eval(parse(text = UbzDenModel_$UrbanModel), 
                  envir = UrbanData..)
                UrbanOdds. <- exp(UrbanResults.)
                UrbanProbs. <- UrbanOdds./(1 + UrbanOdds.)
                AveProp <- sum(Result_$DenProbs. * UrbanProbs.)
                PropDiff <- abs(UrbProp - AveProp)/UrbProp
                if (PropDiff < 0.01) 
                  break
                Adj <- AveProp/UrbProp
            }
            if (UrbProp < 0.5) {
                UrbProp <- UrbProp + 0.05
            }
            else {
                UrbProp <- UrbProp - 0.05
            }
            Result_$UrbanProbs. <- UrbanProbs.
        }
    }
    Result_$Iter <- i
    Result_
}


GreenSTEP_$UbzDenModel_ <- structure(list(Mean = 1.02959315969978, Sd = 0.0811950184100488, 
    UrbanModel = "-3.16299556878164 * Intercept + 0.000280394107643305 * Htppopdn"), .Names = c("Mean", 
"Sd", "UrbanModel"))


GreenSTEP_$calcCountyPowPerCapInc <- function (PerCapInc.Yr, IncomeProp.Rg, CountyGroups.., FcstYear, 
    Pow = 0.4) 
{
    PerCapInc <- PerCapInc.Yr[FcstYear]
    PerCapInc.Rg <- PerCapInc * IncomeProp.Rg
    PerCapInc.Co <- PerCapInc.Rg[CountyGroups..$Region]
    names(PerCapInc.Co) <- rownames(CountyGroups..)
    PerCapInc.Co^Pow
}



GreenSTEP_$predictIncome <- function (Data.., Model) 
{
    Vars. <- unlist(strsplit(Model, " "))
    VarPos. <- grep("[[:alpha:]]", Vars.)
    Vars. <- Vars.[VarPos.]
    if (!all(Vars. %in% names(Data..))) {
        stop("Data does not have all variables for income model ")
    }
    if ("Intercept" %in% Vars.) 
        Intercept <- 1
    PowInc. <- eval(parse(text = Model), envir = Data..)
    PowInc. <- sapply(PowInc., function(x) rnorm(1, x, sd = 17))
    PowInc.[PowInc. < 0] <- 0
    Inc. <- PowInc.^(1/0.4)
    Inc.
}


GreenSTEP_$calcAdjAveDvmt <- function( Data.., Model_, Type, BudgetProp, AnnVmtInflator, TrnstnProp, VmtAdj) {
                # Calculate the household DVMT without budget considerations
                AveDvmt.Hh <- predictAveDvmt( Data.., Model_, Type )[,1]
                AveDvmt.Hh = AveDvmt.Hh * VmtAdj
                # Put in a small value for AveDvmt if 0 or less to avoid negative or infinite calcs
                AveDvmt.Hh[ AveDvmt.Hh <= 0 ] <- 1e-6
          Data..$AveDvmt <- AveDvmt.Hh
                # Calculate base and future average costs per mile
                BaseCostPerMi.Hh <- Data..$BaseCostPerMi
                FutrCostPerMi.Hh <- Data..$FutrCostPerMi
                # Calculate household budget
                Budget.Hh <- Data..$Hhincttl * BudgetProp / AnnVmtInflator
                # Adjust budget with insurance adjustment if that data is provided
                if( !is.null( Data..$InsBudgetAdj ) ) {
                        InsBudgetAdj.Hh <- Data..$InsBudgetAdj
                        Budget.Hh <- Budget.Hh - InsBudgetAdj.Hh
                }
                # Calculate the threshold budget cost per mile
                ThshldCostPerMi.Hh <- Budget.Hh / AveDvmt.Hh
                # Make sure that the base DVMT does not exceed the budget
                BaseExceedsBudget <- ThshldCostPerMi.Hh < BaseCostPerMi.Hh
                AveDvmt.Hh[ BaseExceedsBudget ] <- Budget.Hh[ BaseExceedsBudget ] /
                        BaseCostPerMi.Hh[ BaseExceedsBudget ]
                ThshldCostPerMi.Hh[ BaseExceedsBudget ] <- BaseCostPerMi.Hh[ BaseExceedsBudget ]
          # Calculate parameters for computing DVMT transitions in price function
          TrnstnPriceRange.Hh <- ( ThshldCostPerMi.Hh - BaseCostPerMi.Hh ) * TrnstnProp
          LwTrnstnCostPerMi.Hh <- ThshldCostPerMi.Hh - TrnstnPriceRange.Hh
          HiTrnstnCostPerMi.Hh <- ThshldCostPerMi.Hh + TrnstnPriceRange.Hh
          CostScale.Hh <- pi / TrnstnPriceRange.Hh
          TrnstnDvmtRange.Hh <- ( AveDvmt.Hh - Budget.Hh / HiTrnstnCostPerMi.Hh ) / 2
          DvmtScale.Hh <- TrnstnDvmtRange.Hh / ( cosh( 1.2 * pi ) - cosh( 0 ) )
          # Identify the portion of the curves that costs are in
          Below <- FutrCostPerMi.Hh < LwTrnstnCostPerMi.Hh
          LowTr <- FutrCostPerMi.Hh >= LwTrnstnCostPerMi.Hh &
               FutrCostPerMi.Hh <= ThshldCostPerMi.Hh
          HiTr <- FutrCostPerMi.Hh > ThshldCostPerMi.Hh &
               FutrCostPerMi.Hh <= HiTrnstnCostPerMi.Hh
          Above <- FutrCostPerMi.Hh > HiTrnstnCostPerMi.Hh
          # Calculate the adjusted DVMT
          AdjDvmt.Hh <- numeric( nrow( Data.. ) )
          AdjDvmt.Hh[Below] <- AveDvmt.Hh[Below]
          AdjDvmt.Hh[Above] <- Budget.Hh[Above] / FutrCostPerMi.Hh[Above]
          AdjDvmt.Hh[LowTr] <- AveDvmt.Hh[LowTr] +
               ( 1 - cosh( ( FutrCostPerMi.Hh[LowTr] - LwTrnstnCostPerMi.Hh[LowTr] )
               * CostScale.Hh[LowTr] ) ) * DvmtScale.Hh[LowTr]
          AdjDvmt.Hh[HiTr] <- Budget.Hh[HiTr] / FutrCostPerMi.Hh[HiTr] +
               ( 1 - cosh( ( HiTrnstnCostPerMi.Hh[HiTr] - FutrCostPerMi.Hh[HiTr] )
               * CostScale.Hh[HiTr] ) ) * DvmtScale.Hh[HiTr]
          # If future cost per mile equals base cost per mile use base DVMT
          AdjDvmt.Hh[ FutrCostPerMi.Hh == BaseCostPerMi.Hh ] <- 
               AveDvmt.Hh[ FutrCostPerMi.Hh == BaseCostPerMi.Hh ]
          # Return the results
          list( AdjDvmt=AdjDvmt.Hh, BaseDvmt=AveDvmt.Hh, Budget=Budget.Hh,
                        BelowTrnstn=Below, LowTrnstn=LowTr, HiTrnstn=HiTr, AboveTrnstn=Above )
        }


GreenSTEP_$DvmtLmModels_ <- structure(list(Metro = structure(list(Pow = 0.18, DvmtAveModel = "0.660504562616825 * Intercept + 0.106956541056828 * LogIncome + -3.23548520743229e-06 * Htppopdn + 0.0578926358455789 * Hhvehcnt + -0.589673669011858 * ZeroVeh + -0.000203158471342815 * Tranmilescap + 0.0336104651177119 * Fwylnmicap + 0.0853384716166491 * DrvAgePop + -0.0765890637729855 * Age65Plus + -0.0614548171064998 * Urban + -1.11486469433855e-07 * Htppopdn * Tranmilescap", 
    Dvmt95thModel = "7.66481796930243 * Intercept + 3.13350333735502 * DvmtAve + -0.00768410270123249 * DvmtAveSq + 1.81013529234528e-05 * DvmtAveCu", 
    DvmtMaxModel = "52.4671165369567 * Intercept + 5.4754526961656 * DvmtAve + -0.0143604092443574 * DvmtAveSq + 3.19380772272424e-05 * DvmtAveCu"), .Names = c("Pow", 
"DvmtAveModel", "Dvmt95thModel", "DvmtMaxModel")), NonMetro = structure(list(
    Pow = 0.15, DvmtAveModel = "0.790020691008347 * Intercept + 0.0744458013793282 * LogIncome + 0.0328476486101316 * Hhvehcnt + -0.469289326491721 * ZeroVeh + 0.0123563805895481 * DrvAgePop + 0.00894898473242198 * Age0to14 + 0.0285737889430425 * Age15to19 + -5.89152883846254e-06 * Htppopdn + 0.0900365431396122 * Age20to29 + 0.0814902927225515 * Age30to54 + 0.0742352376981689 * Age55to64 + 0.0235474713584818 * Age65Plus + -1.45690111204334e-06 * Htppopdn * Age20to29 + -2.79838436107302e-06 * Htppopdn * Age30to54 + -3.14684878405163e-06 * Htppopdn * Age55to64 + -2.6502367982952e-06 * Htppopdn * Age65Plus", 
    Dvmt95thModel = "15.6818809527709 * Intercept + 2.84293891502756 * DvmtAve + -0.00219633782515374 * DvmtAveSq + 1.66740698566764e-06 * DvmtAveCu", 
    DvmtMaxModel = "68.8860431050131 * Intercept + 5.45013788295559 * DvmtAve + -0.00591953635503705 * DvmtAveSq + 4.46731852104228e-06 * DvmtAveCu"), .Names = c("Pow", 
"DvmtAveModel", "Dvmt95thModel", "DvmtMaxModel"))), .Names = c("Metro", 
"NonMetro"))


GreenSTEP_$DvmtModels_ <- structure(list(Metro = structure(list(ZeroDvmtModel = "3.70028068908414 * Intercept + -0.522346942898594 * DrvAgePop + -0.486003168438612 * LogIncome + 2.98307851246692e-05 * Htppopdn + 0.319604018595033 * Age65Plus + 0.00836927944212165 * Tranmilescap + -0.361112977653081 * Hhvehcnt + 3.42658543013583 * ZeroVeh + 0.0108566688137728 * Tranmilescap * Urban", 
    DvmtModel = "0.780615284234592 * Census_rNortheast + 0.772807543415877 * Census_rMidwest + 0.797818442012681 * Census_rSouth + 0.794348645926677 * Census_rWest + -0.071844823747692 * Age65Plus + 0.0869001895299994 * LogIncome + -3.69254156546855e-06 * Htppopdn + 0.0338138673563972 * Fwylnmicap + -0.0517666999174648 * Urban + 0.0608735691367098 * Hhvehcnt + 0.0723175943930695 * DrvAgePop + -5.97953817413722e-08 * Htppopdn * Tranmilescap", 
    Error = 0.336967180361147, Pow = 0.18), .Names = c("ZeroDvmtModel", 
"DvmtModel", "Error", "Pow")), NonMetro = structure(list(ZeroDvmtModel = "4.86139081490458 * Intercept + -0.629874733961719 * DrvAgePop + -0.577160326095815 * LogIncome + 2.1090943954619e-05 * Htppopdn + -0.175240060688509 * Hhvehcnt + 3.43474312986824 * ZeroVeh + -0.107973387082199 * Age30to54 + 0.376995316944136 * Age65Plus", 
    DvmtModel = "0.923132097957721 * Census_rNortheast + 0.910742888132581 * Census_rMidwest + 0.953464642233542 * Census_rSouth + 0.896636929993 * Census_rWest + 0.0580143376212732 * LogIncome + 0.0342160848384195 * Hhvehcnt + -0.0491768184983172 * ZeroVeh + -5.49816176997205e-06 * Htppopdn + 0.0938741557781827 * Age20to29 + 0.0836579603746506 * Age30to54 + 0.0759829752474006 * Age55to64 + 0.0322978511996278 * Age65Plus + 0.00871555918650229 * Age0to14 + 0.0366728775098237 * Age15to19 + -1.81967653358348e-06 * Htppopdn * Age20to29 + -3.3620978327773e-06 * Htppopdn * Age30to54 + -3.4212139452572e-06 * Htppopdn * Age55to64 + -2.76320139340828e-06 * Htppopdn * Age65Plus", 
    Error = 0.264659304232787, Pow = 0.15), .Names = c("ZeroDvmtModel", 
"DvmtModel", "Error", "Pow"))), .Names = c("Metro", "NonMetro"
))


GreenSTEP_$predictAveDvmt <- function( Data.., Model_, Type ) {
		# Check if proper Type specified
		if( !( Type %in% c( "Metro", "NonMetro" ) ) ) {
			stop( "Type must be either 'Metro' or 'NonMetro'" )
		}
		# Extract model components for specified type
		DvmtAveModel <- Model_[[Type]]$DvmtAveModel
		DvmtMaxModel <- Model_[[Type]]$DvmtMaxModel
		Dvmt95thModel <- Model_[[Type]]$Dvmt95thModel
		Pow <- Model_[[Type]]$Pow
		# Make log income transform
		Data..$Hhincttl[ Data..$Hhincttl <= 0 ] <- 1
		Data..$LogIncome <- log( Data..$Hhincttl )
     	Data..$ZeroVeh <- as.numeric( Data..$Hhvehcnt < 1 )
     	Data..$DrvAgePop <- Data..$Hhsize - Data..$Age0to14
     	# Boost vehicle ownership by 0.05 for carshare households
     	Data..$Hhvehcnt[ Data..$Carshare == 1 ] <-
     	     Data..$Hhvehcnt[ Data..$Carshare == 1 ] + 0.05
		# Define an intercept variable
		Intercept <- 1
		# Apply the DVMT models
		PowDvmtAve. <- as.vector( eval( parse( text=DvmtAveModel ), envir=Data.. ) )
		PowDvmtAve.[ PowDvmtAve. < 0 ] <- 0
		DvmtAve. <- PowDvmtAve. ^ (1/Pow)
		Data..$DvmtAve <- DvmtAve.
		Data..$DvmtAveSq <- DvmtAve. ^ 2
		Data..$DvmtAveCu <- DvmtAve. ^ 3
		DvmtMax. <- as.vector( eval( parse( text=DvmtMaxModel ), envir=Data.. ) )
		Dvmt95th. <- as.vector( eval( parse( text=Dvmt95thModel ), envir=Data.. ) )
		# Return the result
		cbind( DvmtAve=DvmtAve., DvmtMax=DvmtMax., Dvmt95th=Dvmt95th. )
	}


GreenSTEP_$predictDvmt <- function( Data.., Model_, Type ) {
		# Check if proper Type specified
		if( !( Type %in% c( "Metro", "NonMetro" ) ) ) {
			stop( "Type must be either 'Metro' or 'NonMetro'" )
		}
		# Extract model components for specified type
		ZeroDvmtModel <- Model_[[Type]]$ZeroDvmtModel
		DvmtModel <- Model_[[Type]]$DvmtModel
		Error <- Model_[[Type]]$Error
		Pow <- Model_[[Type]]$Pow
		# Add the log of income
		Data..$Hhincttl[ Data..$Hhincttl <= 0 ] <- 1
		Data..$LogIncome <- log( Data..$Hhincttl )
		# Define an intercept if the model calls for it
		Intercept <- 1
		# Apply the DVMT model
		PowDvmt. <- as.vector( eval( parse( text=DvmtModel ), envir=Data.. ) )
		# Calculate the probability of zero DVMT
		ZeroDvmtOdds. <- as.vector( exp( eval( parse( text=ZeroDvmtModel ), envir=Data.. ) ) )
		ZeroDvmtProbs. <- ZeroDvmtOdds. / (1 + ZeroDvmtOdds.)
		# Define function to calculate average and 95th percentile DVMT for a household
		calcDvmt <- function( PowDvmt, ZeroDvmtProb, N ) {
		     # Create Num samples of DVMT estimate
			PowDvmt. <- rnorm( N, PowDvmt, sd=Error )
			PowDvmt.[ PowDvmt. < 0 ] <- 0
			Dvmt. <- PowDvmt. ^ ( 1 / Pow )
			Dvmt. <- trunc( Dvmt. )
			# Create Num samples for predicting zero DVMT
			ZeroDvmt. <- sample( c( 0, 1 ), N, replace=TRUE,
				prob=c( ZeroDvmtProb, 1 - ZeroDvmtProb ) )
			# Overall prediction is the product of DVMT estimate and zero DVMT prediction
			Dvmt. <- Dvmt. * ZeroDvmt.
			# Find the mean
			DvmtMean <- mean( Dvmt. )
			DvmtMax <- max( Dvmt. )
			# Find the 95th percentile value
			# This approach is much much faster than using quantile or sort
			for( i in 1:5) {
				Dvmt. <- Dvmt.[ -which.max(Dvmt.) ]
			}
			Dvmt95 <- max( Dvmt. )
			c( DvmtMean=DvmtMean, DvmtMax=DvmtMax, Dvmt95=Dvmt95 )

		}
		# Apply the function
		mapply( calcDvmt, PowDvmt., ZeroDvmtProbs., 100 )
	}


GreenSTEP_$predictMaxDvmt <- function( Data.., Model_, Type ) {
		# Check if proper Type specified
		if( !( Type %in% c( "Metro", "NonMetro" ) ) ) {
			stop( "Type must be either 'Metro' or 'NonMetro'" )
		}
		# Calculate variables needed by the model and not in Data..
		Data..$DvmtAve <- Data..$Dvmt
		Data..$DvmtAveSq <- Data..$DvmtAve ^ 2
		Data..$DvmtAveCu <- Data..$DvmtAve ^ 3
		# Extract model components for specified type
		DvmtMaxModel <- Model_[[Type]]$DvmtMaxModel
		Dvmt95thModel <- Model_[[Type]]$Dvmt95thModel
		# Define an intercept variable
		Intercept <- 1
		# Apply the DVMT models
		DvmtMax. <- as.vector( eval( parse( text=DvmtMaxModel ), envir=Data.. ) )
		Dvmt95th. <- as.vector( eval( parse( text=Dvmt95thModel ), envir=Data.. ) )
		# Return the result
		cbind( DvmtMax=DvmtMax., Dvmt95th=Dvmt95th. )
	}


GreenSTEP_$predictVehOwn <- function (Data.., Model_ = VehicleOwnModels_, Type, adjustments = NULL) 
{

    if (is.null(adjustments)){
        adj_Zero = 0
        adj_Lt1 = 0
        adj_Eq1 = 0
        adj_Gt1 = 0
    
    }
    else {
        adj_Zero = adjustments$adj_Zero
        adj_Lt1 = adjustments$adj_Lt1
        adj_Eq1 = adjustments$adj_Eq1
        adj_Gt1 = adjustments$adj_Gt1
    }





    a = Model_[]


    for (x in c("Metro", "NonMetro")){
        for (y in c("Drv1","Drv2","Drv3Plus")){
            b = a[[x]][["Models_"]][["ZeroVeh"]][[y]]
            b = paste(adj_Zero, "+", b)
            a[[x]][["Models_"]][["ZeroVeh"]][[y]] = b
            
            b = a[[x]][["Models_"]][["Lt1Veh"]][[y]]
            b = paste(adj_Lt1, "+", b)
            a[[x]][["Models_"]][["Lt1Veh"]][[y]] = b
            
            b = a[[x]][["Models_"]][["Eq1Veh"]][[y]]
            b = paste(adj_Eq1, "+", b)
            a[[x]][["Models_"]][["Eq1Veh"]][[y]] = b
            
            b = a[[x]][["Models_"]][["Gt1Veh"]][[y]]
            b = paste(adj_Gt1, "+", b)
            a[[x]][["Models_"]][["Gt1veh"]][[y]] = b
            

        }

    }

    Model_ = a




    Vc <- c("Zero", "Lt1", "Eq1", "Gt1")
    Dl <- c("Drv1", "Drv2", "Drv3Plus")
    if (!(Type %in% c("Metro", "NonMetro"))) {
        stop("Type must be either 'Metro' or 'NonMetro'")
    }
    ZeroVehModel <- Model_[[Type]]$Models_$ZeroVeh
    Lt1VehModel <- Model_[[Type]]$Models_$Lt1Veh
    Eq1VehModel <- Model_[[Type]]$Models_$Eq1Veh
    Gt1VehModel <- Model_[[Type]]$Models_$Gt1Veh
    VehProp_ <- Model_[[Type]]$VehProp_
    Intercept <- 1
    ZeroVehResults. <- numeric(nrow(Data..))
    for (dl in Dl) {
        ZeroVehResults.[Data..$DrvLevel == dl] <- eval(parse(text = ZeroVehModel[[dl]]), 
            envir = Data..[Data..$DrvLevel == dl, ])
    }
    ZeroVehOdds. <- exp(ZeroVehResults.)
    ZeroVehProbs. <- ZeroVehOdds./(1 + ZeroVehOdds.)
    Lt1VehResults. <- numeric(nrow(Data..))
    Lt1VehResults.[Data..$DrvLevel == "Drv1"] <- NA
    for (dl in c("Drv2", "Drv3Plus")) {
        Lt1VehResults.[Data..$DrvLevel == dl] <- eval(parse(text = Lt1VehModel[[dl]]), 
            envir = Data..[Data..$DrvLevel == dl, ])
    }
    Lt1VehOdds. <- exp(Lt1VehResults.)
    Lt1VehProbs. <- Lt1VehOdds./(1 + Lt1VehOdds.)
    Lt1VehProbs.[Data..$DrvLevel == "Drv1"] <- 0
    Eq1VehResults. <- numeric(nrow(Data..))
    for (dl in Dl) {
        Eq1VehResults.[Data..$DrvLevel == dl] <- eval(parse(text = Eq1VehModel[[dl]]), 
            envir = Data..[Data..$DrvLevel == dl, ])
    }
    Eq1VehOdds. <- exp(Eq1VehResults.)
    Eq1VehProbs. <- Eq1VehOdds./(1 + Eq1VehOdds.)
    Gt1VehResults. <- numeric(nrow(Data..))
    for (dl in Dl) {
        Gt1VehResults.[Data..$DrvLevel == dl] <- eval(parse(text = Gt1VehModel[[dl]]), 
            envir = Data..[Data..$DrvLevel == dl, ])
    }
    Gt1VehOdds. <- exp(Gt1VehResults.)
    Gt1VehProbs. <- Gt1VehOdds./(1 + Gt1VehOdds.)
    VehProbs.2d <- cbind(ZeroVehProbs., Lt1VehProbs., Eq1VehProbs., 
        Gt1VehProbs.)
    Data..$VehChoice <- Vc[apply(VehProbs.2d, 1, function(x) {
        sample(1:4, 1, replace = FALSE, prob = x)
    })]
    NumVeh. <- numeric(nrow(Data..))
    for (i in 1:nrow(Data..)) {
        DrvLevel <- Data..$DrvLevels[i]
        VehChoice <- Data..$VehChoice[i]
        DrvAgePop <- Data..$DrvAgePop[i]
        if (VehChoice == "Zero") 
            NumVeh.[i] <- 0
        if (VehChoice == "Eq1") 
            NumVeh.[i] <- DrvAgePop
        if (VehChoice == "Lt1") {
            VehProbs.NdNv <- VehProp_[[VehChoice]]
            if (as.character(DrvAgePop) %in% rownames(VehProbs.NdNv)) {
                VehProbs. <- VehProbs.NdNv[as.character(DrvAgePop), 
                  ]
                NumVeh.[i] <- as.numeric(sample(colnames(VehProbs.NdNv), 
                  1, prob = VehProbs.))
            }
            else {
                NumVeh.[i] <- round(DrvAgePop/2)
            }
        }
        if (VehChoice == "Gt1") {
            VehProbs.NdNv <- VehProp_[[VehChoice]]
            if (as.character(DrvAgePop) %in% rownames(VehProbs.NdNv)) {
                VehProbs. <- VehProbs.NdNv[as.character(DrvAgePop), 
                  ]
                NumVeh.[i] <- as.numeric(sample(colnames(VehProbs.NdNv), 
                  1, prob = VehProbs.))
            }
            else {
                NumVeh.[i] <- DrvAgePop + 1
            }
        }
    }
    VehRatio. <- NumVeh./Data..$DrvAgePop
    list(VehRatio = VehRatio., VehChoice = Data..$VehChoice, 
        NumVeh = NumVeh.)
}


GreenSTEP_$VehicleOwnModels_ <- structure(list(Metro = structure(list(Models_ = structure(list(
    ZeroVeh = structure(list(Drv1 = "-0.683066027512409 * Intercept + -0.000110405079404259 * Hhincttl + 0.000109523364706169 * Htppopdn + -0.0362183493862117 * Tranmilescap + 1.02639925083899 * Urban + 9.06402787257681e-10 * Hhincttl * Htppopdn + 9.50409353343535e-07 * Hhincttl * Tranmilescap + 1.97250624441449e-05 * Hhincttl * Urban + 9.62725737852278e-07 * Htppopdn * Tranmilescap + -5.50575031443288e-05 * Htppopdn * Urban + -0.000119303596393078 * Htppopdn * Fwylnmicap + 0.0576992095172837 * Tranmilescap * Fwylnmicap", 
        Drv2 = "-1.4293517976947 * Intercept + -6.79093838399447e-05 * Hhincttl + 1.41665886075373e-09 * Hhincttl * Htppopdn + -3.55383842559826e-05 * Hhincttl * OnlyElderly + 1.8466993140076e-06 * Htppopdn * Tranmilescap", 
        Drv3Plus = "-3.49217773065969 * Intercept + -4.90381809989654e-05 * Hhincttl + 9.71850941935639e-05 * Htppopdn + 7.30707905255008e-10 * Hhincttl * Htppopdn + 0.0755278977577806 * Tranmilescap * Fwylnmicap"), .Names = c("Drv1", 
    "Drv2", "Drv3Plus")), Lt1Veh = structure(list(Drv2 = "-0.262626375528877 * Intercept + -4.58681084909702e-05 * Hhincttl + 5.64785771813055e-05 * Htppopdn + 1.73603587364938 * OnlyElderly + 1.1917191888469e-09 * Hhincttl * Htppopdn + 3.34293693717104e-07 * Hhincttl * Tranmilescap + 9.3557681020969e-06 * Hhincttl * OnlyElderly + -1.42790321639082e-06 * Htppopdn * Tranmilescap + -4.75313220359081e-05 * Htppopdn * Urban + -2.71105219349876e-05 * Htppopdn * OnlyElderly + 0.0294466696415345 * Tranmilescap * Urban + -0.0128985388647686 * OnlyElderly * Tranmilescap + -1.3804854873109 * OnlyElderly * Fwylnmicap", 
        Drv3Plus = "0.933669750357049 * Intercept + -1.83215625824184e-05 * Hhincttl + 5.20539935712135 * OnlyElderly + 1.66132852613514e-07 * Hhincttl * Tranmilescap + 1.3111834256491e-05 * Hhincttl * Urban + -0.000120261225684946 * Hhincttl * OnlyElderly + -4.89311638774344e-05 * Urban * Htppopdn + 8.93280811716929e-05 * Htppopdn * Fwylnmicap + -0.689141713914993 * Urban * Fwylnmicap"), .Names = c("Drv2", 
    "Drv3Plus")), Eq1Veh = structure(list(Drv1 = "0.622159878280685 * Intercept + 0.0232811570547427 * Tranmilescap + 1.13264996954536e-09 * Hhincttl * Htppopdn + -2.76056054149383e-07 * Tranmilescap * Hhincttl + 7.20250709137754e-06 * Hhincttl * OnlyElderly + -1.66385909721084e-06 * Tranmilescap * Htppopdn + -4.53660587597949e-05 * Htppopdn * Urban + 4.08259184719694e-05 * Htppopdn * Fwylnmicap + -0.00775538966573374 * Tranmilescap * OnlyElderly", 
        Drv2 = "0.153082400390944 * Intercept + 5.78895700138807e-06 * Hhincttl + 4.02264718027797e-05 * Htppopdn + -0.381431776917538 * Urban + -0.554254682651229 * OnlyElderly + 2.40943544880577e-10 * Hhincttl * Htppopdn + 8.177337031634e-06 * Hhincttl * Urban + 7.11276258043345e-06 * Hhincttl * OnlyElderly + -1.79078088259691e-06 * Htppopdn * Tranmilescap + -4.94241128932145e-05 * Htppopdn * Urban", 
        Drv3Plus = "-1.27880272409382 * Intercept + 7.91127896877896e-06 * Hhincttl + -5.76306938765975e-05 * Htppopdn + 5.38360019771969e-10 * Hhincttl * Htppopdn + -0.020367512046482 * Tranmilescap * Urban"), .Names = c("Drv1", 
    "Drv2", "Drv3Plus")), Gt1Veh = structure(list(Drv1 = "-1.74721412860086 * Intercept + 1.60836795971674e-05 * Hhincttl + -5.67320500238617e-05 * Htppopdn + -1.02035843794378 * OnlyElderly + -1.18456725053079e-06 * Htppopdn * Tranmilescap + 4.53069297238042e-05 * Htppopdn * Urban + -0.945719667714273 * Urban * Fwylnmicap + 1.10732632310419 * OnlyElderly * Fwylnmicap", 
        Drv2 = "-1.96276543220691 * Intercept + 7.56898242720771e-06 * Hhincttl + 0.763451405045493 * Fwylnmicap + -0.664923337309273 * OnlyElderly + 5.78135381384015e-10 * Hhincttl * Htppopdn + -1.26532421138555e-06 * Htppopdn * Tranmilescap + 2.86474240245699e-05 * Htppopdn * Urban + -0.000155933456154834 * Fwylnmicap * Htppopdn + -0.0227377982023876 * Tranmilescap * Urban", 
        Drv3Plus = "-1.00067958301458 * Intercept + -0.000301228344551957 * Htppopdn + -0.0128522840241981 * Tranmilescap + 2.2049921814377e-09 * Htppopdn * Hhincttl"), .Names = c("Drv1", 
    "Drv2", "Drv3Plus"))), .Names = c("ZeroVeh", "Lt1Veh", "Eq1Veh", 
"Gt1Veh")), VehProp_ = structure(list(Lt1 = structure(c(1, 0.183231171232646, 
0.124204659891971, 0.0968199186490817, 0.0923076923076923, 0, 
0, 0, 0, 0, 0.816768828767354, 0.268025186569919, 0.201427562946113, 
0.131405436668595, 0.112268915155781, 0, 0, 0, 0, 0, 0.60777015353811, 
0.339206508651803, 0.263930806036069, 0.156849381935214, 0.117035892417711, 
0, 0, 0, 0, 0, 0.362546009753001, 0.390372785109627, 0.309075249080178, 
0.161650326594989, 0.120445326097649, 0, 0, 0, 0, 0, 0.121983279878017, 
0.421806453828827, 0.314736953748204, 0.165084054410155, 0.123004839084319, 
0, 0, 0, 0, 0, 0, 0.406576827239096, 0.318786313650796, 0.167661805368422, 
0, 0, 0, 0, 0, 0, 0, 0.3956843058414, 0.321826228848258, 0, 0, 
0, 0, 0, 0, 0, 0, 0.387507126699002, 0, 0, 0, 0, 0, 0, 0, 0, 
0), .Dim = c(9L, 9L), .Dimnames = list(c("2", "3", "4", "5", 
"6", "7", "8", "9", "10"), c("1", "2", "3", "4", "5", "6", "7", 
"8", "9"))), Gt1 = structure(c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0.775279374476894, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.162294426585783, 
0.757435731900694, 0, 0, 0, 0, 0, 0, 0, 0, 0.0526715872762945, 
0.171245802500569, 0.73965134103397, 0, 0, 0, 0, 0, 0, 0, 0.00588497942576533, 
0.0478372290032499, 0.180167454421341, 0.721925907238524, 0, 
0, 0, 0, 0, 0, 0.00386963223526253, 0.0181661325780782, 0.043018923730072, 
0.189059530155211, 0.704259137826435, 0, 0, 0, 0, 0, 0, 0.00531510401740887, 
0.0304065048575673, 0.0382165916307609, 0.197922176530922, 0.686650742043952, 
0, 0, 0, 0, 0, 0, 0.00675577595704963, 0.0426062990533675, 0.0334301534077033, 
0.206755539406928, 0.669100431055544, 0, 0, 0, 0, 0, 0, 0.00819167192213667, 
0.0547657166123054, 0.0286595302873082, 0.215559763679397, 0.6516079179281, 
0, 0, 0, 0, 0, 0, 0.00962281562263432, 0.0668849576499869, 0.0239046440156852, 
0.224334993290133, 0.634172917615301, 0, 0, 0, 0, 0, 0, 0.0110492306118244, 
0.0789642209617758, 0.0191654168543661, 0.233081371234423, 0.616795146942133, 
0, 0, 0, 0, 0, 0, 0.0124709402875985, 0.0910037040336635, 0.0144417715760678, 
0.241799039568799, 0, 0, 0, 0, 0, 0, 0, 0.013887967893737, 0.103003603053032, 
0.00973363146049758, 0, 0, 0, 0, 0, 0, 0, 0, 0.0153003365211762, 
0.114964112919308, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0167080691092622
), .Dim = c(10L, 15L), .Dimnames = list(c("1", "2", "3", "4", 
"5", "6", "7", "8", "9", "10"), c("1", "2", "3", "4", "5", "6", 
"7", "8", "9", "10", "11", "12", "13", "14", "15")))), .Names = c("Lt1", 
"Gt1"))), .Names = c("Models_", "VehProp_")), NonMetro = structure(list(
    Models_ = structure(list(ZeroVeh = structure(list(Drv1 = "-0.764715628588422 * Intercept + -9.48827446956255e-05 * Hhincttl + 5.58814902852511e-05 * Htppopdn + 1.55132601403919e-09 * Hhincttl * Htppopdn + 3.4451381859651e-05 * Htppopdn * OnlyElderly", 
        Drv2 = "-1.97205206585201 * Intercept + -8.50026389808778e-05 * Hhincttl + 9.49295735533233e-05 * Htppopdn + -0.750964480544973 * OnlyElderly + 6.90609260578997e-05 * Htppopdn * OnlyElderly", 
        Drv3Plus = "-3.18298947122106 * Intercept + -4.99724157628643e-05 * Hhincttl + 0.000133417162883283 * Htppopdn"), .Names = c("Drv1", 
    "Drv2", "Drv3Plus")), Lt1Veh = structure(list(Drv2 = "-0.413852820133151 * Intercept + -3.93168014848633e-05 * Hhincttl + 4.70561991697599e-05 * Htppopdn + 0.303576772835546 * OnlyElderly + 9.67749108418644e-10 * Hhincttl * Htppopdn + 1.53896829737995e-05 * Hhincttl * OnlyElderly", 
        Drv3Plus = "0.481480595107626 * Intercept + -1.26210114521176e-05 * Hhincttl + 9.04571259805652e-05 * Htppopdn + 1.8315332036188 * OnlyElderly"), .Names = c("Drv2", 
    "Drv3Plus")), Eq1Veh = structure(list(Drv1 = "0.97339495471904 * Intercept + -9.71792328180977e-06 * Hhincttl + -2.84379049251932e-05 * Htppopdn + 0.254612141830117 * OnlyElderly + 1.49373110013838e-09 * Hhincttl * Htppopdn + 6.46030086496407e-06 * Hhincttl * OnlyElderly + -2.75839770071071e-05 * Htppopdn * OnlyElderly", 
        Drv2 = "0.244148864158161 * Intercept + 2.21438456787939e-06 * Hhincttl + -5.87127032906745e-05 * Htppopdn + -0.362435899095522 * OnlyElderly + 1.28716650265866e-09 * Hhincttl * Htppopdn + 7.83539837773637e-06 * Hhincttl * OnlyElderly + -5.57742722741945e-05 * Htppopdn * OnlyElderly", 
        Drv3Plus = "-1.08784722177374 * Intercept + 7.31474110901786e-06 * Hhincttl + -5.23190355127079e-05 * Htppopdn"), .Names = c("Drv1", 
    "Drv2", "Drv3Plus")), Gt1Veh = structure(list(Drv1 = "-1.50974586088385 * Intercept + 1.97797131824946e-05 * Hhincttl + -0.000101101429017305 * Htppopdn + -0.502532799087163 * OnlyElderly + -8.9312428414856e-05 * Htppopdn * OnlyElderly", 
        Drv2 = "-1.2918177391397 * Intercept + 9.12997143307265e-06 * Hhincttl + -0.000127456736295507 * Htppopdn + -0.588810459958171 * OnlyElderly + -6.49054938175107e-05 * Htppopdn * OnlyElderly", 
        Drv3Plus = "-1.89372144360687 * Intercept + 1.03322804417105e-05 * Hhincttl + -0.000128048150374047 * Htppopdn"), .Names = c("Drv1", 
    "Drv2", "Drv3Plus"))), .Names = c("ZeroVeh", "Lt1Veh", "Eq1Veh", 
    "Gt1Veh")), VehProp_ = structure(list(Lt1 = structure(c(1, 
    0.169463329807354, 0.136026313325218, 0.0397260273972603, 
    0.04, 0, 0, 0, 0, 0, 0.830536670192646, 0.25632815909558, 
    0.23388089157186, 0.056, 0.0508822538919933, 0, 0, 0, 0, 
    0, 0.607645527579202, 0.341122749523181, 0.323977401129943, 
    0.0699630991014907, 0.0529203167691155, 0, 0, 0, 0, 0, 0.385270331507699, 
    0.416610169491526, 0.400994203209199, 0.0719716308059971, 
    0.0543722178447695, 0, 0, 0, 0, 0, 0.163412429378531, 0.478160443797317, 
    0.410114515870215, 0.0734024940904388, 0.0554590410740276, 
    0, 0, 0, 0, 0, 0, 0.464993536554673, 0.416611759851974, 0.0744735694422657, 
    0, 0, 0, 0, 0, 0, 0, 0.455613528212817, 0.421475283823367, 
    0, 0, 0, 0, 0, 0, 0, 0, 0.44859210566034, 0, 0, 0, 0, 0, 
    0, 0, 0, 0), .Dim = c(9L, 9L), .Dimnames = list(c("2", "3", 
    "4", "5", "6", "7", "8", "9", "10"), c("1", "2", "3", "4", 
    "5", "6", "7", "8", "9"))), Gt1 = structure(c(0, 0, 0, 0, 
    0, 0, 0, 0, 0, 0, 0.730629429069246, 0, 0, 0, 0, 0, 0, 0, 
    0, 0, 0.193994160268793, 0.705375095310092, 0, 0, 0, 0, 0, 
    0, 0, 0, 0.0469904608324791, 0.197029043896726, 0.679876148764629, 
    0, 0, 0, 0, 0, 0, 0, 0.0182395856002976, 0.0664183873084748, 
    0.200093323324502, 0.65412901816813, 0, 0, 0, 0, 0, 0, 0.0101463642291842, 
    0.0212350671941034, 0.0860344921491355, 0.20318742772095, 
    0.628130062396871, 0, 0, 0, 0, 0, 0, 0.00994240629060395, 
    0.0242595629407269, 0.105841522695539, 0.20631179465005, 
    0.601875568751561, 0, 0, 0, 0, 0, 0, 0.00973647282100704, 
    0.0273134964370786, 0.125842280030647, 0.209466870277216, 
    0.575361751189902, 0, 0, 0, 0, 0, 0, 0.0095285349783025, 
    0.0303972995662246, 0.146039620299847, 0.212653109581696, 
    0.548584748506527, 0, 0, 0, 0, 0, 0, 0.00931856335620721, 
    0.0335114127009934, 0.166436456070625, 0.215870976575294, 
    0.521540622458452, 0, 0, 0, 0, 0, 0, 0.00910652797038258, 
    0.0366562849136165, 0.187035757732724, 0.219120944527639, 
    0.494225355834165, 0, 0, 0, 0, 0, 0, 0.00889239824416048, 
    0.0398323741916108, 0.207840554940217, 0.222403496198225, 
    0, 0, 0, 0, 0, 0, 0, 0.00867614299384409, 0.0430401476601231, 
    0.22885393809694, 0, 0, 0, 0, 0, 0, 0, 0, 0.0084577304135688, 
    0.0462800818109613, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.00823712805970783
    ), .Dim = c(10L, 15L), .Dimnames = list(c("1", "2", "3", 
    "4", "5", "6", "7", "8", "9", "10"), c("1", "2", "3", "4", 
    "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15"
    )))), .Names = c("Lt1", "Gt1"))), .Names = c("Models_", "VehProp_"
))), .Names = c("Metro", "NonMetro"))


GreenSTEP_$AveSovPropModels_ <- structure(list(Model = structure(list(LE2 = "0.326170907971722 * Intercept + -1.33305505808708e-06 * Hhincttl + 0.00326704167535862 * LogDen + -0.123620478787125 * LogSize + 0.026642116605128 * Urban + -0.0735246294877839 * LogDvmt + 3.69069952560298e-07 * Hhincttl * LogDvmt + -0.00326868505648899 * LogDen * LogDvmt + 0.0304526693693143 * LogSize * LogDvmt + -0.00315542301206082 * Urban * LogDvmt + 3.83571473288209e-08 * Hhincttl * LogDen + -2.82107352065357e-07 * Hhincttl * LogSize + 2.49300087749349e-07 * Hhincttl * Urban + 0.00535688837745241 * LogDen * LogSize + -0.00377080698492403 * LogDen * Urban", 
    LE5 = "0.532252472049264 * Intercept + -1.23670628135353e-06 * Hhincttl + 0.0188875695810522 * LogDen + -0.263955141819273 * LogSize + 0.0907208574761862 * Urban + -0.122649422278178 * LogDvmt + 3.9570249280936e-07 * Hhincttl * LogDvmt + -0.00727472865915005 * LogDen * LogDvmt + 0.0646056578444759 * LogSize * LogDvmt + 3.87215930886512e-08 * Hhincttl * LogDen + -3.93505401596772e-07 * Hhincttl * LogSize + 3.12727000103352e-07 * Hhincttl * Urban + 0.00735476421267102 * LogDen * LogSize + -0.0136350861371015 * LogDen * Urban", 
    LE10 = "0.77605200234974 * Intercept + -1.84587381450953e-07 * Hhincttl + 0.0335277829641738 * LogDen + -0.359897698754443 * LogSize + 0.321840330969254 * Urban + -0.17812167893145 * LogDvmt + 1.57163761721644e-07 * Hhincttl * LogDvmt + -0.00830502568372011 * LogDen * LogDvmt + 0.0863541109550972 * LogSize * LogDvmt + 0.00431215708887099 * Urban * LogDvmt + 1.60900607300984e-08 * Hhincttl * LogDen + -2.20849169214639e-07 * Hhincttl * LogSize + 3.87593230220396e-07 * Hhincttl * Urban + 0.00427195050266275 * LogDen * LogSize + -0.0438427155807552 * LogDen * Urban + 0.0048449000948348 * LogSize * Urban", 
    LE15 = "0.935448461684681 * Intercept + 6.98444075570737e-07 * Hhincttl + 0.0277175534530836 * LogDen + -0.367109210237506 * LogSize + 0.336017409288388 * Urban + -0.208543352658925 * LogDvmt + -6.55559764258961e-08 * Hhincttl * LogDvmt + -0.00514318458711068 * LogDen * LogDvmt + 0.0860504110501991 * LogSize * LogDvmt + 0.0159779003664473 * Urban * LogDvmt + 2.21958770262785e-07 * Hhincttl * Urban + -0.0504266989956829 * LogDen * Urban + 0.0180420966138145 * LogSize * Urban", 
    LE20 = "1.04124594090367 * Intercept + 2.20279893128968e-06 * Hhincttl + 0.0181525327580556 * LogDen + -0.375424607263415 * LogSize + 0.350849805949904 * Urban + -0.224012567141425 * LogDvmt + -3.76893828260414e-07 * Hhincttl * LogDvmt + -0.000973352068611953 * LogDen * LogDvmt + 0.0833889911249642 * LogSize * LogDvmt + 0.0162279484042901 * Urban * LogDvmt + -5.42542537309519e-08 * Hhincttl * LogDen + 2.06809032673347e-07 * Hhincttl * LogSize + 1.17885437890983e-07 * Hhincttl * Urban + -0.00266816171329545 * LogDen * LogSize + -0.0507096336896627 * LogDen * Urban + 0.0108363121633994 * LogSize * Urban"), .Names = c("LE2", 
"LE5", "LE10", "LE15", "LE20")), Parm = structure(list(LE2 = c(7.4, 
0.5), LE5 = c(5.9, 0.47), LE10 = c(5.5, 0.475), LE15 = c(5.2, 
0.49), LE20 = c(5, 0.5)), .Names = c("LE2", "LE5", "LE10", "LE15", 
"LE20"))), .Names = c("Model", "Parm"))


GreenSTEP_$calcAveSovProp <- function( Data.., AveSovPropModels_, Threshold ) {
		
		# Check that Threshold argument is in range
		#------------------------------------------
		if( Threshold < 2 | Threshold > 20 ) {
			stop( "Threshold must be between 2 and 20 miles" )
		}
		
		# Define function to apply logistic transform to data
		#----------------------------------------------------
		logistic <- function( Data., A, B ) {
			Data. <- 1 / ( 1 + exp( -A * ( Data. - B ) ) ) - ( 0.5 - B )
		}

		# No interpolation if threshold is 5, 10, 15, or 20
		#--------------------------------------------------
		
		if( Threshold %in% c( 2, 5, 10, 15, 20 ) ) {
			Intercept <- 1
			ListElementName <- paste( "LE", Threshold, sep="" )
			SovPropModel <- AveSovPropModels_$Model[[ ListElementName ]]
			SovProp. <- as.vector( eval( parse( text=SovPropModel ), envir=Data.. ) )
			Parm1 <- AveSovPropModels_$Parm[[ ListElementName ]][1]
			Parm2 <- AveSovPropModels_$Parm[[ ListElementName ]][2]
			SovProp. <- logistic( SovProp., Parm1, Parm2 )
		}
		
		# Interpolate if threshold is not 5, 10, 15 or 20
		#------------------------------------------------
		
		if( !( Threshold %in% c( 2, 5, 10, 15, 20 ) ) ) {
		
			# Identify the levels above and below the threshold range
			Thresholds. <- c( 2, 5, 10, 15, 20 )
			ThresholdDiff. <- Thresholds. - Threshold
			LowVals. <- ThresholdDiff.[ ThresholdDiff. < 0 ]
			LowerBnd <- Thresholds.[ which( ThresholdDiff. == max( LowVals. ) ) ]
			HighVals. <- ThresholdDiff.[ ThresholdDiff. > 0 ]
			HigherBnd <- Thresholds.[ which( ThresholdDiff. == min( HighVals. ) ) ]
		
			# Predict values for lower bound
			Intercept <- 1
			ListElementName <- paste( "LE", LowerBnd, sep="" )
			SovPropModel <- AveSovPropModels_$Model[[ ListElementName ]]
			LowSovProp. <- as.vector( eval( parse( text=SovPropModel ), envir=Data.. ) )
			Parm1 <- AveSovPropModels_$Parm[[ ListElementName ]][1]
			Parm2 <- AveSovPropModels_$Parm[[ ListElementName ]][2]
			LowSovProp. <- logistic( LowSovProp., Parm1, Parm2 )

			# Predict values for higher bound
			Intercept <- 1
			ListElementName <- paste( "LE", HigherBnd, sep="" )
			SovPropModel <- AveSovPropModels_$Model[[ ListElementName ]]
			HighSovProp. <- as.vector( eval( parse( text=SovPropModel ), envir=Data.. ) )
			Parm1 <- AveSovPropModels_$Parm[[ ListElementName ]][1]
			Parm2 <- AveSovPropModels_$Parm[[ ListElementName ]][2]
			HighSovProp. <- logistic( HighSovProp., Parm1, Parm2 )

			# Interpolate between the low and high bounds
			Prop <- ( Threshold - LowerBnd ) / ( HigherBnd - LowerBnd )
			interpolate <- function( x, y ) {
				Low <- min( x, y )
				High <- max( x, y )
				Low + Prop * ( High - Low )
			}
			SovProp. <- mapply( interpolate, LowSovProp., HighSovProp. )
		}
		
		# Round up small negative numbers to 0
		SovProp.[ SovProp. < 0 ] <- 0
		
		# Return the result
		SovProp.
		
	}


GreenSTEP_$calcLtVehDvmt <- function( Data.., AveSovPropModels_, Threshold, PropSuitable, Sharing=FALSE ) {
	
		# Calculate the SOV DVMT
		SovProp. <- calcAveSovProp( Data.., AveSovPropModels_, Threshold )
		SovDvmt. <- SovProp. * Data..$Dvmt
		
		# Calculate the light vehicle ownership ratio
		LtVehPerDrvAgePop. <- Data..$LtVehCnt / Data..$DrvAgePop
		if( Sharing ) {
		   LtVehPerDrvAgePop. <- LtVehPerDrvAgePop. / 0.5
          }
		LtVehPerDrvAgePop.[ LtVehPerDrvAgePop. > 1 ] <- 1
		
		
	     # Calculate the light vehicle DVMT
	     SovDvmt. * LtVehPerDrvAgePop. * PropSuitable

	}


GreenSTEP_$calcShortSovVmtProp <- function( Data.., AveSovPropModels_ ) {
	
		# Calculate proportion of DVMT in 2 mile or shorter SOV tours
		SovPropLE2. <- calcAveSovProp( Data.., AveSovPropModels_, 2 )
		
		# Calculate the proportion of DVMT in 5 mile or shorter SOV tours
		SovPropLE5. <- calcAveSovProp( Data.., AveSovPropModels_, 5 )
		
		# Return the result
		list( SovPropLE2=SovPropLE2., SovPropLE5=SovPropLE5. )
		
	}


GreenSTEP_$LtVehOwnModels_ <- structure(list(Metro = "0.239494919760956 * Intercept + 0.186254117419782 * Census_rMidwest + -0.146846670970869 * Census_rSouth + -0.015193104264331 * Census_rWest + 0.166050639905512 * Hhsize + 3.57142278914064e-06 * Hhincttl * Age15to19 + 2.48763945892776e-06 * Hhincttl * Age30to54 + 1.72004416803589e-06 * Hhincttl * Age55to64 + 0.216803801044835 * Age15to19 * VehPerDrvAgePop + 0.164339760946025 * VehPerDrvAgePop * Age20to29 + 0.199173974270093 * Age30to54 * VehPerDrvAgePop + 0.212320927962324 * Age55to64 * VehPerDrvAgePop + 0.14838607575991 * VehPerDrvAgePop * Age65Plus + -0.0140363172283936 * Age20to29 * LogDen + -0.0157422752339548 * Age30to54 * LogDen + -0.0264414267066192 * Age55to64 * LogDen + -0.0247131560053913 * Age65Plus * LogDen", 
    NonMetro = "0.168394394441478 * Intercept + 0.255404397745075 * Census_rMidwest + -0.393506869229846 * Census_rSouth + -0.254854388837784 * Census_rWest + 0.156153095288963 * Hhsize + 3.20050217503788e-06 * Hhincttl * Age15to19 + 2.90847074543147e-06 * Hhincttl * Age30to54 + 2.1246470582263e-06 * Hhincttl * Age55to64 + 1.35453645467784e-06 * Hhincttl * Age65Plus + 0.160401479387148 * Age15to19 * VehPerDrvAgePop + 0.0825910411936799 * VehPerDrvAgePop * Age20to29 + 0.142990220143246 * Age30to54 * VehPerDrvAgePop + 0.127633897466027 * Age55to64 * VehPerDrvAgePop + 0.115087071566911 * Age65Plus * VehPerDrvAgePop + 0.0274359573616246 * Age15to19 * LogDen + 0.0064784210194648 * Age30to54 * LogDen + -0.00820739380602359 * Age55to64 * LogDen + -0.0230144608211162 * Age65Plus * LogDen", 
    BaseProp = 0.5), .Names = c("Metro", "NonMetro", "BaseProp"
))


GreenSTEP_$predictLightVehicles <- function( Data.., LtVehOwnModels_, Type, TargetProp=NA ) {
	
		# Check target acceptability
		if( !is.na( TargetProp ) ){
			if( TargetProp < 0.3 ) {#eric#
				stop( "TargetProp less than 0.3 will create negative numbers" )#eric#
			}
		}
		# Check if proper Type specified
		if( !( Type %in% c( "Metro", "NonMetro" ) ) ) {
			stop( "Type must be either 'Metro' or 'NonMetro'" )
		}

		# Extract model components for specified type
		LtVehOwnModel <- LtVehOwnModels_[[Type]]
		if( is.na( TargetProp ) ) {
			TargetProp <- LtVehOwnModels_$BaseProp
		}
		FactorLo <- -1
		FactorMid <- 0
		FactorHi <- 1
		Itr <- 0
		Intercept <- 1

		# Function to test convergence
		notConverged <- function( TargetProp, EstProp ) {
			Diff <- abs( TargetProp - EstProp )
			Diff > 0.0001
		}

		# Function to calculate number of light vehicles
		calcNumLtVeh <- function( Factor ) {
		     round( Factor + eval( parse( text=LtVehOwnModel ), envir=Data.. ) )
		}	

		# Calculate starting proportion
		LtVehMid. <- calcNumLtVeh( FactorMid )
		EstProp <- mean( LtVehMid. / Data..$DrvAgePop )
		# Continue is there is a target truck proportion to be achieved
		if( !is.na( TargetProp ) ){
			while( notConverged( TargetProp, EstProp ) ) {
				LtVehLo. <- calcNumLtVeh( FactorLo )
				LtVehMid. <- calcNumLtVeh( FactorMid )
				LtVehHi. <- calcNumLtVeh( FactorHi )
		     	EstPropLo <- mean( LtVehLo. / Data..$DrvAgePop )
		     	EstPropMid <- mean( LtVehMid. / Data..$DrvAgePop )
		     	EstPropHi <- mean( LtVehHi. / Data..$DrvAgePop )
				if( TargetProp < EstPropMid ) {
					FactorHi <- FactorMid
					FactorMid <- mean( c( FactorHi, FactorLo ) )
				} 
				if( TargetProp > EstPropMid ) {
					FactorLo <- FactorMid
					FactorMid <- mean( c( FactorLo, FactorHi ) )
				}
				EstProp <- EstPropMid
				rm( EstPropLo, EstPropMid, EstPropHi )
		     	if( Itr > 100 ) break
		     	Itr <- Itr + 1
		 	}
		}

		# Return the result
		LtVehMid.
		
	}


GreenSTEP_$adjEcoTire <- function (Data.., MpgMpkwhAdj.Pt, TireMpgImp, TireMpkwhImp) 
{
    Veh_ <- list()
    Veh_$Houseid <- rep(Data..$Houseid, Data..$Hhvehcnt)
    Veh.. <- data.frame(Veh_)
    rm(Veh_)
    VehNum. <- unlist(sapply(Data..$Hhvehcnt, function(x) 1:x))
    Veh..$Vehid <- paste(Veh..$Houseid, VehNum., sep = "")
    rm(VehNum.)
    Veh..$IsEcoDriver <- as.logical(rep(Data..$IsEcoDriver, Data..$Hhvehcnt))
    Veh..$IsLowRollTire <- rep(Data..$IsLowRollTire, Data..$Hhvehcnt)
    Veh..$Powertrain <- unlist(Data..$Powertrain)
    Veh..$VehMpg <- unlist(Data..$VehMpg)
    Veh..$VehMpkwh <- unlist(Data..$VehMpkwh)
    MpgAdj. <- rep(1, nrow(Veh..))
    MpkwhAdj. <- rep(1, nrow(Veh..))
    MpkwhAdj.[(Veh..$Powertrain == "Ev") | (Veh..$Powertrain == 
        "Phev")] <- MpgMpkwhAdj.Pt["LdEv"]
    MpgAdj.[(Veh..$Powertrain == "Phev") | (Veh..$Powertrain == 
        "Hev")] <- MpgMpkwhAdj.Pt["LdHev"]
    MpgAdj.[(Veh..$Powertrain == "Ice") & Veh..$IsEcoDriver] <- MpgMpkwhAdj.Pt["LdIceEco"]
    MpgAdj.[(Veh..$Powertrain == "Ice") & !Veh..$IsEcoDriver] <- MpgMpkwhAdj.Pt["LdIceNonEco"]
    TireMpgAdj. <- 1 + Veh..$IsLowRollTire * TireMpgImp
    TireMpkwhAdj. <- 1 + Veh..$IsLowRollTire * TireMpkwhImp
    Veh..$VehMpg <- Veh..$VehMpg * MpgAdj. * TireMpgAdj.
    Veh..$VehMpkwh <- Veh..$VehMpkwh * MpkwhAdj. * TireMpkwhAdj.
    SplitIndex. <- rep(1:nrow(Data..), Data..$Hhvehcnt)
    VehMpg_ <- split(Veh..$VehMpg, SplitIndex.)
    VehMpkwh_ <- split(Veh..$VehMpkwh, SplitIndex.)
    list(VehMpg_ = VehMpg_, VehMpkwh_ = VehMpkwh_)
}


GreenSTEP_$calcCongestion <- function (CongModel_, Dvmt.Ty, PerCapFwy, PerCapArt, Pop, BasePop, 
          FwyArtProp, BusVmtSplit.Fc, TruckVmtSplit.Fc, OpsDeployParm_Va.MaYr = OpsDeployParm_Va.MaYr, 
          SmoothEcoDriveParm_Va.., OtherOps_Yr.LvTy = OtherOps_Yr.LvTy, 
          CongPrice.ClFc, CongEfficiency.YrPt = CongEfficiency.YrPt, 
          ValueOfTime = ValueOfTime, ma) 
{
  calcOpsReduction <- function() {
    findUaSizeClass <- function(x) {
      x <- round(x)
      UaPopMax. <- c(Small = 499999, Medium = 999999, Large = 2999999, 
                     VeryLarge = 99999999)
      UaPopMin. <- c(Small = 0, Medium = 5e+05, Large = 1e+06, 
                     VeryLarge = 3e+06)
      names(UaPopMin.[x >= UaPopMin. & x <= UaPopMax.])
    }
    AveOpsDeploy.Od <- unlist(CongModel_$AveOpsDeploy..[findUaSizeClass(Pop), 
                                                        ])[Od]
    OpsDeployLevel.Od <- unlist(lapply(OpsDeployParm_Va.MaYr, 
                                       function(x) x[ma, yr]))[Od]
    Scaling.Od <- AveOpsDeploy.Od * 0
    Scaling.Od[OpsDeployLevel.Od < 0.5] <- OpsDeployLevel.Od[OpsDeployLevel.Od < 
                                                               0.5]/0.5
    Scaling.Od[OpsDeployLevel.Od >= 0.5] <- (1 - OpsDeployLevel.Od[OpsDeployLevel.Od >= 
                                                                     0.5])/0.5
    OpsDeploy.Od <- AveOpsDeploy.Od
    OpsDeploy.Od[OpsDeployLevel.Od < 0.5] <- Scaling.Od[OpsDeployLevel.Od < 
                                                          0.5] * AveOpsDeploy.Od[OpsDeployLevel.Od < 0.5]
    OpsDeploy.Od[OpsDeployLevel.Od >= 0.5] <- 1 - Scaling.Od[OpsDeployLevel.Od >= 
                                                               0.5] * (1 - AveOpsDeploy.Od[OpsDeployLevel.Od >= 
                                                                                             0.5])
    rm(AveOpsDeploy.Od, OpsDeployLevel.Od, Scaling.Od)
    PctDelayReduce_Od.ClDc <- CongModel_$OpsDelayReduce_
    for (od in Od) PctDelayReduce_Od.ClDc[[od]] <- OpsDeploy.Od[od] * 
      PctDelayReduce_Od.ClDc[[od]]
    OtherOps.ClY <- array(0, dim = c(length(Cl), 4), dimnames = list(Cl, 
                                                                     c("FwyLtVeh", "FwyTruck", "ArtLtVeh", "ArtTruck")))
    OtherOps.ClY[2:5, ] <- OtherOps_Yr.LvTy[[yr]]
    OtherOps.ClY <- 1 - OtherOps.ClY/100
    list(PctDelayReduce_Od.ClDc = PctDelayReduce_Od.ClDc, 
         OtherOps.ClY = OtherOps.ClY)
  }
  splitDvmtByFc <- function() {
    FwyArtDvmt <- sum(Dvmt.Ty) * FwyArtProp
    FwyDvmt <- FwyArtDvmt * FwyDvmtRatio
    ArtDvmt <- FwyArtDvmt - FwyDvmt
    Dvmt.Fc <- c(FwyDvmt, ArtDvmt, sum(Dvmt.Ty) - FwyArtDvmt)
    names(Dvmt.Fc) <- c("Fwy", "Art", "Other")
    rm(FwyArtDvmt, FwyDvmt, ArtDvmt)
    Dvmt.TyFc <- array(0, dim = c(3, 3), dimnames = list(Ty, 
                                                         Fc))
    Dvmt.TyFc["Truck", ] <- unlist(Dvmt.Ty["Truck"] * TruckVmtSplit.Fc)
    Dvmt.TyFc["Bus", ] <- unlist(Dvmt.Ty["Bus"] * BusVmtSplit.Fc)
    Dvmt.TyFc["LtVeh", ] <- Dvmt.Fc - colSums(Dvmt.TyFc)
    FwyDemandLvl <- Dvmt.Fc["Fwy"]/(PerCapFwy * Pop/1000)
    ArtDemandLvl <- Dvmt.Fc["Art"]/(PerCapArt * Pop/1000)
    Dvmt.TyFc <<- Dvmt.TyFc
    Dvmt.Fc <<- Dvmt.Fc
    FwyDemandLvl <<- FwyDemandLvl
    ArtDemandLvl <<- ArtDemandLvl
  }
  calcCongPct <- function(Lookup_ = CongModel_$CongPct_, Category, 
                          Type, Demand) {
    if (!(Category %in% c("DVMT", "VHT", "Dvmt", "Vht"))) {
      stop("Type must be either DVMT, Dvmt or VHT, Vht")
    }
    if (Category == "DVMT") 
      Category <- "Dvmt"
    if (Category == "VHT") 
      Category <- "Vht"
    if (!(Type %in% c("Fwy", "Art"))) {
      stop("Type must be either Fwy or Art")
    }
    Lookup.LvCl <- Lookup_[[Category]][[Type]]
    DemandRange. <- as.numeric(rownames(Lookup.LvCl))
    if (Demand < min(DemandRange.)) 
      Demand <- min(DemandRange.)
    if (Demand > max(DemandRange.)) 
      Demand <- max(DemandRange.)
    if (as.character(Demand) %in% rownames(Lookup.LvCl)) {
      Pct.Cl <- Lookup.LvCl[as.character(Demand), ]
    }
    else {
      LowDemand <- round(Demand - 50, -2)
      HighDemand <- round(Demand + 50, -2)
      LowPct.Cl <- Lookup.LvCl[as.character(LowDemand), 
                               ]
      HighPct.Cl <- Lookup.LvCl[as.character(HighDemand), 
                                ]
      LowWeight <- 1 - (Demand - LowDemand)/100
      HighWeight <- 1 - (HighDemand - Demand)/100
      Pct.Cl <- LowWeight * LowPct.Cl + HighWeight * HighPct.Cl
    }
    Pct.Cl
  }
  calcSpeeds <- function() {
    LtVehDvmt.ClFc <- array(0, dim = c(length(Cl), length(Fc)), 
                            dimnames = list(Cl, Fc))
    LtVehDvmt.ClFc[, "Fwy"] <- Dvmt.TyFc["LtVeh", "Fwy"] * 
      FwyDvmtPct.Cl/100
    LtVehDvmt.ClFc[, "Art"] <- Dvmt.TyFc["LtVeh", "Art"] * 
      ArtDvmtPct.Cl/100
    LtVehDvmt.ClFc["None", "Other"] <- Dvmt.TyFc["LtVeh", 
                                                 "Other"]
    TruckDvmt.ClFc <- array(0, dim = c(length(Cl), length(Fc)), 
                            dimnames = list(Cl, Fc))
    TruckDvmt.ClFc[, "Fwy"] <- Dvmt.TyFc["Truck", "Fwy"] * 
      FwyDvmtPct.Cl/100
    TruckDvmt.ClFc[, "Art"] <- Dvmt.TyFc["Truck", "Art"] * 
      ArtDvmtPct.Cl/100
    TruckDvmt.ClFc["None", "Other"] <- Dvmt.TyFc["Truck", 
                                                 "Other"]
    BusDvmt.ClFc <- array(0, dim = c(length(Cl), length(Fc)), 
                          dimnames = list(Cl, Fc))
    BusDvmt.ClFc[, "Fwy"] <- Dvmt.TyFc["Bus", "Fwy"] * FwyDvmtPct.Cl/100
    BusDvmt.ClFc[, "Art"] <- Dvmt.TyFc["Bus", "Art"] * ArtDvmtPct.Cl/100
    BusDvmt.ClFc["None", "Other"] <- Dvmt.TyFc["Bus", "Other"]
    BaseSpeeds.ClY <- CongModel_$BaseSpeeds..
    BaseTravelRates.ClY <- 1/BaseSpeeds.ClY
    BaseDelay.ClDc <- array(0, dim = c(length(Cl), length(Dc)), 
                            dimnames = list(Cl, Dc))
    BaseDelay.ClDc[, "Fwy_Rcr"] <- BaseTravelRates.ClY[, 
                                                       "Fwy_Rcr"] - (1/CongModel_$FreeFlowSpeed.Fc["Fwy"])
    BaseDelay.ClDc[, "Art_Rcr"] <- BaseTravelRates.ClY[, 
                                                       "Art_Rcr"] - (1/CongModel_$FreeFlowSpeed.Fc["Art"])
    BaseDelay.ClDc[, "Fwy_NonRcr"] <- BaseTravelRates.ClY[, 
                                                          "Fwy"] - BaseTravelRates.ClY[, "Fwy_Rcr"]
    BaseDelay.ClDc[, "Art_NonRcr"] <- BaseTravelRates.ClY[, 
                                                          "Art"] - BaseTravelRates.ClY[, "Art_Rcr"]
    DelayReduce_Od.ClDc <- lapply(PctDelayReduce_Od.ClDc, 
                                  function(x) {
                                    BaseDelay.ClDc * x/100
                                  })
    FwyDelayReduction.Cl <- rowSums(do.call(cbind, lapply(DelayReduce_Od.ClDc, 
                                                          function(x) {
                                                            rowSums(x[, c("Fwy_Rcr", "Fwy_NonRcr")])
                                                          })))
    ArtDelayReduction.Cl <- rowSums(do.call(cbind, lapply(DelayReduce_Od.ClDc, 
                                                          function(x) {
                                                            rowSums(x[, c("Art_Rcr", "Art_NonRcr")])
                                                          })))
    FwyLtVehDelay.Cl <- (rowSums(BaseDelay.ClDc[, c("Fwy_Rcr", 
                                                    "Fwy_NonRcr")]) - FwyDelayReduction.Cl) * OtherOps.ClY[, 
                                                                                                           "FwyLtVeh"]
    FwyTruckDelay.Cl <- (rowSums(BaseDelay.ClDc[, c("Fwy_Rcr", 
                                                    "Fwy_NonRcr")]) - FwyDelayReduction.Cl) * OtherOps.ClY[, 
                                                                                                           "FwyTruck"]
    ArtLtVehDelay.Cl <- (rowSums(BaseDelay.ClDc[, c("Art_Rcr", 
                                                    "Art_NonRcr")]) - ArtDelayReduction.Cl) * OtherOps.ClY[, 
                                                                                                           "ArtLtVeh"]
    ArtTruckDelay.Cl <- (rowSums(BaseDelay.ClDc[, c("Art_Rcr", 
                                                    "Art_NonRcr")]) - ArtDelayReduction.Cl) * OtherOps.ClY[, 
                                                                                                           "ArtTruck"]
    LtVehCongSpeed.ClFc <- array(0, dim = c(length(Cl), length(Fc)), 
                                 dimnames = list(Cl, Fc))
    LtVehCongSpeed.ClFc[, "Fwy"] <- 1/((1/CongModel_$FreeFlowSpeed.Fc["Fwy"]) + 
                                         FwyLtVehDelay.Cl)
    LtVehCongSpeed.ClFc[, "Art"] <- 1/((1/CongModel_$FreeFlowSpeed.Fc["Art"]) + 
                                         ArtLtVehDelay.Cl)
    LtVehCongSpeed.ClFc[, "Other"] <- CongModel_$FreeFlowSpeed.Fc["Other"]
    TruckCongSpeed.ClFc <- array(0, dim = c(length(Cl), length(Fc)), 
                                 dimnames = list(Cl, Fc))
    TruckCongSpeed.ClFc[, "Fwy"] <- 1/((1/CongModel_$FreeFlowSpeed.Fc["Fwy"]) + 
                                         FwyTruckDelay.Cl)
    TruckCongSpeed.ClFc[, "Art"] <- 1/((1/CongModel_$FreeFlowSpeed.Fc["Art"]) + 
                                         ArtTruckDelay.Cl)
    TruckCongSpeed.ClFc[, "Other"] <- CongModel_$FreeFlowSpeed.Fc["Other"]
    BusCongSpeed.ClFc <- TruckCongSpeed.ClFc
    BusCongSpeed.ClFc[, "Art"] <- pmin(BusCongSpeed.ClFc[, 
                                                         "Art"], CongModel_$BusSpeeds.Fc["Art"])
    BusCongSpeed.ClFc[, "Other"] <- pmin(BusCongSpeed.ClFc[, 
                                                           "Other"], CongModel_$BusSpeeds.Fc["Other"])
    LtVehHr.ClFc <- LtVehDvmt.ClFc/LtVehCongSpeed.ClFc
    TruckHr.ClFc <- TruckDvmt.ClFc/TruckCongSpeed.ClFc
    BusHr.ClFc <- BusDvmt.ClFc/BusCongSpeed.ClFc
    BaseSpeeds.ClFc <- cbind(CongModel_$BaseSpeeds..[, 1:2], 
                             Other = 20)
    BusBaseSpeeds.ClFc <- BaseSpeeds.ClFc
    BusBaseSpeeds.ClFc[, "Art"] <- pmin(BusBaseSpeeds.ClFc[, 
                                                           "Art"], CongModel_$BusSpeeds.Fc["Art"])
    BusBaseSpeeds.ClFc[, "Other"] <- pmin(BusBaseSpeeds.ClFc[, 
                                                             "Other"], CongModel_$BusSpeeds.Fc["Other"])
    BaseLtVehHr.ClFc <- LtVehDvmt.ClFc/BaseSpeeds.ClFc
    BaseTruckHr.ClFc <- TruckDvmt.ClFc/BaseSpeeds.ClFc
    BaseBusHr.ClFc <- BusDvmt.ClFc/BusBaseSpeeds.ClFc
    VehHr.Fc <- colSums(LtVehHr.ClFc) + colSums(TruckHr.ClFc) + 
      colSums(BusHr.ClFc)
    AveSpeed.Fc <- Dvmt.Fc/VehHr.Fc
    list(Dvmt.TyFc = Dvmt.TyFc, AveSpeed.Fc = AveSpeed.Fc, 
         LtVehDvmt.ClFc = LtVehDvmt.ClFc, TruckDvmt.ClFc = TruckDvmt.ClFc, 
         BusDvmt.ClFc = BusDvmt.ClFc, LtVehCongSpeed.ClFc = LtVehCongSpeed.ClFc, 
         TruckCongSpeed.ClFc = TruckCongSpeed.ClFc, BusCongSpeed.ClFc = BusCongSpeed.ClFc, 
         LtVehHr.ClFc = LtVehHr.ClFc, TruckHr.ClFc = TruckHr.ClFc, 
         BusHr.ClFc = BusHr.ClFc, BaseLtVehHr.ClFc = BaseLtVehHr.ClFc, 
         BaseTruckHr.ClFc = BaseTruckHr.ClFc, BaseBusHr.ClFc = BaseBusHr.ClFc)
  }
  Ty <- c("LtVeh", "Truck", "Bus")
  Fc <- c("Fwy", "Art", "Other")
  Cl <- c("None", "Mod", "Hvy", "Sev", "Ext")
  Od <- c("Ramp", "Incident", "Signal", "Access")
  Dc <- c("Fwy_Rcr", "Fwy_NonRcr", "Art_Rcr", "Art_NonRcr")
  Ops_ <- calcOpsReduction()
  PctDelayReduce_Od.ClDc <- Ops_$PctDelayReduce_Od.ClDc
  OtherOps.ClY <- Ops_$OtherOps.ClY
  #Changes to make CongModel non-Oregon specific
  #Lambda <- CongModel_$Lambda.Ma[ma]
  Lambda <- -0.314318 + 0.0402095 * log(BasePop)
  predLd <- function(BasePop, FutrPop, BaseLd, Intercept = -0.314318, 
                     Slope = 0.0402095) {
    LdChgRatio <- (Intercept + Slope * log(FutrPop))/(Intercept + 
                                                        Slope * log(BasePop))
    LdChgRatio * BaseLd
  }
  Lambda <- predLd(BasePop = BasePop, FutrPop = Pop, BaseLd = Lambda)
  FwyDvmt. <- numeric(0)
  FwyDvmtRatio. <- numeric(0)
  SpeedRatio. <- numeric(0)
  notConverged <- function() {
    if (length(FwyDvmt.) < 5) {
      TRUE
    }
    else {
      abs(diff(tail(FwyDvmt., 2)))/tail(FwyDvmt., 1) > 
        1e-04
    }
  }
  MaxItr <- 500
  i <- 0
  while (notConverged() & (i < MaxItr)) {
    i <- i + 1
    if (i == 1) {
      LnMiRatio <- PerCapFwy/PerCapArt
      FwyDvmtRatio <- eval(parse(text = CongModel_$DvmtRatio))
      FwyDvmtRatio. <- c(FwyDvmtRatio., FwyDvmtRatio)
      splitDvmtByFc()
      FwyDvmt. <- c(FwyDvmt., Dvmt.Fc["Fwy"])
      FwyDvmtPct.Cl <- calcCongPct(CongModel_$CongPct_, 
                                   "Dvmt", "Fwy", FwyDemandLvl)
      ArtDvmtPct.Cl <- calcCongPct(CongModel_$CongPct_, 
                                   "Dvmt", "Art", ArtDemandLvl)
    }
    else {
      FwyDvmtRatio. <- c(FwyDvmtRatio., Lambda * SpeedRatio)
      FwyDvmtRatio <- mean(FwyDvmtRatio.)
      splitDvmtByFc()
      FwyDvmt <- Dvmt.Fc["Fwy"]
      FwyDvmt. <- c(FwyDvmt., FwyDvmt)
      FwyVht <- FwyDvmt/EqAveSpeed.Fc["Fwy"]
      FwyVhtPct.Cl <- calcCongPct(CongModel_$CongPct_, 
                                  "Vht", "Fwy", FwyDemandLvl)
      FwyVht.Cl <- FwyVht * FwyVhtPct.Cl/100
      FwyDvmt.Cl <- EqAveSpeed.ClFc[, "Fwy"] * FwyVht.Cl
      FwyDvmtPct.Cl <- 100 * FwyDvmt.Cl/sum(FwyDvmt.Cl)
      ArtDvmt <- sum(Dvmt.Fc) - FwyDvmt
      ArtVht <- ArtDvmt/EqAveSpeed.Fc["Art"]
      ArtVhtPct.Cl <- calcCongPct(CongModel_$CongPct_, 
                                  "Vht", "Art", ArtDemandLvl)
      ArtVht.Cl <- ArtVht * ArtVhtPct.Cl/100
      ArtDvmt.Cl <- EqAveSpeed.ClFc[, "Art"] * ArtVht.Cl
      ArtDvmtPct.Cl <- 100 * ArtDvmt.Cl/sum(ArtDvmt.Cl)
    }
    SpdCalc_ <- calcSpeeds()
    TruckDvmt.ClFc <- SpdCalc_$TruckDvmt.ClFc
    BusDvmt.ClFc <- SpdCalc_$BusDvmt.ClFc
    LtVehDvmt.ClFc <- SpdCalc_$LtVehDvmt.ClFc
    Dvmt.ClFc <- TruckDvmt.ClFc + BusDvmt.ClFc + LtVehDvmt.ClFc
    TruckHr.ClFc <- SpdCalc_$TruckHr.ClFc
    BusHr.ClFc <- SpdCalc_$BusHr.ClFc
    LtVehHr.ClFc <- SpdCalc_$LtVehHr.ClFc
    LtVehCost.ClFc <- LtVehHr.ClFc * ValueOfTime + CongPrice.ClFc * 
      SpdCalc_$LtVehDvmt.ClFc
    EqLtVehHr.ClFc <- LtVehCost.ClFc/ValueOfTime
    EqVehHr.ClFc <- EqLtVehHr.ClFc + TruckHr.ClFc + BusHr.ClFc
    EqAveSpeed.ClFc <- Dvmt.ClFc/EqVehHr.ClFc
    EqAveSpeed.Fc <- colSums(Dvmt.ClFc)/colSums(EqVehHr.ClFc)
    SpeedRatio <- EqAveSpeed.Fc["Fwy"]/EqAveSpeed.Fc["Art"]
    SpeedRatio. <- c(SpeedRatio., SpeedRatio)
  }
  MaxIceFuelSavings.SpTy <- as.matrix(CongModel_$SpdSmoothEff.. * 
                                        0.5)
  colnames(MaxIceFuelSavings.SpTy) <- c("LtVeh", "Truck")
  SmoothPropMaxBenefit.Fc <- c(Fwy = SmoothEcoDriveParm_Va..$FwySmooth[ma, 
                                                                       yr], Art = SmoothEcoDriveParm_Va..$ArtSmooth[ma, yr])
  EcoPropMaxBenefit.Fc <- CongModel_$EcoDriveFraction.Ty
  EcoDriverProp.Ty <- c(LtVeh = SmoothEcoDriveParm_Va..$LtVehEco[ma, 
                                                                 yr], Truck = SmoothEcoDriveParm_Va..$TruckEco[ma, yr])
  LtVehNonEcoBenefit.SpFc <- outer(MaxIceFuelSavings.SpTy[, 
                                                          "LtVeh"], SmoothPropMaxBenefit.Fc, "*")
  LtVehEcoBenefit.SpFc <- outer(MaxIceFuelSavings.SpTy[, "LtVeh"], 
                                EcoPropMaxBenefit.Fc, "*")
  LtVehEcoBenefit.SpFc[LtVehNonEcoBenefit.SpFc > LtVehEcoBenefit.SpFc] <- LtVehNonEcoBenefit.SpFc[LtVehNonEcoBenefit.SpFc > 
                                                                                                    LtVehEcoBenefit.SpFc]
  TruckNonEcoBenefit.SpFc <- outer(MaxIceFuelSavings.SpTy[, 
                                                          "Truck"], SmoothPropMaxBenefit.Fc, "*")
  TruckEcoBenefit.SpFc <- outer(MaxIceFuelSavings.SpTy[, "Truck"], 
                                EcoPropMaxBenefit.Fc, "*")
  TruckEcoBenefit.SpFc[TruckNonEcoBenefit.SpFc > TruckEcoBenefit.SpFc] <- TruckNonEcoBenefit.SpFc[TruckNonEcoBenefit.SpFc > 
                                                                                                    TruckEcoBenefit.SpFc]
  TruckCombBenefit.SpFc <- TruckEcoBenefit.SpFc * EcoDriverProp.Ty["Truck"] + 
    TruckNonEcoBenefit.SpFc * (1 - EcoDriverProp.Ty["Truck"])
  Ce <- c("Low", "High")
  FscCoef. <- c("a0", "a1", "a2", "a3", "a4")
  Av <- c("LdIce", "LdHev", "LdEv", "LdFcv", "HdIce")
  MpgAdj.Ty <- numeric(length(Ty))
  names(MpgAdj.Ty) <- Ty
  MpkwhAdj.Ty <- numeric(length(Ty))
  names(MpkwhAdj.Ty) <- Ty
  calcFeAdj <- function(FscCoef., Speed., RefSpeed) {
    sapply(Speed., function(x) {
      exp(sum(FscCoef.[-1] * c(x - RefSpeed, x^2 - RefSpeed^2, 
                               x^3 - RefSpeed^3, x^4 - RefSpeed^4)))
    })
  }
  interpolate <- function(Spd, Spds., Vals.) {
    if (Spd >= max(Spds.) | Spd <= min(Spds.)) {
      if (Spd >= max(Spds.)) {
        Val <- Vals.[which(Spds. == max(Spds.))]
      }
      else {
        Val <- Vals.[which(Spds. == min(Spds.))]
      }
    }
    else {
      Idx. <- which(rank(abs(Spds. - Spd), ties.method = "first") <= 
                      2)
      ValsProp. <- abs(Spds.[Idx.] - Spd)/abs(diff(Spds.[Idx.]))
      Val <- sum(Vals.[Idx.] * rev(ValsProp.))
    }
    Val
  }
  CongEff.Pt <- CongEfficiency.YrPt[yr, ]
  FeAdj.ClFcAv <- array(0, dim = c(length(Cl), length(Fc), 
                                   length(Av)), dimnames = list(Cl, Fc, Av))
  for (av in c("LdIce", "LdHev", "LdEv", "LdFcv")) {
    FscRows.Ce <- which(CongModel_$AdvVehFsc..$FacilityType == 
                          "Fwy" & CongModel_$AdvVehFsc..$AdvVehType == av)
    names(FscRows.Ce) <- CongModel_$AdvVehFsc..$CongEff[FscRows.Ce]
    FeAdj.ClFcAv[, "Fwy", av] <- unlist(1 - CongEff.Pt[av]) * 
      calcFeAdj(CongModel_$AdvVehFsc..[FscRows.Ce["Low"], 
                                       FscCoef.], Speed. = SpdCalc_$LtVehCongSpeed.ClFc[, 
                                                                                        "Fwy"], RefSpeed = CongModel_$FwyNormSpd) + unlist(CongEff.Pt[av]) * 
      calcFeAdj(CongModel_$AdvVehFsc..[FscRows.Ce["High"], 
                                       FscCoef.], Speed. = SpdCalc_$LtVehCongSpeed.ClFc[, 
                                                                                        "Fwy"], RefSpeed = CongModel_$FwyNormSpd)
  }
  for (av in c("HdIce")) {
    FscRows.Ce <- which(CongModel_$AdvVehFsc..$FacilityType == 
                          "Fwy" & CongModel_$AdvVehFsc..$AdvVehType == av)
    names(FscRows.Ce) <- CongModel_$AdvVehFsc..$CongEff[FscRows.Ce]
    FeAdj.ClFcAv[, "Fwy", av] <- unlist(1 - CongEff.Pt[av]) * 
      calcFeAdj(CongModel_$AdvVehFsc..[FscRows.Ce["Low"], 
                                       FscCoef.], Speed. = SpdCalc_$TruckCongSpeed.ClFc[, 
                                                                                        "Fwy"], RefSpeed = CongModel_$FwyNormSpd) + unlist(CongEff.Pt[av]) * 
      calcFeAdj(CongModel_$AdvVehFsc..[FscRows.Ce["High"], 
                                       FscCoef.], Speed. = SpdCalc_$TruckCongSpeed.ClFc[, 
                                                                                        "Fwy"], RefSpeed = CongModel_$FwyNormSpd)
  }
  for (av in c("LdIce", "LdHev", "LdEv", "LdFcv")) {
    FscRows.Ce <- which(CongModel_$AdvVehFsc..$FacilityType == 
                          "Art" & CongModel_$AdvVehFsc..$AdvVehType == av)
    names(FscRows.Ce) <- CongModel_$AdvVehFsc..$CongEff[FscRows.Ce]
    FeAdj.ClFcAv[, "Art", av] <- unlist(1 - CongEff.Pt[av]) * 
      calcFeAdj(CongModel_$AdvVehFsc..[FscRows.Ce["Low"], 
                                       FscCoef.], Speed. = SpdCalc_$LtVehCongSpeed.ClFc[, 
                                                                                        "Art"], RefSpeed = CongModel_$ArtNormSpd) + unlist(CongEff.Pt[av]) * 
      calcFeAdj(CongModel_$AdvVehFsc..[FscRows.Ce["High"], 
                                       FscCoef.], Speed. = SpdCalc_$LtVehCongSpeed.ClFc[, 
                                                                                        "Art"], RefSpeed = CongModel_$ArtNormSpd)
  }
  for (av in c("HdIce")) {
    FscRows.Ce <- which(CongModel_$AdvVehFsc..$FacilityType == 
                          "Art" & CongModel_$AdvVehFsc..$AdvVehType == av)
    names(FscRows.Ce) <- CongModel_$AdvVehFsc..$CongEff[FscRows.Ce]
    FeAdj.ClFcAv[, "Art", av] <- unlist(1 - CongEff.Pt[av]) * 
      calcFeAdj(CongModel_$AdvVehFsc..[FscRows.Ce["Low"], 
                                       FscCoef.], Speed. = SpdCalc_$TruckCongSpeed.ClFc[, 
                                                                                        "Art"], RefSpeed = CongModel_$ArtNormSpd) + unlist(CongEff.Pt[av]) * 
      calcFeAdj(CongModel_$AdvVehFsc..[FscRows.Ce["High"], 
                                       FscCoef.], Speed. = SpdCalc_$TruckCongSpeed.ClFc[, 
                                                                                        "Art"], RefSpeed = CongModel_$ArtNormSpd)
  }
  FeAdj.ClFcAv[, "Other", ] <- 1
  Pt <- c("LdIceEco", "LdIceNonEco", "LdHev", "LdFcv", "LdEv", 
          "TruckIce", "TruckEv", "BusIce", "BusEv")
  MpgMpkwhAdj.Pt <- numeric(length(Pt))
  names(MpgMpkwhAdj.Pt) <- Pt
  LtVehEcoAdj.ClFc <- array(1, dim = c(length(Cl), length(Fc)), 
                            dimnames = list(Cl, Fc))
  LtVehEcoAdj.ClFc[, "Fwy"] <- 1 + sapply(SpdCalc_$LtVehCongSpeed.ClFc[, 
                                                                       "Fwy"], function(x) {
                                                                         interpolate(x, as.numeric(rownames(LtVehEcoBenefit.SpFc)), 
                                                                                     LtVehEcoBenefit.SpFc[, "Fwy"])
                                                                       })
  LtVehEcoAdj.ClFc[, "Art"] <- 1 + sapply(SpdCalc_$LtVehCongSpeed.ClFc[, 
                                                                       "Art"], function(x) {
                                                                         interpolate(x, as.numeric(rownames(LtVehEcoBenefit.SpFc)), 
                                                                                     LtVehEcoBenefit.SpFc[, "Art"])
                                                                       })
  MpgMpkwhAdj.Pt["LdIceEco"] <- sum(FeAdj.ClFcAv[, , "LdIce"] * 
                                      LtVehEcoAdj.ClFc * SpdCalc_$LtVehDvmt.ClFc)/sum(SpdCalc_$LtVehDvmt.ClFc)
  LtVehNonEcoAdj.ClFc <- array(1, dim = c(length(Cl), length(Fc)), 
                               dimnames = list(Cl, Fc))
  LtVehNonEcoAdj.ClFc[, "Fwy"] <- 1 + sapply(SpdCalc_$LtVehCongSpeed.ClFc[, 
                                                                          "Fwy"], function(x) {
                                                                            interpolate(x, as.numeric(rownames(LtVehNonEcoBenefit.SpFc)), 
                                                                                        LtVehNonEcoBenefit.SpFc[, "Fwy"])
                                                                          })
  LtVehNonEcoAdj.ClFc[, "Art"] <- 1 + sapply(SpdCalc_$LtVehCongSpeed.ClFc[, 
                                                                          "Art"], function(x) {
                                                                            interpolate(x, as.numeric(rownames(LtVehNonEcoBenefit.SpFc)), 
                                                                                        LtVehNonEcoBenefit.SpFc[, "Art"])
                                                                          })
  MpgMpkwhAdj.Pt["LdIceNonEco"] <- sum(FeAdj.ClFcAv[, , "LdIce"] * 
                                         LtVehNonEcoAdj.ClFc * SpdCalc_$LtVehDvmt.ClFc)/sum(SpdCalc_$LtVehDvmt.ClFc)
  MpgMpkwhAdj.Pt["LdHev"] <- sum(FeAdj.ClFcAv[, , "LdHev"] * 
                                   SpdCalc_$LtVehDvmt.ClFc)/sum(SpdCalc_$LtVehDvmt.ClFc)
  MpgMpkwhAdj.Pt["LdFcv"] <- sum(FeAdj.ClFcAv[, , "LdFcv"] * 
                                   SpdCalc_$LtVehDvmt.ClFc)/sum(SpdCalc_$LtVehDvmt.ClFc)
  MpgMpkwhAdj.Pt["LdEv"] <- sum(FeAdj.ClFcAv[, , "LdEv"] * 
                                  SpdCalc_$LtVehDvmt.ClFc)/sum(SpdCalc_$LtVehDvmt.ClFc)
  TruckCombAdj.ClFc <- array(1, dim = c(length(Cl), length(Fc)), 
                             dimnames = list(Cl, Fc))
  TruckCombAdj.ClFc[, "Fwy"] <- 1 + sapply(SpdCalc_$TruckCongSpeed.ClFc[, 
                                                                        "Fwy"], function(x) {
                                                                          interpolate(x, as.numeric(rownames(TruckCombBenefit.SpFc)), 
                                                                                      TruckCombBenefit.SpFc[, "Fwy"])
                                                                        })
  TruckCombAdj.ClFc[, "Art"] <- 1 + sapply(SpdCalc_$TruckCongSpeed.ClFc[, 
                                                                        "Art"], function(x) {
                                                                          interpolate(x, as.numeric(rownames(TruckCombBenefit.SpFc)), 
                                                                                      TruckCombBenefit.SpFc[, "Art"])
                                                                        })
  MpgMpkwhAdj.Pt["TruckIce"] <- sum(FeAdj.ClFcAv[, , "HdIce"] * 
                                      TruckCombAdj.ClFc * SpdCalc_$TruckDvmt.ClFc)/sum(SpdCalc_$TruckDvmt.ClFc)
  MpgMpkwhAdj.Pt["TruckEv"] <- 1
  BusMpgAdj.ClFc <- array(0, dim = c(length(Cl), length(Fc)), 
                          dimnames = list(Cl, Fc))
  SpeedIdx. <- as.numeric(rownames(CongModel_$FwySpdMpgAdj..))
  MpgAdjIdx. <- CongModel_$FwySpdMpgAdj..[, "Bus"]
  Speeds. <- SpdCalc_$BusCongSpeed.ClFc[, "Fwy"]
  BusMpgAdj.ClFc[, "Fwy"] <- sapply(Speeds., function(x) {
    interpolate(x, SpeedIdx., MpgAdjIdx.)
  })
  SpeedIdx. <- as.numeric(rownames(CongModel_$ArtSpdMpgAdj..))
  MpgAdjIdx. <- CongModel_$ArtSpdMpgAdj..[, "Bus"]
  Speeds. <- SpdCalc_$BusCongSpeed.ClFc[, "Art"]
  BusMpgAdj.ClFc[, "Art"] <- sapply(Speeds., function(x) {
    interpolate(x, SpeedIdx., MpgAdjIdx.)
  })
  SpeedIdx. <- as.numeric(rownames(CongModel_$OtherSpdMpgAdj..))
  MpgAdjIdx. <- CongModel_$OtherSpdMpgAdj..[, "Bus"]
  Speeds. <- SpdCalc_$BusCongSpeed.ClFc[, "Other"]
  BusMpgAdj.ClFc[, "Other"] <- sapply(Speeds., function(x) {
    interpolate(x, SpeedIdx., MpgAdjIdx.)
  })
  MpgMpkwhAdj.Pt["BusIce"] <- sum(BusMpgAdj.ClFc * SpdCalc_$BusDvmt.ClFc)/sum(SpdCalc_$BusDvmt.ClFc)
  MpgMpkwhAdj.Pt["BusEv"] <- 1
  AveCongTaxPerMi <- sum(SpdCalc_$LtVehDvmt.ClFc * CongPrice.ClFc)/sum(SpdCalc_$LtVehDvmt.ClFc)
  FfVehHr.Ty <- rep(0, length(Ty))
  names(FfVehHr.Ty) <- Ty
  FfVehHr.Ty["LtVeh"] <- sum(colSums(SpdCalc_$LtVehDvmt.ClFc)/CongModel_$FreeFlowSpeed.Fc)
  FfVehHr.Ty["Truck"] <- sum(colSums(SpdCalc_$TruckDvmt.ClFc)/CongModel_$FreeFlowSpeed.Fc)
  FfVehHr.Ty["Bus"] <- sum(colSums(SpdCalc_$BusDvmt.ClFc)/CongModel_$BusSpeeds.Fc)
  VehHr.Ty <- c(LtVeh = sum(SpdCalc_$LtVehHr.ClFc), Truck = sum(SpdCalc_$TruckHr.ClFc), 
                Bus = sum(SpdCalc_$BusHr.ClFc))
  DelayVehHr.Ty <- VehHr.Ty - FfVehHr.Ty
  Dvmt.Ty <- c(LtVeh = sum(SpdCalc_$LtVehDvmt.ClFc), Truck = sum(SpdCalc_$TruckDvmt.ClFc), 
               Bus = sum(SpdCalc_$BusDvmt.ClFc))
  AveSpeed.Ty <- Dvmt.Ty/VehHr.Ty
  LtVehHrPriceShift.ClFc <- SpdCalc_$LtVehHr.ClFc - SpdCalc_$LtVehHr.ClFc
  list(MpgMpkwhAdj.Pt = MpgMpkwhAdj.Pt, VehHr.Ty = VehHr.Ty, 
       FfVehHr.Ty = FfVehHr.Ty, DelayVehHr.Ty = DelayVehHr.Ty, 
       Dvmt.Ty = Dvmt.Ty, AveSpeed.Ty = AveSpeed.Ty, LtVehDvmt.ClFc = SpdCalc_$LtVehDvmt.ClFc, 
       TruckDvmt.ClFc = SpdCalc_$TruckDvmt.ClFc, BusDvmt.ClFc = SpdCalc_$BusDvmt.ClFc, 
       AveCongTaxPerMi = AveCongTaxPerMi, SpdCalc_ = SpdCalc_, 
       FeAdj.ClFcAv = FeAdj.ClFcAv, LtVehEcoAdj.ClFc = LtVehEcoAdj.ClFc, 
       LtVehNonEcoAdj.ClFc = LtVehNonEcoAdj.ClFc)
}


GreenSTEP_$CongModel_ <- structure(list(DvmtRatio = "0.234723789341716 + 0.68811846412506 * LnMiRatio", 
    CongPct_ = structure(list(Dvmt = structure(list(Fwy = structure(c(89.8995009684864, 
    89.6562487564239, 89.4129375905302, 89.1694824115111, 88.9257406073945, 
    88.6815425220378, 88.4366678752934, 88.1908729036729, 87.943870534329, 
    87.6953540031149, 87.4449810900451, 87.1923939332507, 86.937207559167, 
    86.6790255838585, 86.4174330936014, 86.1520083593551, 85.882320920601, 
    85.6079378002412, 85.3284246863371, 85.043353973356, 84.7523262162293, 
    84.4549509957199, 84.1508458354529, 83.8396303515881, 83.5209245875632, 
    83.1943526885117, 82.8595547790726, 82.5161713293795, 82.1638282120388, 
    81.8021428977386, 81.4307138470198, 81.0491336131515, 80.6569901304628, 
    80.2538717385902, 79.8393730173404, 79.4130965399785, 78.9746706134324, 
    78.5237409828586, 78.0599974126674, 77.583157834697, 77.093008831243, 
    76.5893724394986, 76.0721438657894, 75.5412514334092, 74.9966827643941, 
    74.4384555238636, 73.8666482505312, 73.2813707461098, 72.6827969907173, 
    72.0711354139004, 71.4466680645165, 70.8096952890046, 70.1605170048214, 
    69.4994452360322, 68.8268408621205, 68.1430973854552, 67.4486899445293, 
    66.7441369123073, 66.0300479635181, 65.3070666623788, 64.5758808292974, 
    63.8371976039962, 63.0917571472656, 62.3403092091547, 61.5836088756805, 
    60.8224071381951, 60.0574332734238, 59.2894038407003, 58.5190062444182, 
    57.7469067249405, 56.9737160214481, 56.2000131392513, 55.4263056493602, 
    54.6530681846791, 53.8807150599887, 53.1096235008895, 52.3400826943861, 
    51.5723394405712, 50.8065590304871, 50.0428769437357, 49.2813909232057, 
    48.5221797950574, 47.7652844552477, 47.0107275187272, 46.258496406622, 
    45.5085737679909, 44.7609583574451, 44.0156671824855, 43.2727741566166, 
    42.5323714184701, 41.7945671011816, 41.0594805580912, 40.3272600288522, 
    39.598075639763, 38.8721561773917, 38.1497559391777, 37.4311726057799, 
    36.7167146455033, 36.0066902940203, 35.3014044762294, 34.6011491065675, 
    33.9062193773578, 33.2169366029319, 32.533624508438, 31.8565903402826, 
    31.1861397496596, 30.5225884856548, 29.8662572558468, 29.2174765038949, 
    28.5765832019958, 27.9439307004165, 27.3198812614994, 26.7048164178185, 
    26.0991357696481, 25.5032919178323, 24.9177520809848, 24.3429889482297, 
    23.7794572551578, 23.2275344527157, 22.6875655944279, 22.1598434287748, 
    21.6446386933969, 21.1421863876212, 20.6527056239117, 20.1763877055971, 
    19.7134115025348, 19.2639339598344, 18.8280989924489, 18.4060203194536, 
    17.997797503397, 17.6035036765981, 17.2231977869472, 16.8569084748496, 
    16.5046438567148, 16.1663602604542, 15.8419873132662, 15.531399627995, 
    15.2344456129259, 14.9509238724632, 14.6806105703539, 14.4232419115964, 
    14.17853593053, 13.9461779376075, 13.7258381846683, 13.5171594129844, 
    13.3197727265056, 13.1332901904574, 12.9573161235033, 12.7914428967813, 
    12.6352586296121, 12.4883463815707, 12.3502867169993, 12.2206552790549, 
    12.0990259603811, 11.9849705727543, 11.8780610593177, 11.777871969549, 
    11.6839800436095, 11.5959681780584, 11.5134231598534, 11.4359411811473, 
    11.3631238483219, 11.2945850194785, 11.2299452879322, 11.1688399361343, 
    11.1109121555977, 11.0558220849451, 11.0032387087704, 10.9528494484413, 
    10.9043526220764, 10.8574716980227, 10.8119435564651, 10.7675335747101, 
    10.7240216142423, 10.681216976136, 10.6389440286507, 10.5970579691966, 
    10.5554297063887, 10.5139621645126, 10.4725746034215, 10.4312196095714, 
    6.63193797890558, 6.74314862643377, 6.85438123177422, 6.96566688647456, 
    7.07705614432134, 7.18860813346694, 7.30039681728822, 7.41250246098353, 
    7.52501570181273, 7.63803122787077, 7.75164955853145, 7.865972978821, 
    7.98110500509664, 8.09714862700914, 8.2142034960525, 8.332366343488, 
    8.45172555780276, 8.57236441461803, 8.69435408086579, 8.81775654811058, 
    8.94260921513659, 9.06894257149461, 9.19678406258248, 9.3261613671729, 
    9.45710614169113, 9.58965026451945, 9.72382252421587, 9.85965044518702, 
    9.99715958505828, 10.1363737778751, 10.2773119301443, 10.4199891924558, 
    10.5644106192703, 10.7105749674629, 10.8584658996943, 11.0080589443933, 
    11.1593121872733, 11.3121747150378, 11.4665770610641, 11.6224407027358, 
    11.7796694467887, 11.938157747112, 12.0977803168566, 12.2584031461825, 
    12.4198770740233, 12.5820440767904, 12.7447258320322, 12.907737041184, 
    13.0708848000905, 13.2339724092771, 13.3967955935796, 13.5591496079455, 
    13.7208354034557, 13.8816555346698, 14.0414132739271, 14.1999069822476, 
    14.3569146575953, 14.5122017819831, 14.6655041366775, 14.8165431280382, 
    14.9650123635426, 15.1105894016865, 15.2529154039203, 15.3916139027039, 
    15.5262743115795, 15.656471576416, 15.7817568913055, 15.901672599063, 
    16.0157493891698, 16.1235308882012, 16.2246241244387, 16.3186761930094, 
    16.4054310547131, 16.4846777749279, 16.55628897167, 16.620184946842, 
    16.6763931852526, 16.724984415929, 16.7660951618659, 16.7998828547646, 
    16.8265227671882, 16.846199337659, 16.8591158276744, 16.8654841709301, 
    16.8655321669385, 16.8594888676005, 16.8475724685539, 16.8299862592167, 
    16.8068847603913, 16.7784042222945, 16.744656581417, 16.7057433381699, 
    16.661748562373, 16.6127502668053, 16.5588196666759, 16.5000281293802, 
    16.4364544286284, 16.3681861912564, 16.2953390502877, 16.2180462766175, 
    16.1364836864414, 16.0508434251776, 15.9613404098345, 15.8681997584598, 
    15.7716646216676, 15.6719908496703, 15.5694670585044, 15.4643919200533, 
    15.3570715637636, 15.247815689039, 15.1369408175501, 15.024766348205, 
    14.9116163665962, 14.7978150215649, 14.6836820282618, 14.5695329732958, 
    14.4556713628006, 14.3423926104688, 14.2299718407069, 14.1186748059152, 
    14.0087500597566, 13.9004384662038, 13.7939673292058, 13.6895549789268, 
    13.5873974104134, 13.4876782184899, 13.39055373221, 13.2961656500529, 
    13.2046244139725, 13.1160274185027, 13.0304511250235, 12.9479646583674, 
    12.8686287303306, 12.7924988514872, 12.7196181405584, 12.6500203618881, 
    12.5837142541615, 12.5206964690908, 12.4609403361529, 12.4044087135863, 
    12.351045896912, 12.3007879414163, 12.2535565041638, 12.2092671089173, 
    12.1678251444536, 12.1291312020164, 12.0930768177025, 12.0595493373629, 
    12.0284284010108, 11.9995898354498, 11.9729019204826, 11.9482316105419, 
    11.9254481055807, 11.9044226903653, 11.8850327433941, 11.8671585834076, 
    11.8506861963833, 11.8355044959219, 11.8215084388808, 11.8085960138826, 
    11.7966712933542, 11.7856414012079, 11.7754195834944, 11.7659221331916, 
    11.7570714088477, 11.7487927800679, 11.7410175951166, 11.7336801390473, 
    11.726720465412, 11.7200816597249, 11.7137131668493, 11.7075676157614, 
    11.7016040125399, 11.6957844614677, 11.690077082541, 11.6844529322857, 
    11.6788887976308, 11.6733642496688, 11.6678642657403, 11.6623764633909, 
    11.6568936147356, 1.77004248529261, 1.85979595524876, 1.94956832705285, 
    2.03938676747444, 2.12929653636114, 2.21935127692826, 2.30962007278377, 
    2.40017903547129, 2.49111694788449, 2.58252819001075, 2.67451685886236, 
    2.76719113076731, 2.86066578229158, 2.95505809199998, 3.05048874621474, 
    3.14707923571313, 3.24495086133516, 3.34422413527113, 3.44501660504982, 
    3.54744174808522, 3.65159972599368, 3.75758586433332, 3.86548946022689, 
    3.97539749888526, 4.08739374630722, 4.20155898773651, 4.31796530460869, 
    4.43668356272028, 4.55778846911987, 4.68135725046402, 4.80747337058909, 
    4.93622219579151, 5.06769046502807, 5.20196472004298, 5.33912934106971, 
    5.47926581887505, 5.62244624786981, 5.76873593204448, 5.9181824100643, 
    6.07082099474627, 6.22665586083954, 6.38567560013965, 6.54783761069528, 
    6.71308512081057, 6.88133587355809, 7.05249665022308, 7.2264558701729, 
    7.40308999347199, 7.58224600489091, 7.76375762593606, 7.94743500035104, 
    8.13309188374784, 8.32058005697483, 8.50976469894693, 8.70052655560892, 
    8.89275188084396, 9.08633339325878, 9.28116535643934, 9.47714174916484, 
    9.67415123225431, 9.87206147949276, 10.0707212158187, 10.2699243578189, 
    10.4694362890119, 10.6689630689963, 10.8681818837493, 11.0667137486823, 
    11.264155719082, 11.4600651803034, 11.6539824863736, 11.8454195359412, 
    12.0338829859343, 12.2188869817783, 12.3999541636652, 12.5766336623544, 
    12.7484932516433, 12.9151487869142, 13.076242054373, 13.2314704819368, 
    13.3805663173222, 13.5233454457342, 13.659670303515, 13.7895058940682, 
    13.9128631625173, 14.0298342538043, 14.1405437539475, 14.2451648134501, 
    14.343887581555, 14.4369216379779, 14.5244806042718, 14.6067748388662, 
    14.6840081051249, 14.7563610492712, 14.824002463647, 14.8870768422078, 
    14.9457181333803, 15.0000424018606, 15.0501571566809, 15.096153567947, 
    15.1381210228575, 15.1761581159088, 15.210364484467, 15.2408347300788, 
    15.2676626296126, 15.2909436970417, 15.3107766058056, 15.327270930103, 
    15.3405363908475, 15.3506723950519, 15.3577729984964, 15.3619211659321, 
    15.3631956463116, 15.3616694164241, 15.3574112240425, 15.3504786730381, 
    15.340920978494, 15.3287649442427, 15.3140285438036, 15.2967168406976, 
    15.2768317705278, 15.2543756672284, 15.2293525870793, 15.2017730774151, 
    15.1716503066833, 15.1390014367298, 15.1038459341499, 15.066208491138, 
    15.0261185127877, 14.9836190301894, 14.9387618398675, 14.8916201740847, 
    14.8422760978276, 14.7908255712395, 14.7373701852296, 14.6820201586142, 
    14.6248872250744, 14.5660805498452, 14.5057082375754, 14.4438767190171, 
    14.3806932175476, 14.3162698009406, 14.2507202133555, 14.1841600600961, 
    14.1167025057569, 14.0484490909482, 13.9794964170815, 13.9099329527549, 
    13.839843510717, 13.7693064131302, 13.69839752462, 13.6271893702504, 
    13.5557508778169, 13.4841399256036, 13.4124085115917, 13.3405961620612, 
    13.2687369470986, 13.1968555837165, 13.1249726401025, 13.0531014422182, 
    12.9812523148555, 12.9094308203535, 12.8376407601291, 12.7658836543631, 
    12.6941605310924, 12.6224727310153, 12.5508223054801, 12.4792138357747, 
    12.4076540692972, 12.336155887946, 12.264732472509, 12.1933920648328, 
    12.1221397907418, 12.0509732509138, 11.9798871768663, 11.9088723486229, 
    11.8379181223422, 11.7670121102169, 11.6961416851981, 11.6252950072369, 
    11.554461281164, 11.4836331043273, 1.29074230283816, 1.33295322158292, 
    1.37517833165929, 1.41743853304862, 1.45977000281953, 1.5022165111802, 
    1.54483692380983, 1.58769753232543, 1.6308792366242, 1.67447006585615, 
    1.71857195790235, 1.76329357995287, 1.80875660770272, 1.85508895997107, 
    1.90243051956894, 1.95092681939738, 2.0007340287258, 2.05201336902677, 
    2.104935634217, 2.15967503120289, 2.2164098464053, 2.27531865418323, 
    2.33657710113366, 2.40035885273008, 2.46683257771388, 2.53616371011805, 
    2.60850974187423, 2.68402824846641, 2.76288508168946, 2.84525146794272, 
    2.9313118557326, 3.02125635454952, 3.11528449571275, 3.21360006819546, 
    3.31641446975745, 3.42394090049984, 3.53639216110234, 3.65397908185228, 
    3.77690501088878, 3.9053671597765, 4.03954567593023, 4.17961172535991, 
    4.3257176126057, 4.47800699124234, 4.63660777245272, 4.80163845672992, 
    4.97319564419969, 5.15136376984873, 5.33620050847467, 5.52774778658994, 
    5.7260112977553, 5.93097978789591, 6.14261044534645, 6.36084012864383, 
    6.58555593472425, 6.81662120885782, 7.0538540512507, 7.29705367142229, 
    7.54598896120863, 7.80042195314888, 8.06011756027793, 8.32485055775907, 
    8.59443228877361, 8.86869876406052, 9.14754809657152, 9.43091139026069, 
    9.71878961087906, 10.0112151221678, 10.3082760180319, 10.6100748614342, 
    10.9167163614052, 11.2282935659978, 11.544850733287, 11.8664057440737, 
    12.1929197600389, 12.5243250968396, 12.8604954051557, 13.2012833972595, 
    13.5465166967702, 13.8960102948092, 14.2495537411599, 14.6069270153214, 
    14.9678972569918, 15.3322274070669, 15.6996764510331, 16.0699996393545, 
    16.4429412378157, 16.8182432861757, 17.195649904771, 17.5749053819567, 
    17.9557525975857, 18.3379311324482, 18.7211687795857, 19.1051837725597, 
    19.4896678947612, 19.8742987357051, 20.2587235595735, 20.6425775970745, 
    21.0254782703541, 21.4070261333868, 21.7867720760233, 22.1642411932711, 
    22.5389050648896, 22.9102169993995, 23.2776107356166, 23.640505369218, 
    23.9982809930297, 24.3503085333369, 24.6959612531102, 25.0346147381969, 
    25.365651529263, 25.6884594877906, 26.0024408037053, 26.3070136417821, 
    26.6016457377488, 26.8858381484233, 27.159175644032, 27.4212904927484, 
    27.671921241129, 27.9108545083958, 28.1379629260531, 28.3531592408588, 
    28.556430648305, 28.7477985652326, 28.9273468451434, 29.0951890313073, 
    29.2514949894047, 29.3964636359168, 29.5303537681166, 29.6534500965032, 
    29.766081103688, 29.8685913390356, 29.9613458468123, 30.0447166767993, 
    30.1190834059358, 30.1848266584389, 30.2423237204784, 30.2919493470231, 
    30.3340715062832, 30.369055736014, 30.3972646389094, 30.4190585036656, 
    30.4347912980505, 30.4448106181629, 30.4494448943536, 30.4490130428392, 
    30.4438150890483, 30.4341414891431, 30.4202633130069, 30.4024418643678, 
    30.3809187686104, 30.3559271841542, 30.3276860799011, 30.2964079559305, 
    30.2622936265489, 30.2255381637642, 30.1863253561614, 30.1448336365444, 
    30.1012312980141, 30.0556818704896, 30.0083399708654, 29.9593561165478, 
    29.9088733400139, 29.8570313456653, 29.8039640105306, 29.7498026436233, 
    29.6946741092702, 29.6387037819855, 29.5820155217195, 29.524729329067, 
    29.4669512817665, 29.4087796351903, 29.3502952781046, 29.2915711819672, 
    29.2326660156097, 29.1736317103244, 29.1145075498728, 29.0553269981176, 
    28.9961128868573, 28.936883253024, 28.8776475861465, 0.407776264215944, 
    0.407853440060481, 0.407934518744292, 0.408025401263158, 
    0.408136708886314, 0.408281556180533, 0.408478310629279, 
    0.408748067361976, 0.409117579175205, 0.409616512983326, 
    0.410280534504655, 0.411148377063909, 0.412265045607447, 
    0.413678737036017, 0.415444144446259, 0.417619241939056, 
    0.420268631436353, 0.423460280752126, 0.427268993447422, 
    0.431772699169938, 0.4370549961669, 0.443201914207485, 0.450303540549145, 
    0.458451929574881, 0.467742946681614, 0.478274349076827, 
    0.490147650196321, 0.503466414219342, 0.518338652070593, 
    0.534874605960812, 0.553188996499419, 0.573398644040522, 
    0.595624289518291, 0.619988505703885, 0.646617272136356, 
    0.675637796254157, 0.70717879032546, 0.741369288212367, 0.77833810532299, 
    0.818213308053932, 0.861120185209745, 0.907182487902602, 
    0.956520594067196, 1.00925330837079, 1.06549651558844, 1.12536529241074, 
    1.18897440308272, 1.25643844940509, 1.32787169584687, 1.40338676431739, 
    1.48309004381902, 1.56708343142808, 1.6554570894239, 1.74829440172978, 
    1.84566337364196, 1.94762254261812, 2.05420795338879, 2.16544227787083, 
    2.28131718945368, 2.40181702420237, 2.52692776741165, 2.6566412207615, 
    2.79097080224324, 2.92994183509027, 3.07360564719301, 3.22202801139924, 
    3.37530647572905, 3.53355271900597, 3.69690316809498, 3.86550503906802, 
    4.03952395678349, 4.21913411582323, 4.40452558087635, 4.5958941326681, 
    4.79344254596104, 4.99737320379761, 5.20787992830244, 5.42515069187713, 
    5.64935862894868, 5.88066358937575, 6.11918712271795, 6.3650235484519, 
    6.61819656602111, 6.87869774076034, 7.14646072160228, 7.42139397110524, 
    7.70336312273212, 7.99221569056231, 8.28776954023676, 8.58983837299877, 
    8.89824888093945, 9.21283686615376, 9.53346157990413, 9.85998785720931, 
    10.1922794189459, 10.5301990623374, 10.8736070041366, 11.2223644094621, 
    11.5763388173665, 11.9354020908827, 12.2994370150314, 12.6683315196974, 
    13.0419831922346, 13.4202961040583, 13.8031906053582, 14.190587425612, 
    14.5823925326722, 14.9785058998785, 15.3788182841414, 15.7832133722327, 
    16.1915557867981, 16.6036972561523, 17.0194569954138, 17.4386243429193, 
    17.8609016430753, 18.2859558187574, 18.7133991006497, 19.1428310977753, 
    19.5738556247042, 20.006073320686, 20.4390679181394, 20.8724110124129, 
    21.3056425574042, 21.7382905251966, 22.169866602067, 22.5998753134684, 
    23.0278088273629, 23.4531532087433, 23.8753824682171, 24.2939631416784, 
    24.708343920554, 25.11797011777, 25.5222913767152, 25.9207704297156, 
    26.312918034383, 26.6982784412771, 27.0764818474634, 27.4472003333272, 
    27.8101875660246, 28.1652317624376, 28.5121777515793, 28.8508974109685, 
    29.1813142000158, 29.5033815824263, 29.8171214571895, 30.1225866114842, 
    30.4198849499609, 30.709149539195, 30.9905589759889, 31.2643121458651, 
    31.5306435589972, 31.7898036103953, 32.0420706097633, 32.2877348816308, 
    32.5271068951363, 32.760505246302, 32.9882608940747, 33.2107091837013, 
    33.4281906427024, 33.641046640787, 33.8496167341414, 34.0542378736484, 
    34.2552384024982, 34.4529407019592, 34.6476519133053, 34.8396701150561, 
    35.02927237471, 35.2167233007076, 35.4022586762802, 35.5861039164121, 
    35.7684717883084, 35.9495694016111, 36.1295938834911, 36.3087355652056, 
    36.4871675768287, 36.6650532061243, 36.8425335727992, 37.0197373603319, 
    37.1967656753466, 37.3737043986819, 37.5506060848898), .Dim = c(181L, 
    5L), .Dimnames = list(c("6000", "6100", "6200", "6300", "6400", 
    "6500", "6600", "6700", "6800", "6900", "7000", "7100", "7200", 
    "7300", "7400", "7500", "7600", "7700", "7800", "7900", "8000", 
    "8100", "8200", "8300", "8400", "8500", "8600", "8700", "8800", 
    "8900", "9000", "9100", "9200", "9300", "9400", "9500", "9600", 
    "9700", "9800", "9900", "10000", "10100", "10200", "10300", 
    "10400", "10500", "10600", "10700", "10800", "10900", "11000", 
    "11100", "11200", "11300", "11400", "11500", "11600", "11700", 
    "11800", "11900", "12000", "12100", "12200", "12300", "12400", 
    "12500", "12600", "12700", "12800", "12900", "13000", "13100", 
    "13200", "13300", "13400", "13500", "13600", "13700", "13800", 
    "13900", "14000", "14100", "14200", "14300", "14400", "14500", 
    "14600", "14700", "14800", "14900", "15000", "15100", "15200", 
    "15300", "15400", "15500", "15600", "15700", "15800", "15900", 
    "16000", "16100", "16200", "16300", "16400", "16500", "16600", 
    "16700", "16800", "16900", "17000", "17100", "17200", "17300", 
    "17400", "17500", "17600", "17700", "17800", "17900", "18000", 
    "18100", "18200", "18300", "18400", "18500", "18600", "18700", 
    "18800", "18900", "19000", "19100", "19200", "19300", "19400", 
    "19500", "19600", "19700", "19800", "19900", "20000", "20100", 
    "20200", "20300", "20400", "20500", "20600", "20700", "20800", 
    "20900", "21000", "21100", "21200", "21300", "21400", "21500", 
    "21600", "21700", "21800", "21900", "22000", "22100", "22200", 
    "22300", "22400", "22500", "22600", "22700", "22800", "22900", 
    "23000", "23100", "23200", "23300", "23400", "23500", "23600", 
    "23700", "23800", "23900", "24000"), c("None", "Mod", "Hvy", 
    "Sev", "Ext"))), Art = structure(c(69.0871052018111, 68.6082142436367, 
    68.1272003722883, 67.6406315181392, 67.1437828967936, 66.6306301825382, 
    66.0947090573678, 65.5288998186697, 64.9259785936161, 64.2791319947164, 
    63.5819024876505, 62.8290657776095, 62.0168291366255, 61.1432396282007, 
    60.2090070513801, 59.2159870463691, 58.1686251538178, 57.0733717614361, 
    55.9362519737055, 54.7628703031559, 53.5579547393938, 52.3260344650502, 
    51.0722468656462, 49.8022746064764, 48.5232551515916, 47.2424639004998, 
    45.9672768800187, 44.7046539484943, 43.4613305321397, 42.2436196915656, 
    41.0576565612997, 39.9095227769802, 38.8049411669765, 37.7479834995991, 
    36.7410413383257, 35.7849712657561, 34.8802620873832, 34.027552051276, 
    33.2289146318397, 32.4872806574247, 31.8057057237551, 31.1866763283452, 
    30.6301322810895, 30.1336875246861, 29.6920588734952, 29.2987154622131, 
    28.9448998022678, 28.6217739610736, 28.3209006022975, 28.0357554015346, 
    27.760754924435, 27.4921288466347, 27.2272068495746, 26.9656071613477, 
    26.7080254263573, 26.4571118400334, 26.2155436754944, 25.9853822780646, 
    25.768295737898, 25.5648419528214, 25.3749678650131, 25.1980917043236, 
    25.0331102210286, 24.8787393883487, 24.7333996581972, 24.5954207049795, 
    24.4631354544676, 24.3349203302536, 24.209336753238, 24.0851621673739, 
    23.961582667907, 15.9994187209381, 16.1050561353892, 16.2108314014732, 
    16.3170392939943, 16.4241573690382, 16.5328868790965, 16.6440139348533, 
    16.7584702653138, 16.877235678438, 17.0012677311861, 17.1314866997835, 
    17.2686537912359, 17.4133263388746, 17.5658158241366, 17.7259722828032, 
    17.8933954296268, 18.0670518308929, 18.245262030466, 18.4253533960974, 
    18.6044128640089, 18.7794277219379, 18.9473033377745, 19.1055946620918, 
    19.2521292518243, 19.3849889925219, 19.5018147640805, 19.6000685773371, 
    19.6775957990195, 19.7325902487503, 19.7643247384186, 19.7728641792366, 
    19.7588400878827, 19.722874886342, 19.6651629689374, 19.5862028793567, 
    19.4872111938954, 19.3698971848946, 19.2374033549454, 19.0936599285094, 
    18.9425595997291, 18.7873755619842, 18.6310833062406, 18.4760426104802, 
    18.3243089985496, 18.1779697398356, 18.0391056993626, 17.9095888788583, 
    17.7908328730385, 17.6840171464853, 17.5899242498598, 17.5091388376722, 
    17.4417572539761, 17.3872826335488, 17.3445376965606, 17.3121202830109, 
    17.2883855811409, 17.2719245250479, 17.2616392114928, 17.2565208379719, 
    17.2556802818141, 17.2583162207553, 17.2637175112377, 17.2712913281025, 
    17.2804979628367, 17.2909100470036, 17.3021692522095, 17.3140079053153, 
    17.3261979730671, 17.3385881830246, 17.3510715641822, 17.3635907639273, 
    8.62008303325508, 8.75754920352253, 8.89545739619018, 9.03455773537336, 
    9.17591817800183, 9.32094522187568, 9.47116416807001, 9.62828591497201, 
    9.79406161175863, 9.97015621065826, 10.1581510328417, 10.3593276662691, 
    10.574611023443, 10.8044564235617, 11.0487510747481, 11.3071754968087, 
    11.5790171663238, 11.8632092755781, 12.1585279690005, 12.4637145041043, 
    12.7773819088893, 13.0977067920227, 13.4224214841763, 13.7491711522785, 
    14.0757087031168, 14.400262501309, 14.721579488783, 15.0387646158973, 
    15.351076542486, 15.6579692121128, 15.95841043751, 16.2513336639827, 
    16.5358636388651, 16.8119648129661, 17.0804983676402, 17.3424054723184, 
    17.5984766389766, 17.8488184009817, 18.0925358565149, 18.3278711849266, 
    18.5520459152, 18.762076576895, 18.9550564978396, 19.1283947404327, 
    19.2808678536528, 19.4119662096623, 19.5227051578076, 19.6148340311332, 
    19.6908544016597, 19.7536047038168, 19.8058821098441, 19.8501187046425, 
    19.8884385872947, 19.9224902903039, 19.9536017603946, 19.9822581139965, 
    20.0086632218162, 20.0328522652242, 20.0548419044369, 20.0747389147913, 
    20.0926925929168, 20.1088873237072, 20.1235368368403, 20.1368628246467, 
    20.1490954702663, 20.1604613430535, 20.1711703886643, 20.1814212008772, 
    20.1913806102208, 20.2011865122969, 20.2109282160942, 2.04615620860911, 
    2.22015390362845, 2.39483652807078, 2.57127744805422, 2.75091199499508, 
    2.93548041689062, 3.12680224873669, 3.32675785349122, 3.53714153960215, 
    3.75941606087707, 3.99483074001274, 4.24401753462967, 4.50697160673902, 
    4.78286023745589, 5.07007632663456, 5.36685407210504, 5.67134907018758, 
    5.98159549815454, 6.29624270251707, 6.61422786891068, 6.93501251892219, 
    7.25836659055401, 7.58391302590443, 7.91107818466395, 8.23884088591333, 
    8.56660747525456, 8.89417833854218, 9.22166410838913, 9.54909820093353, 
    9.87589346862323, 10.2010130418734, 10.5229558869431, 10.8402257489405, 
    11.1518700350256, 11.457550643836, 11.7572842625827, 12.0510777189383, 
    12.3384715412477, 12.6181700989088, 12.8886151853311, 13.1484059244857, 
    13.3963817545388, 13.6322553273683, 13.8564659422664, 14.0700740657963, 
    14.2743082818344, 14.4705052579191, 14.6598665418601, 14.8434149519599, 
    15.0215867764091, 15.1944614729288, 15.361322468814, 15.5214013736992, 
    15.6739366735609, 15.8181789969986, 15.953467876123, 16.0792586401648, 
    16.1953018557261, 16.3015236589074, 16.3982859289813, 16.4861786156055, 
    16.5659780178283, 16.6386235045065, 16.7051024848738, 16.7664628442846, 
    16.8237467150225, 16.8779307881426, 16.9299432503666, 16.9805707329189, 
    17.0304665268905, 17.0800557826347, 4.24723683543384, 4.30902651386429, 
    4.37167430201275, 4.43649400446839, 4.50522956119532, 4.58005729961789, 
    4.66331059098631, 4.75758614756323, 4.86558257659124, 4.99002800256501, 
    5.13362903971163, 5.29893523025352, 5.48826189431376, 5.70362788663951, 
    5.9461932644276, 6.21658795508314, 6.51395677877044, 6.83656143435759, 
    7.18362395867188, 7.55477445981278, 7.95022311084961, 8.37058881459171, 
    8.81582396217479, 9.28534680475078, 9.77720626685077, 10.2888513588508, 
    10.816896715314, 11.357321528195, 11.9059044756861, 12.4581928892756, 
    13.0100557800763, 13.5573475842076, 14.0960945588721, 14.6230186834681, 
    15.1347067708376, 15.6281278054435, 16.1002863698032, 16.547754651545, 
    16.9667194842228, 17.3536733725838, 17.70646687457, 18.0237820339752, 
    18.3065132832169, 18.5571427940594, 18.7790294672138, 18.975904346921, 
    19.1523009031403, 19.3126925928871, 19.4608128975898, 19.5991288683716, 
    19.7297626551113, 19.8546727259237, 19.9756705558733, 20.0934281782172, 
    20.2080735332288, 20.3187765886964, 20.4246099374668, 20.5248243894829, 
    20.6188178607767, 20.7064529215834, 20.7878447057017, 20.8633254428967, 
    20.9334381095167, 20.9987973392903, 21.060131980246, 21.1182019847346, 
    21.1737554634118, 21.2275172454393, 21.2801237206037, 21.3321132292649, 
    21.3838425694476), .Dim = c(71L, 5L), .Dimnames = list(c("2000", 
    "2100", "2200", "2300", "2400", "2500", "2600", "2700", "2800", 
    "2900", "3000", "3100", "3200", "3300", "3400", "3500", "3600", 
    "3700", "3800", "3900", "4000", "4100", "4200", "4300", "4400", 
    "4500", "4600", "4700", "4800", "4900", "5000", "5100", "5200", 
    "5300", "5400", "5500", "5600", "5700", "5800", "5900", "6000", 
    "6100", "6200", "6300", "6400", "6500", "6600", "6700", "6800", 
    "6900", "7000", "7100", "7200", "7300", "7400", "7500", "7600", 
    "7700", "7800", "7900", "8000", "8100", "8200", "8300", "8400", 
    "8500", "8600", "8700", "8800", "8900", "9000"), c("None", 
    "Mod", "Hvy", "Sev", "Ext")))), .Names = c("Fwy", "Art")), 
        Vht = structure(list(Fwy = structure(c(86.2890193016807, 
        85.9941658733275, 85.699245541187, 85.4041615897466, 
        85.1087513916898, 84.8128212201638, 84.5161188619742, 
        84.2183648881298, 83.9192294927934, 83.618359897995, 
        83.3153618140782, 83.0098225842829, 82.7012975951201, 
        82.389328728085, 82.0734358013377, 81.753130466858, 81.4279137752389, 
        81.0972835737501, 80.7607354977538, 80.4177734926468, 
        80.067936955872, 79.7107785070153, 79.3458682021889, 
        78.9727828725085, 78.591109012577, 78.2004424050012, 
        77.8004063209181, 77.3906282639626, 76.9707251792326, 
        76.540307181596, 76.0989676235389, 75.646295674528, 75.1818805343352, 
        74.7053145132389, 74.2162023332372, 73.7141607634376, 
        73.1988423496635, 72.6699230803073, 72.127136937322, 
        71.5702547902152, 70.9991370651523, 70.4136897541748, 
        69.8139115561709, 69.199842185137, 68.5715927086563, 
        67.9293088953275, 67.2732039642241, 66.6035254943417, 
        65.9205910538899, 65.2247571573478, 64.5164661150582, 
        63.796182489408, 63.0643740550953, 62.321523899347, 61.5681731471919, 
        60.8049013406314, 60.032383651755, 59.251345389172, 58.4626167774831, 
        57.6670640419505, 56.86559249449, 56.0591223118231, 55.24859404324, 
        54.4349482478991, 53.6191051518641, 52.8019660415372, 
        51.9843767777681, 51.1671537639727, 50.3510509993839, 
        49.5367878682583, 48.7250076991304, 47.9163127149911, 
        47.1112167723774, 46.3101925963985, 45.5136367529051, 
        44.7219036690146, 43.9352553761694, 43.153907768372, 
        42.3779845855394, 41.6075744741353, 40.8427178608947, 
        40.0834349612726, 39.3297133653344, 38.581526007348, 
        37.8388198237824, 37.101541285596, 36.3696609995024, 
        35.6431693890713, 34.9221120095407, 34.2065504666654, 
        33.4965554365992, 32.7922049520378, 32.0935974014471, 
        31.4008490814226, 30.7141275653077, 30.0336212920404, 
        29.3595508861872, 28.6921425641279, 28.0316127238653, 
        27.3781703248632, 26.7320043908076, 26.0933056368575, 
        25.4622914798425, 24.8391816772248, 24.2241786473269, 
        23.6174834716322, 23.0193092234097, 22.4298738677819, 
        21.8494029455001, 21.2781274928222, 20.7162929524042, 
        20.1641525464109, 19.6219762086453, 19.0900506792269, 
        18.5687132119038, 18.0583166247578, 17.5592254795773, 
        17.071788355487, 16.5962781572518, 16.1329359176009, 
        15.6819508554804, 15.243489853282, 14.8176822609625, 
        14.4046401530061, 14.0044440344412, 13.6171600741231, 
        13.2428286656708, 12.8814766654176, 12.5331025557901, 
        12.1976921115004, 11.8752086503104, 11.5656037887812, 
        11.2688047956238, 10.9847223319159, 10.7132249760545, 
        10.4541603150974, 10.2073340534275, 9.97253235195793, 
        9.74950508039758, 9.53798607750304, 9.33768134942624, 
        9.14828458153539, 8.96946800866857, 8.8008943319132, 
        8.64220956788426, 8.49305300247007, 8.35305368312449, 
        8.22183688656191, 8.09902304497321, 7.98423143399433, 
        7.87708154756512, 7.77719321967146, 7.68418742617944, 
        7.59768629554718, 7.51731542472061, 7.44270295930323, 
        7.37348377104113, 7.30929671072576, 7.24978981918759, 
        7.19461627921113, 7.14344065135822, 7.09593365285387, 
        7.05177924979837, 7.01066842152169, 6.97230695139717, 
        6.93640837140996, 6.90270240394906, 6.87092709051931, 
        6.84083755868519, 6.81219843700482, 6.78479527195119, 
        6.75842453776485, 6.73290550184179, 6.70806894877438, 
        6.683768938785, 6.65987135090658, 6.63626606378417, 6.61285510595673, 
        6.5895651059267, 6.56633515962025, 6.54312963269463, 
        7.98354465131721, 8.09509981207647, 8.20667491548066, 
        8.31829802926118, 8.430014322227, 8.54187630580358, 8.65394876080486, 
        8.76630144746475, 8.87901177430854, 8.99215980532186, 
        9.1058285780402, 9.22010143896142, 9.33505999688312, 
        9.4507838293735, 9.56734612678345, 9.68481561276226, 
        9.80324953137018, 9.92269845881384, 10.0431977794744, 
        10.1647719727901, 10.2874170902536, 10.4111209465782, 
        10.535866837307, 10.6616378066224, 10.7884204124364, 
        10.9162012129545, 11.0449632538269, 11.1746876807482, 
        11.3053515521458, 11.4369290002485, 11.5693865397587, 
        11.7026856930288, 11.8367756305385, 11.971598126411, 
        12.1070777212157, 12.2431304020686, 12.379655175826, 
        12.5165428410288, 12.6536683432189, 12.7908996645841, 
        12.9280927868938, 13.0650972320207, 13.201748682668, 
        13.3378769985492, 13.4733025865889, 13.6078396535531, 
        13.7412870583627, 13.8734397130261, 14.0040920897481, 
        14.1330390530626, 14.2600774766249, 14.38500806182, 14.5076448118323, 
        14.6278077840999, 14.7453279512762, 14.860036372405, 
        14.9717535368772, 15.0802924839633, 15.1854470221063, 
        15.287000249286, 15.3847116524576, 15.4783256201895, 
        15.5675497585279, 15.6520733091157, 15.7315488385025, 
        15.8056126850343, 15.8738729493351, 15.9359270183809, 
        15.9913576622766, 16.0397600288613, 16.0807933937797, 
        16.1141572801748, 16.1396480733757, 16.1571072973738, 
        16.1664601686256, 16.1676792091051, 16.1608424703927, 
        16.1460696675048, 16.123541639598, 16.0934588627582, 
        16.0560392366519, 16.0115110080018, 15.9601263881763, 
        15.9021494568019, 15.8378678018908, 15.767574267472, 
        15.6915592132563, 15.6101021956343, 15.5234420420351, 
        15.4318010529335, 15.3353761499485, 15.2343527028522, 
        15.1288952528846, 15.0191605189036, 14.9052947587708, 
        14.7874420301253, 14.6657480507148, 14.5403640797528, 
        14.4114618822097, 14.2792263161212, 14.1438741060295, 
        14.0056348382255, 13.8647576794894, 13.7214994919223, 
        13.57612833842, 13.4289222521694, 13.2801879467255, 13.130239997796, 
        12.97939574933, 12.8279735660921, 12.6762931278665, 12.5246743043079, 
        12.3734364095323, 12.2228976722029, 12.0733725347073, 
        11.9251714937933, 11.7785930499231, 11.6339259010971, 
        11.4914315317552, 11.3513591430585, 11.2139360166159, 
        11.0793796338872, 10.947890195289, 10.8196574493226, 
        10.6948466178723, 10.5736098379982, 10.4560714340808, 
        10.3423413550807, 10.2324998609582, 10.1266147157697, 
        10.0247333889566, 9.92689551291197, 9.83312966645139, 
        9.7434577001508, 9.65788560520559, 9.57640919463429, 
        9.49899942812856, 9.42561555626466, 9.35619484648391, 
        9.29066482453774, 9.22893603255289, 9.1709115762338, 
        9.11648179922053, 9.06553165113552, 9.01793726759517, 
        8.97357074754915, 8.93229685728627, 8.89397709296701, 
        8.85846720289937, 8.82562020686302, 8.7952839583765, 
        8.76730573291449, 8.74153566003702, 8.71782612619961, 
        8.69603569135415, 8.67602598468259, 8.65766473879062, 
        8.64082286459432, 8.62537788282755, 8.61121067165584, 
        8.59820892915339, 8.5862638084169, 8.57527346272437, 
        8.56513956530185, 8.55577086898637, 8.54707967172107, 
        8.5389853722628, 8.53141090652549, 8.52428625823778, 
        8.51754496636105, 8.51112774297289, 8.50497886617446, 
        8.49904970504508, 8.49329512316695, 8.48767687115573, 
        8.4821600956266, 8.47671664015929, 8.4713216436416, 8.46595672922914, 
        8.46060672235204, 8.45526277327072, 2.46650710139965, 
        2.57308098083169, 2.6796752962074, 2.78631936013819, 
        2.89306184184763, 2.9999603052724, 3.10708853658934, 
        3.21452761475665, 3.32237156761768, 3.4307200243447, 
        3.53968207054037, 3.64937059916013, 3.75990427614, 3.87140371322886, 
        3.98399153244656, 4.09779029788038, 4.21292033161635, 
        4.32950003535357, 4.44764237124478, 4.56745438881777, 
        4.68902492664702, 4.81243599485223, 4.93776050068714, 
        5.06506773256977, 5.19442160644113, 5.32588178452324, 
        5.45949628663911, 5.59531083124008, 5.7333735736898, 
        5.87373455905116, 6.01644895427162, 6.16157314368681, 
        6.30916325930043, 6.45927431796946, 6.6119571282958, 
        6.76725849033443, 6.9252133782078, 7.08584849196236, 
        7.24916926127333, 7.41516653101142, 7.58379407720039, 
        7.75498730308353, 7.92864518962893, 8.10465036780698, 
        8.28285649087241, 8.46310530153561, 8.64521987804538, 
        8.82901062452899, 9.0142559130895, 9.20071997140267, 
        9.38814248145942, 9.57626892752403, 9.76489254863917, 
        9.95382433124465, 10.1428984965905, 10.3319587275458, 
        10.5208633186445, 10.7094762221315, 10.8976694094288, 
        11.0853114614785, 11.2722493781264, 11.4583088138787, 
        11.6432516229801, 11.8268067298009, 12.0086351394752, 
        12.1883645100045, 12.3655570300958, 12.5397477304945, 
        12.7104284793947, 12.8770736142982, 13.03913051249, 13.1960444131486, 
        13.3472789632447, 13.4923123891184, 13.6306628267969, 
        13.7618742116785, 13.8855537669591, 14.0013420518928, 
        14.1089496821702, 14.2081309562688, 14.2987448473784, 
        14.3807083804189, 14.4540661125176, 14.5189189175391, 
        14.5754654040882, 14.6239432839208, 14.6646489466549, 
        14.6979000859058, 14.7240409334135, 14.7434210789321, 
        14.7563850061468, 14.763268786294, 14.7643799468838, 
        14.7600123371874, 14.7504336372449, 14.7359006503114, 
        14.7166528417321, 14.6929208657095, 14.6649174697843, 
        14.6328524492954, 14.5969416974363, 14.5574004200779, 
        14.514434975945, 14.4682484306582, 14.4190395245684, 
        14.3670082758177, 14.3123641389843, 14.2553151126504, 
        14.1960539349802, 14.1347653047825, 14.071617023864, 
        14.0067697197303, 13.9403722196851, 13.8725674056357, 
        13.8034861781057, 13.7332506088663, 13.6619594360609, 
        13.5897007157244, 13.5165431090841, 13.4425488779213, 
        13.3677740810407, 13.2922734237769, 13.2161024005599, 
        13.1393158910789, 13.0619655269653, 12.9841015038081, 
        12.9057715210836, 12.8270240038278, 12.7479127754279, 
        12.6684964033269, 12.5888470328403, 12.5090416021502, 
        12.4291626430319, 12.3492934320818, 12.2695146315851, 
        12.189903634061, 12.1105273672737, 12.0314481637324, 
        11.9527204396824, 11.874396472683, 11.7965279018139, 
        11.7191657681636, 11.6423593593354, 11.5661544980495, 
        11.4905849009788, 11.4156791479653, 11.3414573775735, 
        11.2679360160028, 11.1951250812696, 11.1230321645042, 
        11.0516615574755, 10.9810146426724, 10.9110844648254, 
        10.8418597860628, 10.773320575862, 10.7054431190687, 
        10.6381977546527, 10.5715523593473, 10.5054709068148, 
        10.4399159894135, 10.3748485773546, 10.3102293926611, 
        10.24601978675, 10.1821820037831, 10.1186812295077, 10.0554846103557, 
        9.99256419391159, 9.92989526241494, 9.86746113557154, 
        9.80524676036069, 9.74323555538923, 9.68140961334465, 
        9.61974725160961, 9.55822566671368, 9.49682134707892, 
        9.43551089733268, 9.37427209503112, 9.31308384349453, 
        9.25192837617089, 9.19079014689555, 9.12965916092561, 
        2.16075825083516, 2.22829665322913, 2.29585384572758, 
        2.36345748429628, 2.43115538580753, 2.49900535018184, 
        2.56708494862598, 2.63548142537993, 2.70430094553027, 
        2.7736588408822, 2.84368818926879, 2.91453057261806, 
        2.98634384320992, 3.05929356698603, 3.13355989418301, 
        3.20932974063195, 3.2868025002468, 3.3661833874322, 3.44768842047277, 
        3.53153689689426, 3.61795042730708, 3.70714908509459, 
        3.79934448164725, 3.89474320725516, 3.99354022979995, 
        4.09592364894177, 4.20206571386349, 4.31213650478735, 
        4.4263132765702, 4.54477863043274, 4.66772937841623, 
        4.79536809629287, 4.92790620393797, 5.06555893539461, 
        5.20854793727359, 5.35709516282284, 5.51141737927115, 
        5.67172623909212, 5.83821812175786, 6.01107830512266, 
        6.190462933571, 6.37651323009791, 6.56933986561056, 6.76903997004611, 
        6.97568706154979, 7.18934090512895, 7.4100298650316, 
        7.6377652745739, 7.87252174410415, 8.11425225082026, 
        8.36285996228661, 8.61822574996054, 8.88019111050484, 
        9.14857248211611, 9.42312544392048, 9.70357725955466, 
        9.98960278976802, 10.2808562127962, 10.5769613797072, 
        10.8775371174927, 11.1822124840077, 11.4906320166561, 
        11.8024919401752, 12.1175225134965, 12.4355384449956, 
        12.7563990919066, 13.0800579574524, 13.4065113411245, 
        13.7358325814995, 14.0681155165949, 14.4034589431067, 
        14.7419471304817, 15.0836012804907, 15.4284095248023, 
        15.7762907823533, 16.1271298953408, 16.4807446117351, 
        16.8369311798303, 17.1954669434411, 17.5561218390403, 
        17.9186550782127, 18.2828250096169, 18.648397255094, 
        19.0151426110593, 19.3828452990432, 19.7512925162927, 
        20.1202699378064, 20.4895657095751, 20.8589793838082, 
        21.2283123560385, 21.5973619888747, 21.9659199044323, 
        22.3337587957784, 22.7006392632265, 23.0662924651228, 
        23.4304341887045, 23.7927481787387, 24.1529051972054, 
        24.5105561174081, 24.8653328177078, 25.216811085374, 
        25.5645359764162, 25.9079857128939, 26.2466142614253, 
        26.5798454008126, 26.9070836324803, 27.227686536158, 
        27.5409992611635, 27.8463641568606, 28.1431240787044, 
        28.4306267064691, 28.708225439568, 28.9752917316523, 
        29.2312185701544, 29.4754670233912, 29.7075409381511, 
        29.9270471942228, 30.1336489843703, 30.3271317202574, 
        30.5073375874979, 30.6742136486038, 30.8277571267638, 
        30.9680610109757, 31.0952617985292, 31.2095742540736, 
        31.3112499160748, 31.4006091509046, 31.4780069520144, 
        31.5438679932691, 31.5986477135121, 31.642854931089, 
        31.6770164343767, 31.7016775123754, 31.7173861497258, 
        31.7246826130066, 31.7240988462565, 31.7161412214177, 
        31.7013029059854, 31.6800498217648, 31.6528367908222, 
        31.6201014819585, 31.5822724171815, 31.5397586845928, 
        31.4929553470759, 31.4422208005501, 31.3878958417161, 
        31.3302875373645, 31.2696864316247, 31.2063507078919, 
        31.1405227318067, 31.0724139587278, 31.0022226867077, 
        30.9301254948567, 30.8562893133687, 30.7808641957149, 
        30.7039921903078, 30.6258002020496, 30.5464082086427, 
        30.4659236224999, 30.3844482106312, 30.302073723725, 
        30.2188875831085, 30.1349699089861, 30.0503978929642, 
        29.9652443133785, 29.87958036653, 29.7934753338532, 29.7069985945498, 
        29.6202218337591, 29.5332145138115, 29.4460348998661, 
        29.3587348531433, 29.2713518162805, 29.183917084694, 
        29.0964517834995, 29.0089726052031, 28.9214886821747, 
        28.834006117878, 28.7465264602884, 28.6590497597056, 
        28.5715746312143, 1.10017069450596, 1.10935668028489, 
        1.11855040115813, 1.12776353632955, 1.13701705821079, 
        1.14633681837203, 1.15575889181005, 1.16532462408395, 
        1.1750862195756, 1.18510143129205, 1.19543934791837, 
        1.20617480483329, 1.21739428851224, 1.22919016220135, 
        1.24166664513308, 1.25493388176, 1.26911386142879, 1.28433454455948, 
        1.30073593097135, 1.31846324877561, 1.33767059985202, 
        1.35851546639821, 1.38115997811476, 1.40576838099528, 
        1.43250873870247, 1.4615509485417, 1.49306842471999, 
        1.52723671923417, 1.56423641833856, 1.60425062865275, 
        1.64746750399969, 1.69407739245231, 1.74427437187997, 
        1.79825410698132, 1.85621487997584, 1.91835518133715, 
        1.98487171703471, 2.05595934761482, 2.13180733643527, 
        2.21260070907592, 2.29851313719353, 2.38971248063558, 
        2.48635470593559, 2.58859047847603, 2.69656115234912, 
        2.8104052444724, 2.93025923435481, 3.05625889354872, 
        3.18853919918851, 3.32723156738745, 3.47245396459223, 
        3.62431477130927, 3.78289747395045, 3.9482715032147, 
        4.1204749610435, 4.29952629988584, 4.485396702978, 4.67802969195973, 
        4.8773054112973, 5.08308712981474, 5.29523399094051, 
        5.51361123747458, 5.73811263509848, 5.96864919970914, 
        6.20517242518334, 6.44765767153771, 6.69613528536836, 
        6.95066014604644, 7.21133027746355, 7.47826297200498, 
        7.75160945151008, 8.0315384612197, 8.31825491052658, 
        8.61197819232108, 8.91294946933221, 9.22141301487311, 
        9.53760377475479, 9.86174933240993, 10.19405714926, 10.5347138678049, 
        10.8838429768685, 11.2415206406946, 11.607696878881, 
        11.9822630072536, 12.3650016711957, 12.7556486467172, 
        13.1538609027771, 13.5592626198089, 13.9714256311961, 
        14.3899150454223, 14.8143214184208, 15.2442536543719, 
        15.6793686029923, 16.1193387992443, 16.5638515735364, 
        17.0126018387992, 17.4653000426062, 17.9216672931815, 
        18.3814518067082, 18.8444180919865, 19.310368720325, 
        19.7791231283937, 20.2505301517986, 20.7244561387374, 
        21.2008080888388, 21.6795023678659, 22.1604521546867, 
        22.6435717605713, 23.1287832132912, 23.6160095575597, 
        24.105170189356, 24.5961779899418, 25.0889234304429, 
        25.5832656727372, 26.0789610518482, 26.5757203343869, 
        27.0731748401706, 27.5709360432753, 28.068615481605, 
        28.5658184738743, 29.0621253982116, 29.5570999622419, 
        30.0502641321644, 30.5411247080143, 31.0291695665983, 
        31.5138786679462, 31.9947192282102, 32.471151023609, 
        32.9426168145039, 33.4085490558396, 33.8683559967521, 
        34.3214426617278, 34.7672253824647, 35.2051403860721, 
        35.6346921740938, 36.0554280098955, 36.4669979296962, 
        36.8691010220019, 37.2615298116122, 37.6441158343934, 
        38.0167532341862, 38.3793656568215, 38.7319321481166, 
        39.0744641717576, 39.4070474629209, 39.7298012602261, 
        40.0429045445753, 40.3465635727647, 40.6410339628839, 
        40.9265934627465, 41.2035589777663, 41.4722637179415, 
        41.733066954005, 41.9863384787209, 42.2324641122431, 
        42.4718357465277, 42.7048535333508, 42.9319198565695, 
        43.153437768544, 43.3698088489562, 43.5814281182704, 
        43.7886855628147, 43.9919575915892, 44.1916121162698, 
        44.3879966365632, 44.5814469798082, 44.7722726958399, 
        44.9607681457982, 45.1471932135451, 45.3317953222513, 
        45.5148065296003, 45.6964521293424, 45.8769457249825, 
        46.0564931763999, 46.2352810592191, 46.4134850506584, 
        46.591256518567, 46.7687332887341, 46.9460233280785, 
        47.1232182111087, 47.3003738015654), .Dim = c(181L, 5L
        ), .Dimnames = list(c("6000", "6100", "6200", "6300", 
        "6400", "6500", "6600", "6700", "6800", "6900", "7000", 
        "7100", "7200", "7300", "7400", "7500", "7600", "7700", 
        "7800", "7900", "8000", "8100", "8200", "8300", "8400", 
        "8500", "8600", "8700", "8800", "8900", "9000", "9100", 
        "9200", "9300", "9400", "9500", "9600", "9700", "9800", 
        "9900", "10000", "10100", "10200", "10300", "10400", 
        "10500", "10600", "10700", "10800", "10900", "11000", 
        "11100", "11200", "11300", "11400", "11500", "11600", 
        "11700", "11800", "11900", "12000", "12100", "12200", 
        "12300", "12400", "12500", "12600", "12700", "12800", 
        "12900", "13000", "13100", "13200", "13300", "13400", 
        "13500", "13600", "13700", "13800", "13900", "14000", 
        "14100", "14200", "14300", "14400", "14500", "14600", 
        "14700", "14800", "14900", "15000", "15100", "15200", 
        "15300", "15400", "15500", "15600", "15700", "15800", 
        "15900", "16000", "16100", "16200", "16300", "16400", 
        "16500", "16600", "16700", "16800", "16900", "17000", 
        "17100", "17200", "17300", "17400", "17500", "17600", 
        "17700", "17800", "17900", "18000", "18100", "18200", 
        "18300", "18400", "18500", "18600", "18700", "18800", 
        "18900", "19000", "19100", "19200", "19300", "19400", 
        "19500", "19600", "19700", "19800", "19900", "20000", 
        "20100", "20200", "20300", "20400", "20500", "20600", 
        "20700", "20800", "20900", "21000", "21100", "21200", 
        "21300", "21400", "21500", "21600", "21700", "21800", 
        "21900", "22000", "22100", "22200", "22300", "22400", 
        "22500", "22600", "22700", "22800", "22900", "23000", 
        "23100", "23200", "23300", "23400", "23500", "23600", 
        "23700", "23800", "23900", "24000"), c("None", "Mod", 
        "Hvy", "Sev", "Ext"))), Art = structure(c(46.6279268242458, 
        46.1754772427973, 45.7210620671787, 45.261512635223, 
        44.7924786925762, 44.3084407202089, 43.8034911055796, 
        43.2711628308125, 42.7049313652028, 42.0987196068231, 
        41.4468132232279, 40.7447167193438, 39.9893225042983, 
        39.1792952005624, 38.315824617502, 37.4011789052716, 
        36.4400252172885, 35.4389419061304, 34.4046261057957, 
        33.3436200780886, 32.2621210269298, 31.1664507454787, 
        30.0633964812888, 28.9600260969303, 27.8639606447721, 
        26.7824602947557, 25.7224023578099, 24.6897854251866, 
        23.6901901389302, 22.728360016182, 21.8085779126225, 
        20.9346169982484, 20.1097964795205, 19.3359247039654, 
        18.6135365126601, 17.9419534111918, 17.3201683587455, 
        16.7471292852582, 16.2226920327015, 15.7472449888782, 
        15.321280374482, 14.9449472350698, 14.6168144722679, 
        14.3339844365821, 14.0917748723361, 13.8847391835819, 
        13.7060866694517, 13.5490733120715, 13.4073178819778, 
        13.2757574118116, 13.1499741075999, 13.0268224767355, 
        12.9039943328948, 12.780843585537, 12.657508129289, 12.5355646842297, 
        12.4166410656208, 12.3020357440702, 12.1928410489507, 
        12.0895536995785, 11.9923391078746, 11.9010720993738, 
        11.8153338244667, 11.7346007408246, 11.6581720024335, 
        11.5852840140322, 11.5151530678075, 11.44700806372, 11.3801535724943, 
        11.3139934105933, 11.2481273462716, 25.9928160235923, 
        26.0480544904204, 26.1029474076735, 26.1570495589148, 
        26.2098587894705, 26.2608672691643, 26.3095740106011, 
        26.3555047805675, 26.3982050159499, 26.4372373439168, 
        26.4721703105142, 26.5025749890321, 26.5280157365926, 
        26.5480858538312, 26.5622681910795, 26.5699281669644, 
        26.5700617147013, 26.5612019468905, 26.5407782857372, 
        26.506008073872, 26.4542785415975, 26.383156704489, 26.2915775068435, 
        26.1790467204193, 26.0457203217807, 25.891100084173, 
        25.7144004367389, 25.5151377005733, 25.2931704005139, 
        25.04950509515, 24.7860025069838, 24.5050735912118, 24.2089859916475, 
        23.8990470233889, 23.5766014899052, 23.243538772903, 
        22.9022492139716, 22.556798924763, 22.2123376539235, 
        21.873975154975, 21.5458920789575, 21.2317446688164, 
        20.933925848413, 20.6540650895478, 20.39338882567, 20.1529367953573, 
        19.9332025252074, 19.7341440216375, 19.555530837667, 
        19.3969622834449, 19.2579357840604, 19.1376074128273, 
        19.0346202487987, 18.9472047457403, 18.8735054938157, 
        18.8117113246062, 18.7603439099488, 18.7182630537611, 
        18.6843972742535, 18.6576866870643, 18.6371061462809, 
        18.621678484944, 18.6105111883182, 18.6027564714079, 
        18.5976720816863, 18.5945920742145, 18.5929661342703, 
        18.5922998105254, 18.5922195287282, 18.592435246973, 
        18.5927714912885, 14.8200239565417, 14.9594973918638, 
        15.0992383005178, 15.2397439152339, 15.381761578035, 
        15.5263172866218, 15.6745353282122, 15.8276931463645, 
        15.9870965008687, 16.1539609145856, 16.3294203942114, 
        16.5143268125661, 16.7092022225668, 16.9141362827065, 
        17.1287709775871, 17.352614923914, 17.5849948666197, 
        17.8250132178269, 18.0713918254889, 18.3227180711702, 
        18.5772646148894, 18.8326465736412, 19.0860326008427, 
        19.3346160111051, 19.5761333798615, 19.8091067291409, 
        20.0329217822705, 20.2475533896847, 20.4532278511851, 
        20.6505288185731, 20.8393788022618, 21.0197119859687, 
        21.1916835945563, 21.3563264887787, 21.5156417695225, 
        21.6715402468279, 21.8257050841904, 21.9790358104847, 
        22.1314260186592, 22.2817990686538, 22.4277473617069, 
        22.5664627003136, 22.6946751414247, 22.8090302513996, 
        22.9072676986269, 22.9877532380604, 23.0502803941247, 
        23.0955162968518, 23.1251224210904, 23.1415247346852, 
        23.1472640806152, 23.1447369571262, 23.1361477414019, 
        23.1235021175531, 23.1085903533372, 23.092484150606, 
        23.0759047795454, 23.0592432130364, 23.0427904926109, 
        23.0267351791513, 23.0112018235382, 22.9962584073163, 
        22.9819124229326, 22.9681484053569, 22.9549093431346, 
        22.9421199000918, 22.9296904298079, 22.9175283776899, 
        22.905543574698, 22.8936559231461, 22.8818098710743, 
        3.96357831573405, 4.19835609116131, 4.43401546515723, 
        4.67192826017114, 4.91391556372219, 5.16215345230666, 
        5.41889860814429, 5.68643301676354, 5.96688399928229, 
        6.26187600651859, 6.57272056946832, 6.89984692403275, 
        7.24279278354265, 7.59993994873449, 7.96866272337072, 
        8.34617210024685, 8.72975551875069, 9.11663566550297, 
        9.50467470810414, 9.89202840705152, 10.2773797232136, 
        10.6597345027492, 11.0379956572829, 11.4109184957942, 
        11.7770400602358, 12.1357281083346, 12.4871186081209, 
        12.8319705065626, 13.1710067656015, 13.5042260640595, 
        13.8310938958979, 14.1505831604051, 14.461684424319, 
        14.7640139984995, 15.0578803542437, 15.3439442836904, 
        15.6228361075488, 15.8946334746632, 16.1584734562007, 
        16.413205556131, 16.6577826547926, 16.8913486413176, 
        17.113768710454, 17.3255038183596, 17.5274279612961, 
        17.7204697924325, 17.9054250304207, 18.0829557883579, 
        18.2536105895897, 18.4175410740885, 18.5746063474983, 
        18.7239388475975, 18.8647054124161, 18.9963347688188, 
        19.1183934906785, 19.2307683786659, 19.3334292893658, 
        19.4265302698338, 19.5103451839468, 19.585444716964, 
        19.6525474099116, 19.712486381232, 19.7661821075259, 
        19.8145748308723, 19.8586147749555, 19.8992251128523, 
        19.9372487337531, 19.9734780416209, 20.008570847771, 
        20.0430673504046, 20.0773150864859, 8.59565487993348, 
        8.61861478379844, 8.64273675950811, 8.66976563048672, 
        8.70198537622017, 8.74222127171725, 8.79350094747704, 
        8.85920622550177, 8.94288311870239, 9.04820612815864, 
        9.17887550257812, 9.33853455502294, 9.53066675299555, 
        9.75854271415993, 10.0244734904542, 10.3301059035959, 
        10.6751626826322, 11.0582072636414, 11.4785290748663, 
        11.9356253698102, 12.4289560933627, 12.9580114736351, 
        13.5209977537357, 14.115392675745, 14.7371455933442, 
        15.3816047835905, 16.0431568150547, 16.715552977988, 
        17.3924048437649, 18.0673800060312, 18.7349468822301, 
        19.3900142641622, 20.027849509953, 20.6446877853639, 
        21.2363398736647, 21.7990232853831, 22.3290412355397, 
        22.8224025048267, 23.2750708385107, 23.6837752313574, 
        24.0472975300561, 24.3654967544773, 24.640815827435, 
        24.8774164041051, 25.0801406420646, 25.2541009905612, 
        25.4050053807885, 25.5383105810738, 25.6584182696672, 
        25.7682144959615, 25.8702196802174, 25.9668943057043, 
        26.0605322644791, 26.1521147823411, 26.2420025328697, 
        26.3294714618822, 26.4136809555093, 26.4939277192888, 
        26.569626000229, 26.6405797172333, 26.706805512387, 26.7685046271272, 
        26.8260604567512, 26.8799195515343, 26.9306317977877, 
        26.9787788988087, 27.0249416343627, 27.0696857064475, 
        27.1135124763146, 27.1568480688913, 27.1999762048904), .Dim = c(71L, 
        5L), .Dimnames = list(c("2000", "2100", "2200", "2300", 
        "2400", "2500", "2600", "2700", "2800", "2900", "3000", 
        "3100", "3200", "3300", "3400", "3500", "3600", "3700", 
        "3800", "3900", "4000", "4100", "4200", "4300", "4400", 
        "4500", "4600", "4700", "4800", "4900", "5000", "5100", 
        "5200", "5300", "5400", "5500", "5600", "5700", "5800", 
        "5900", "6000", "6100", "6200", "6300", "6400", "6500", 
        "6600", "6700", "6800", "6900", "7000", "7100", "7200", 
        "7300", "7400", "7500", "7600", "7700", "7800", "7900", 
        "8000", "8100", "8200", "8300", "8400", "8500", "8600", 
        "8700", "8800", "8900", "9000"), c("None", "Mod", "Hvy", 
        "Sev", "Ext")))), .Names = c("Fwy", "Art"))), .Names = c("Dvmt", 
    "Vht")), BaseSpeeds.. = structure(list(Fwy = c(60, 50.36255624, 
    44.03689561, 34.34615737, 23.51622608), Art = c(30, 24.86768085, 
    23.48945758, 22.30139427, 20.6481415), Fwy_Rcr = c(60, 56.20333333, 
    53.1687124, 47.35065175, 38.80755976), Art_Rcr = c(30, 29.41128249, 
    28.46025459, 27.66318932, 26.43483688)), .Names = c("Fwy", 
    "Art", "Fwy_Rcr", "Art_Rcr"), class = "data.frame", row.names = c("None", 
    "Mod", "Hvy", "Sev", "Ext")), OpsDelayReduce_ = structure(list(
        Ramp = structure(list(Fwy_Rcr = c(0, 0, 2.8, 5.6, 6.3
        ), Fwy_NonRcr = c(0, 0, 2.8, 5.6, 6.3), Art_Rcr = c(0L, 
        0L, 0L, 0L, 0L), Art_NonRcr = c(0L, 0L, 0L, 0L, 0L)), .Names = c("Fwy_Rcr", 
        "Fwy_NonRcr", "Art_Rcr", "Art_NonRcr"), class = "data.frame", row.names = c("None", 
        "Mod", "Hvy", "Sev", "Ext")), Incident = structure(list(
            Fwy_Rcr = c(0L, 0L, 0L, 0L, 0L), Fwy_NonRcr = c(0, 
            13.2, 14.9, 16.5, 18.9), Art_Rcr = c(0L, 0L, 0L, 
            0L, 0L), Art_NonRcr = c(0L, 0L, 0L, 0L, 0L)), .Names = c("Fwy_Rcr", 
        "Fwy_NonRcr", "Art_Rcr", "Art_NonRcr"), class = "data.frame", row.names = c("None", 
        "Mod", "Hvy", "Sev", "Ext")), Signal = structure(list(
            Fwy_Rcr = c(0L, 0L, 0L, 0L, 0L), Fwy_NonRcr = c(0L, 
            0L, 0L, 0L, 0L), Art_Rcr = c(0, 10.3, 10.1, 7.7, 
            5.2), Art_NonRcr = c(0L, 0L, 0L, 0L, 0L)), .Names = c("Fwy_Rcr", 
        "Fwy_NonRcr", "Art_Rcr", "Art_NonRcr"), class = "data.frame", row.names = c("None", 
        "Mod", "Hvy", "Sev", "Ext")), Access = structure(list(
            Fwy_Rcr = c(0L, 0L, 0L, 0L, 0L), Fwy_NonRcr = c(0L, 
            0L, 0L, 0L, 0L), Art_Rcr = c(0, 0, -2.2, -4.5, -6.7
            ), Art_NonRcr = c(0, 8, 8, 9.8, 9.8)), .Names = c("Fwy_Rcr", 
        "Fwy_NonRcr", "Art_Rcr", "Art_NonRcr"), class = "data.frame", row.names = c("None", 
        "Mod", "Hvy", "Sev", "Ext"))), .Names = c("Ramp", "Incident", 
    "Signal", "Access")), AveOpsDeploy.. = structure(list(Ramp = c(0, 
    0.03, 0.43, 0.41), Incident = c(0.67, 0.43, 0.69, 0.78), 
        Signal = c(0.33, 0.5, 0.41, 0.43), Access = c(0.28, 0.42, 
        0.49, 0.46)), .Names = c("Ramp", "Incident", "Signal", 
    "Access"), class = "data.frame", row.names = c("Small", "Medium", 
    "Large", "VeryLarge")), AdvVehFsc.. = structure(list(AdvVehType = structure(c(5L, 
    5L, 5L, 5L, 4L, 4L, 4L, 4L, 2L, 2L, 2L, 2L, 3L, 3L, 3L, 3L, 
    1L, 1L, 1L, 1L), .Label = c("HdIce", "LdEv", "LdFcv", "LdHev", 
    "LdIce"), class = "factor"), FacilityType = structure(c(2L, 
    2L, 1L, 1L, 2L, 2L, 1L, 1L, 2L, 2L, 1L, 1L, 2L, 2L, 1L, 1L, 
    2L, 2L, 1L, 1L), .Label = c("Art", "Fwy"), class = "factor"), 
        CongEff = structure(c(2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 
        2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L), .Label = c("High", 
        "Low"), class = "factor"), a0 = c(1.514043, 2.33068, 
        1.391944, 2.33068, 1.891605, 3.122058, 1.803077, 2.709889, 
        2.910908, 4.236186, 2.910908, 4.236186, 1.983941, 3.047591, 
        1.983941, 3.047591, 0.084242, 1.129694, 0.649008, 0.720046
        ), a1 = c(0.111216, 0.080886, 0.114459, 0.080886, 0.1321, 
        0.066735, 0.120354, 0.076542, 0.113246, 0.051136, 0.113246, 
        0.051136, 0.132355, 0.095516, 0.132355, 0.095516, 0.127122, 
        0.12433, 0.125167, 0.121301), a2 = c(-0.002934, -0.002479, 
        -0.002926, -0.002479, -0.004133, -0.002487, -0.003429, 
        -0.003091, -0.00342, -0.001874, -0.00342, -0.001874, 
        -0.003695, -0.003235, -0.003695, -0.003235, -0.004816, 
        -0.00459, -0.004512, -0.004669), a3 = c(3.63e-05, 2.94e-05, 
        3.45e-05, 2.94e-05, 5.78e-05, 3.44e-05, 4.36e-05, 4.77e-05, 
        4.55e-05, 2.41e-05, 4.55e-05, 2.41e-05, 4.6e-05, 4.27e-05, 
        4.6e-05, 4.27e-05, 8.12e-05, 7.57e-05, 7.33e-05, 7.96e-05
        ), a4 = c(-1.73e-07, -1.15e-07, -1.55e-07, -1.15e-07, 
        -2.9e-07, -1.63e-07, -2.06e-07, -2.42e-07, -2.27e-07, 
        -1.04e-07, -2.27e-07, -1.04e-07, -2.18e-07, -2e-07, -2.18e-07, 
        -2e-07, -4.9e-07, -4.62e-07, -4.37e-07, -4.89e-07)), .Names = c("AdvVehType", 
    "FacilityType", "CongEff", "a0", "a1", "a2", "a3", "a4"), class = "data.frame", row.names = c(NA, 
    -20L)), FwySpdMpgAdj.. = structure(list(LtVeh = c(1, 1.030035336, 
    1.030035336, 1.006360424, 0.984805654, 0.992226148, 1.008480565, 
    0.971024735, 0.885865724, 0.777385159, 0.592579505, 0.373498233
    ), Truck = c(1, 0.977501095, 0.9366266, 0.905106191, 0.898433546, 
    0.890009229, 0.771785093, 0.751565822, 0.703541258, 0.641146755, 
    0.574643225, 0.36562557), Bus = c(1, 0.96038921, 0.952964673, 
    0.944045839, 0.944476261, 0.946497128, 0.92500422, 0.84342524, 
    0.794582256, 0.74232287, 0.647213247, 0.365602206)), .Names = c("LtVeh", 
    "Truck", "Bus"), class = "data.frame", row.names = c(60L, 
    55L, 50L, 45L, 40L, 35L, 30L, 25L, 20L, 15L, 10L, 5L)), ArtSpdMpgAdj.. = structure(list(
        LtVeh = c(1, 0.962859145, 0.878416258, 0.770847933, 0.587596356, 
        0.370357393), Truck = c(1, 0.973801942, 0.911576634, 
        0.830732234, 0.744563778, 0.47374013), Bus = c(1.164139035, 
        1.061470017, 1, 0.934230364, 0.814532722, 0.460118764
        )), .Names = c("LtVeh", "Truck", "Bus"), class = "data.frame", row.names = c(30L, 
    25L, 20L, 15L, 10L, 5L)), OtherSpdMpgAdj.. = structure(list(
        LtVeh = c(1, 0.87754288, 0.668927004, 0.421619465), Truck = c(1, 
        0.911313654, 0.816786818, 0.519693147), Bus = c(1.070399805, 
        1, 0.871875667, 0.492511036)), .Names = c("LtVeh", "Truck", 
    "Bus"), class = "data.frame", row.names = c(20L, 15L, 10L, 
    5L)), FwyNormSpd = 48.20379, ArtNormSpd = 24.43473, FreeFlowSpeed.Fc = structure(c(60, 
    30, 20), .Names = c("Fwy", "Art", "Other")), SpdSmoothEff.. = structure(list(
        LdIce = c(0.511847945, 0.573348379, 0.549045376, 0.376206593, 
        0.163250185), HdIce = c(0.97301975, 0.840179961, 0.77959035, 
        0.449266416, 0.199693843)), .Names = c("LdIce", "HdIce"
    ), class = "data.frame", row.names = c(20L, 30L, 40L, 50L, 
    60L)), EcoDriveFraction.Ty = structure(c(0.33, 0.21), .Names = c("Fwy", 
    "Art")), BusSpeeds.Fc = structure(c(60, 20, 15), .Names = c("Fwy", 
    "Art", "Other")), Pce.Ty = structure(c(1, 2.5, 2.5), .Names = c("LtVeh", 
    "Truck", "Bus"))), .Names = c("DvmtRatio", "CongPct_", "BaseSpeeds..", 
"OpsDelayReduce_", "AveOpsDeploy..", "AdvVehFsc..", "FwySpdMpgAdj..", 
"ArtSpdMpgAdj..", "OtherSpdMpgAdj..", "FwyNormSpd", "ArtNormSpd", 
"FreeFlowSpeed.Fc", "SpdSmoothEff..", "EcoDriveFraction.Ty", 
"BusSpeeds.Fc", "Pce.Ty"))


GreenSTEP_$idEcoDriverHh <- function (Data.., EcoDrvProp) 
{
    IsEcoDriver.Hh <- sample(c(1, 0), nrow(Data..), replace = TRUE, 
        prob = c(EcoDrvProp, 1 - EcoDrvProp))
    IsEcoDriver.Hh
}


GreenSTEP_$idLowRollTire <- function (Data.., LowRollProp) 
{
    IsLowRollTire.Hh <- sample(c(1, 0), nrow(Data..), replace = TRUE, 
        prob = c(LowRollProp, 1 - LowRollProp))
    IsLowRollTire.Hh
}


GreenSTEP_$adjCarshareOwn <- function (Data.., OneCarProb. = c(C0 = 0.66, C1 = 0.34), TwoCarProb. = c(C0 = 0.17, 
    C1 = 0.56, C2 = 0.27), ThreeCarProb. = c(C0 = 0.15, C1 = 0.21, 
    C2 = 0.22, C3 = 0.42)) 
{
    IsOneCarCarshare.Hh <- Data..$Carshare == 1 & Data..$Hhvehcnt == 
        1
    NumOneCarCarshareHh <- sum(IsOneCarCarshare.Hh)
    AdjVeh. <- sample(c(0, 1), NumOneCarCarshareHh, prob = OneCarProb., 
        replace = TRUE)
    Data..$Hhvehcnt[IsOneCarCarshare.Hh] <- AdjVeh.
    IsTwoCarCarshare.Hh <- Data..$Carshare == 1 & Data..$Hhvehcnt == 
        2
    NumTwoCarCarshareHh <- sum(IsTwoCarCarshare.Hh)
    AdjVeh. <- sample(c(0, 1, 2), NumTwoCarCarshareHh, prob = TwoCarProb., 
        replace = TRUE)
    Data..$Hhvehcnt[IsTwoCarCarshare.Hh] <- AdjVeh.
    IsThreeCarCarshare.Hh <- Data..$Carshare == 1 & Data..$Hhvehcnt == 
        3
    NumThreeCarCarshareHh <- sum(IsThreeCarCarshare.Hh)
    AdjVeh. <- sample(c(0, 1, 2, 3), NumThreeCarCarshareHh, prob = ThreeCarProb., 
        replace = TRUE)
    Data..$Hhvehcnt[IsThreeCarCarshare.Hh] <- AdjVeh.
    Data..
}


GreenSTEP_$adjDvmtEcoImp <- function (Data.., EcoReduction = 0.054, ImpReduction = 0.09, 
    PropWrkTrav = 0.22) 
{
    IsEcoHh. <- Data..$NumEco >= 1
    IsImpHh. <- Data..$ImpHh == 1
    Dvmt. <- Data..$Dvmt
    EcoAdjDvmt. <- Dvmt.
    EcoAdjDvmt.[IsEcoHh.] <- Dvmt.[IsEcoHh.] * (1 - (EcoReduction * 
        PropWrkTrav))
    ImpAdjDvmt. <- Dvmt.
    ImpAdjDvmt.[IsImpHh.] <- Dvmt.[IsImpHh.] * (1 - ImpReduction)
    pmin(EcoAdjDvmt., ImpAdjDvmt.)
}


GreenSTEP_$calcParkCostAdj <- function (Data.., Park_) 
{
    NumPayers.Hh <- Park_$NumPayers.Hh
    NumCashOut.Hh <- Park_$NumCashOut.Hh
    PropWrkChrgd <- Park_$PropWrkChrgd
    PkgCost <- Park_$PkgCost
    PropOthChrgd <- Park_$PropOthChrgd
    PropWrkPkg <- Park_$PropWrkPkg
    PropWrkTrav <- Park_$PropWrkTrav
    LabForcePartRate <- Park_$LabForcePartRate
    WrkDaysPerYear <- Park_$WrkDaysPerYear
    WrkPkgCost.Hh <- NumPayers.Hh * PkgCost
    OthPkgCost.Hh <- WrkPkgCost.Hh * 0
    OthPkgCost.Hh[] <- PkgCost * PropOthChrgd * (1 - PropWrkTrav)
    DailyPkgCost.Hh <- WrkPkgCost.Hh + OthPkgCost.Hh
    DailyPkgCost.Hh[Data..$Hhvehcnt == 0] <- 0
    PkgCostMile.Hh <- numeric(length(DailyPkgCost.Hh))
    PkgCostMile.Hh[DailyPkgCost.Hh > 0] <- 100 * DailyPkgCost.Hh[DailyPkgCost.Hh > 
        0]/Data..$Dvmt[DailyPkgCost.Hh > 0]
    CashOutIncAdj.Hh <- NumCashOut.Hh * PkgCost * WrkDaysPerYear
    list(DailyPkgCost = DailyPkgCost.Hh, CashOutIncAdj = CashOutIncAdj.Hh, 
        PkgCostMile = PkgCostMile.Hh)
}


GreenSTEP_$idCarshareHh <- function( Data.., CarshareRates. ) {

# Define weights to use in choosing carshare households
#------------------------------------------------------
NumHh <- nrow( Data.. )
VehNumWt.Hh <- numeric( NumHh )
VehNumWt.Hh[ Data..$Hhvehcnt == 0 ] <- 0.8
VehNumWt.Hh[ Data..$Hhvehcnt == 1 ] <- 0.15
VehNumWt.Hh[ Data..$Hhvehcnt == 2 ] <- 0.048
VehNumWt.Hh[ Data..$Hhvehcnt == 3 ] <- 0.002
HhSizeWt.Hh <- numeric( NumHh ) + 1
HhSizeWt.Hh[ Data..$Hhsize == 1 ] <- 0.4
HhSizeWt.Hh[ Data..$Hhsize == 2 ] <- 0.25
HhSizeWt.Hh[ Data..$Hhsize == 3 ] <- 0.25
HhSizeWt.Hh[ Data..$Hhsize == 4 ] <- 0.08
HhSizeWt.Hh[ Data..$Hhsize == 5 ] <- 0.02
AgeWt.Hh <- numeric( NumHh ) + 0.95
AgeWt.Hh[ Data..$Age65Plus > 0 ] <- 0.05
CsharWt.Hh <- VehNumWt.Hh * HhSizeWt.Hh * AgeWt.Hh

# Identify medium density carshare households
#--------------------------------------------
IsMedDen. <- Data..$Htppopdn >= 4000 & Data..$Htppopdn < 10000
MedDenPop <- sum( Data..$Hhsize[ IsMedDen. ] )
NumMedDenCsharHh <- round( 20 * MedDenPop / CarshareRates.[ "MedDen" ] )
MedDenHouseids. <- Data..$Houseid[ IsMedDen. ]
MedDenCsharWts. <- CsharWt.Hh[ IsMedDen. ]
NumPosWts <- sum( MedDenCsharWts. > 0 )

if( NumMedDenCsharHh > NumPosWts ) {
     NumMedDenCsharHh <- NumPosWts
}

if (NumPosWts == 0){
MedDenCsharHouseids. <- c()
} else if (length(MedDenHouseids.) < 2) {
    MedDenCsharHouseids. <- MedDenHouseids.
} else {
MedDenCsharHouseids. <- sample(MedDenHouseids., NumMedDenCsharHh, prob=MedDenCsharWts.)
}

# Identify high density carshare households
#------------------------------------------
IsHighDen. <- Data..$Htppopdn >= 10000
HighDenPop <- sum( Data..$Hhsize[ IsHighDen. ] )
NumHighDenCsharHh <- round( 20 * HighDenPop / CarshareRates.[ "HighDen" ] )
HighDenHouseids. <- Data..$Houseid[ IsHighDen. ]
HighDenCsharWts. <- CsharWt.Hh[ IsHighDen. ]
NumPosWts <- sum( HighDenCsharWts. > 0 )

if( NumHighDenCsharHh > NumPosWts ) {
     NumHighDenCsharHh <- NumPosWts
}

if (NumPosWts == 0){
HighDenCsharHouseids. <- c()
} else if (length(HighDenHouseids.) < 2) {
    HighDenCsharHouseids. <- HighDenHouseids.
} else {
HighDenCsharHouseids. <- sample(HighDenHouseids., NumHighDenCsharHh, prob=HighDenCsharWts.)
}


# Make vector identifying carshare households and return the result
#------------------------------------------------------------------
Carshare <- numeric( NumHh )
Carshare[ Data..$Houseid %in% c( MedDenCsharHouseids., HighDenCsharHouseids. ) ] <- 1
Carshare

}


GreenSTEP_$idEcoWorkers <- function (Data.., PropWrkEco, LabForcePartRate = 0.65) 
{
    PropWrkAgeEco <- PropWrkEco * LabForcePartRate
    NumWrkAgePer <- sum(Data..$DrvAgePop)
    NumWrkAgeEco <- round(PropWrkAgeEco * NumWrkAgePer)
    WrkHhId. <- rep(Data..$Houseid, Data..$DrvAgePop)
    HhIdEco. <- sample(WrkHhId.)[1:NumWrkAgeEco]
    NumHhEco. <- tapply(HhIdEco., HhIdEco., function(x) length(x))
    NumEco.Hh <- numeric(nrow(Data..))
    names(NumEco.Hh) <- Data..$Houseid
    NumEco.Hh[names(NumHhEco.)] <- NumHhEco.
    NumEco.Hh
}


GreenSTEP_$idImpHouseholds <- function (Data.., ImpPropGoal, DenThrshold = 4000, MixRequired = TRUE) 
{
    NumHh <- nrow(Data..)
    NumImpHh <- NumHh * ImpPropGoal
    if (MixRequired) {
        IsCandidate. <- Data..$Htppopdn >= DenThrshold & Data..$Urban == 
            1
    }
    else {
        IsCandidate. <- Data..$Htppopdn >= DenThrshold
    }
    NumCandidates <- sum(IsCandidate.)
    if (NumCandidates <= NumImpHh) {
        ImpHh. <- IsCandidate. * 1
    }
    else {
        CandidateHhId. <- Data..$Houseid[IsCandidate.]
        CandidateHhId. <- sample(CandidateHhId.)[1:NumImpHh]
        ImpHh. <- numeric(NumHh)
        ImpHh.[Data..$Houseid %in% CandidateHhId.] <- 1
    }
    list(ImpHh = ImpHh., NumImpHh = NumImpHh, NumCandidates = NumCandidates)
}


GreenSTEP_$idPayd <- function (Data.., Prop) 
{
    IsPayd.Hh <- sample(c(1, 0), nrow(Data..), replace = TRUE, 
        prob = c(Prop, 1 - Prop))
    IsPayd.Hh
}


GreenSTEP_$idPayingParkers <- function (Data.., PropWrkPkg, PropWrkChrgd, PropCashOut, PropOthChrgd, 
    LabForcePartRate = 0.65, PkgCost, PropWrkTrav = 0.22, WrkDaysPerYear = 260) 
{
    PropOthPkg <- 1 - PropWrkPkg
    PropChrgdPkg <- PropWrkChrgd * PropWrkPkg + PropOthChrgd * 
        PropOthPkg
    PropAvailPkg <- PropWrkChrgd * PropWrkPkg + PropOthPkg
    PropWrkPay <- PropWrkChrgd * PropChrgdPkg/PropAvailPkg
    PropWrkAgePay <- PropWrkPay * LabForcePartRate
    NumWrkAgePer <- sum(Data..$DrvAgePop)
    NumWrkAgePay <- round(PropWrkAgePay * NumWrkAgePer)
    NumCashOut <- round(NumWrkAgePay * PropCashOut)
    WrkHhId. <- rep(Data..$Houseid, Data..$DrvAgePop)
    HhIdPay. <- sample(WrkHhId.)[1:NumWrkAgePay]
    if (NumCashOut >= 1) {
        HhIdCashOut. <- sample(HhIdPay.)[1:NumCashOut]
    }
    else {
        HhIdCashOut. <- NULL
    }
    NumHhPayers. <- tapply(HhIdPay., HhIdPay., function(x) length(x))
    NumPayers.Hh <- numeric(nrow(Data..))
    names(NumPayers.Hh) <- Data..$Houseid
    NumPayers.Hh[names(NumHhPayers.)] <- NumHhPayers.
    NumCashOut.Hh <- numeric(nrow(Data..))
    names(NumCashOut.Hh) <- Data..$Houseid
    if (!is.null(HhIdCashOut.)) {
        NumHhCashOut. <- tapply(HhIdCashOut., HhIdCashOut., function(x) length(x))
        NumCashOut.Hh[names(NumHhCashOut.)] <- NumHhCashOut.
    }
    list(NumPayers.Hh = NumPayers.Hh, NumCashOut.Hh = NumCashOut.Hh, 
        PropWrkPkg = PropWrkPkg, PropWrkChrgd = PropWrkChrgd, 
        PropCashOut = PropCashOut, PropOthChrgd = PropOthChrgd, 
        LabForcePartRate = 0.65, PkgCost = PkgCost, PropWrkTrav = 0.22, 
        WrkDaysPerYear = 260)
}


GreenSTEP_$allocateAdjDvmt <- function (Data.., DvmtAdjFactor.) 
{
    VehDvmt_ <- mapply("*", Data..$VehDvmt, DvmtAdjFactor.)
    EvVehDvmt_ <- mapply("*", Data..$EvVehDvmt, DvmtAdjFactor.)
    HcVehDvmt_ <- mapply("*", Data..$HcVehDvmt, DvmtAdjFactor.)
    list(VehDvmt = VehDvmt_, EvVehDvmt = EvVehDvmt_, HcVehDvmt = HcVehDvmt_)
}


GreenSTEP_$calcAveElectricCo2e <- function (FcstYear, Co2.CoYr = PowerCo2.CoYr, OutputType = "MetricTons") 
{
    if (!(OutputType %in% c("MetricTons", "Pounds"))) {
        stop("OutputType must be MetricTons or Pounds")
    }
    if (OutputType == "MetricTons") {
        Co2e.Co <- Co2.CoYr[, FcstYear]/2204.62262
    }
    if (OutputType == "Pounds") {
        Co2e.Co <- Co2.CoYr[, FcstYear]
    }
    Co2e.Co
}


GreenSTEP_$calcAveFuelCo2e <- function (FcstYear, Fuels..Yr = AutoLtTrkFuels..Yr, Co2..Yr = FuelCo2..Yr, 
    MjPerGallon = 121, OutputType = "MetricTons") 
{
    if (!(OutputType %in% c("MetricTons", "Pounds"))) {
        stop("OutputType must be MetricTons or Pounds")
    }
    if (is.na(Co2..Yr[FcstYear, "LtVehComposite"])) {
        AutoPropDieselBlend <- Fuels..Yr[FcstYear, "AutoPropDiesel"]
        AutoPropCng <- Fuels..Yr[FcstYear, "AutoPropCng"]
        AutoPropGasBlend <- 1 - AutoPropDieselBlend - AutoPropCng
        AutoPropEthanol <- AutoPropGasBlend * Fuels..Yr[FcstYear, 
            "GasPropEth"]
        AutoPropGas <- AutoPropGasBlend - AutoPropEthanol
        AutoPropBiodiesel <- AutoPropDieselBlend * Fuels..Yr[FcstYear, 
            "DieselPropBio"]
        AutoPropDiesel <- AutoPropDieselBlend - AutoPropBiodiesel
        rm(AutoPropDieselBlend, AutoPropGasBlend)
        LtTrkPropDieselBlend <- Fuels..Yr[FcstYear, "LtTrkPropDiesel"]
        LtTrkPropCng <- Fuels..Yr[FcstYear, "LtTrkPropCng"]
        LtTrkPropGasBlend <- 1 - LtTrkPropDieselBlend - LtTrkPropCng
        LtTrkPropEthanol <- LtTrkPropGasBlend * Fuels..Yr[FcstYear, 
            "GasPropEth"]
        LtTrkPropGas <- LtTrkPropGasBlend - LtTrkPropEthanol
        LtTrkPropBiodiesel <- LtTrkPropDieselBlend * Fuels..Yr[FcstYear, 
            "DieselPropBio"]
        LtTrkPropDiesel <- LtTrkPropDieselBlend - LtTrkPropBiodiesel
        rm(LtTrkPropDieselBlend, LtTrkPropGasBlend)
        if (FcstYear == "1990") {
            GasCo2e <- Co2..Yr[FcstYear, "RFG"]
        }
        else {
            GasCo2e <- Co2..Yr[FcstYear, "CARBOB"]
        }
        AutoCo2e <- (AutoPropGas * GasCo2e) + (AutoPropCng * 
            Co2..Yr[FcstYear, "Cng"]) + (AutoPropEthanol * Co2..Yr[FcstYear, 
            "Ethanol"]) + (AutoPropDiesel * Co2..Yr[FcstYear, 
            "ULSD"]) + (AutoPropBiodiesel * Co2..Yr[FcstYear, 
            "Biodiesel"])
        if (OutputType == "MetricTons") {
            AutoCo2e <- AutoCo2e * MjPerGallon/1e+06
        }
        if (OutputType == "Pounds") {
            AutoCo2e <- AutoCo2e * MjPerGallon * 2.20462262/1000
        }
        LtTrkCo2e <- (LtTrkPropGas * GasCo2e) + (LtTrkPropCng * 
            Co2..Yr[FcstYear, "Cng"]) + (LtTrkPropEthanol * Co2..Yr[FcstYear, 
            "Ethanol"]) + (LtTrkPropDiesel * Co2..Yr[FcstYear, 
            "ULSD"]) + (LtTrkPropBiodiesel * Co2..Yr[FcstYear, 
            "Biodiesel"])
        if (OutputType == "MetricTons") {
            LtTrkCo2e <- LtTrkCo2e * MjPerGallon/1e+06
        }
        if (OutputType == "Pounds") {
            LtTrkCo2e <- LtTrkCo2e * MjPerGallon * 2.20462262/1000
        }
    }
    else {
        AutoCo2e <- Co2..Yr[FcstYear, "LtVehComposite"]
        if (OutputType == "MetricTons") {
            AutoCo2e <- AutoCo2e * MjPerGallon/1e+06
        }
        if (OutputType == "Pounds") {
            AutoCo2e <- AutoCo2e * MjPerGallon * 2.20462262/1000
        }
        LtTrkCo2e <- Co2..Yr[FcstYear, "LtVehComposite"]
        if (OutputType == "MetricTons") {
            LtTrkCo2e <- LtTrkCo2e * MjPerGallon/1e+06
        }
        if (OutputType == "Pounds") {
            LtTrkCo2e <- LtTrkCo2e * MjPerGallon * 2.20462262/1000
        }
    }
    c(Auto = AutoCo2e, LtTruck = LtTrkCo2e)
}


GreenSTEP_$calcCosts <- function (Data.., Costs., PaydRate, CongPrice, VmtSurcharge, 
    ExtraModCost, NonPrivateFactor = 5) 
{
    VmtExtCost.Hh <- Data..$Dvmt * sum(Costs.[c("AirPollution", 
        "OtherResource", "Safety", "Noise")])
    FuelExtCost.Hh <- Data..$FuelGallons * Costs.["EnergySecurity"]
    Co2eExtCost.Hh <- (Data..$FuelCo2e + Data..$ElecCo2e) * Costs.["ClimateChange"]
    TotExtCost.Hh <- VmtExtCost.Hh + FuelExtCost.Hh + Co2eExtCost.Hh
    CarbonTax.Hh <- (Data..$FuelCo2e + Data..$ElecCo2e) * Costs.["CarbonTax"]
    AddedExtTax.Hh <- TotExtCost.Hh * Costs.["PropExtPaid"] - 
        CarbonTax.Hh
    FuelCost.Hh <- Data..$FuelGallons * Costs.["FuelCost"]
    PowerCost.Hh <- Data..$ElecKwh * Costs.["KwhCost"]
    GasTax.Hh <- Data..$FuelGallons * Costs.["GasTax"]
    CongTax.Hh <- Data..$Dvmt * CongPrice
    CongTax.Hh[Data..$DevType != "Metropolitan"] <- 0
    VmtTax.Hh <- Data..$Dvmt * (Costs.["VmtTax"] + VmtSurcharge)
    RoadUseTax.Hh <- GasTax.Hh + CongTax.Hh + VmtTax.Hh
    PaydCost.Hh <- Data..$Dvmt * Data..$Payd * PaydRate
    TotCost.Hh <- FuelCost.Hh + PowerCost.Hh + RoadUseTax.Hh + 
        CarbonTax.Hh + AddedExtTax.Hh + PaydCost.Hh + Data..$DailyPkgCost
    BaseCost.Hh <- FuelCost.Hh + PowerCost.Hh + RoadUseTax.Hh + 
        CarbonTax.Hh + AddedExtTax.Hh
    HasVeh.Hh <- Data..$Hhvehcnt >= 1
    HasDvmt.Hh <- Data..$Dvmt > 0
    AveBaseCostMile <- mean(BaseCost.Hh[HasVeh.Hh & HasDvmt.Hh]/Data..$Dvmt[HasVeh.Hh & 
        HasDvmt.Hh])
    AveExtCostMile <- mean(TotExtCost.Hh[HasVeh.Hh & HasDvmt.Hh]/Data..$Dvmt[HasVeh.Hh & 
        HasDvmt.Hh])
    HasNoVehOrNoDvmt.Hh <- !HasVeh.Hh | !HasDvmt.Hh
    TotCost.Hh[HasNoVehOrNoDvmt.Hh] <- Data..$Dvmt[HasNoVehOrNoDvmt.Hh] * 
        5 * AveBaseCostMile
    TotExtCost.Hh[HasNoVehOrNoDvmt.Hh] <- Data..$Dvmt[HasNoVehOrNoDvmt.Hh] * 
        AveExtCostMile
    FuelCost.Hh[HasNoVehOrNoDvmt.Hh] <- 0
    PowerCost.Hh[HasNoVehOrNoDvmt.Hh] <- 0
    RoadUseTax.Hh[HasNoVehOrNoDvmt.Hh] <- 0
    CarbonTax.Hh[HasNoVehOrNoDvmt.Hh] <- 0
    AddedExtTax.Hh[HasNoVehOrNoDvmt.Hh] <- 0
    PaydCost.Hh[HasNoVehOrNoDvmt.Hh] <- 0
    FutrCostPerMile.Hh <- TotCost.Hh/Data..$Dvmt
    FutrCostPerMile.Hh[HasNoVehOrNoDvmt.Hh] <- 5 * AveBaseCostMile
    IsPayd.Hh <- Data..$Payd == 1
    VehOwnExp.Hh <- numeric(length(IsPayd.Hh))
    VehOwnExp.Hh[HasVeh.Hh & IsPayd.Hh] <- Data..$DepExp[HasVeh.Hh & 
        IsPayd.Hh]/365 + Data..$Dvmt[HasVeh.Hh & IsPayd.Hh] * 
        sum(Costs.[c("VehMaint", "VehTire")]) + Data..$Hhvehcnt[HasVeh.Hh & 
        IsPayd.Hh] * sum(Costs.[c("VehFin", "VehReg")])/365
    VehOwnExp.Hh[HasVeh.Hh & !IsPayd.Hh] <- Data..$DepExp[HasVeh.Hh & 
        !IsPayd.Hh]/365 + Data..$Dvmt[HasVeh.Hh & !IsPayd.Hh] * 
        sum(Costs.[c("VehMaint", "VehTire")]) + Data..$Hhvehcnt[HasVeh.Hh & 
        !IsPayd.Hh] * sum(Costs.[c("VehFin", "VehIns", "VehReg")])/365
    ExpTooHigh. <- (VehOwnExp.Hh * 365/Data..$Hhincttl) > 0.25
    VehOwnExp.Hh[ExpTooHigh.] <- 0.25 * Data..$Hhincttl[ExpTooHigh.]/365
    BaseModCost.Hh <- Data..$Dvmt * Costs.["BaseMod"]
    PresOpMaintCost.Hh <- Data..$Dvmt * Costs.["PresOpMaint"]
    OtherRoadCost.Hh <- Data..$Dvmt * Costs.["OtherRoad"]
    ExtraModCost.Hh <- Data..$Dvmt * ExtraModCost
    TotRoadCost.Hh <- BaseModCost.Hh + PresOpMaintCost.Hh + OtherRoadCost.Hh + 
        ExtraModCost.Hh
    list(FuelCost = FuelCost.Hh, PowerCost = PowerCost.Hh, RoadUseTax = RoadUseTax.Hh, 
        CarbonTax = CarbonTax.Hh, AddedExtTax = AddedExtTax.Hh, 
        PaydCost = PaydCost.Hh, TotExtCost = TotExtCost.Hh, HhTotCost = TotCost.Hh, 
        FutrCostPerMi = FutrCostPerMile.Hh, VehOwnExp = VehOwnExp.Hh, 
        TotRoadCost = TotRoadCost.Hh)
}


GreenSTEP_$calcRoadFromHhDvmt <- function (HhDvmt, AdjFactor) 
{
    HhDvmt * AdjFactor
}


GreenSTEP_$calcVehDepreciationExp <- function (Data..) 
{
    Houseid. <- as.character(rep(Data..$Houseid, Data..$Hhvehcnt))
    VehType. <- unlist(Data..$VehType)
    VehAge. <- unlist(Data..$VehAge)
    VehAge.[VehAge. == 0] <- 1
    Depreciation. <- numeric(length(VehAge.))
    Depreciation.[VehType. == "Auto" & VehAge. <= 20] <- exp(9.07167 - 
        1.2933 * log(VehAge.[VehType. == "Auto" & VehAge. <= 
            20]))
    Depreciation.[VehType. == "LtTruck" & VehAge. <= 20] <- exp(9.08292 - 
        1.2641 * log(VehAge.[VehType. == "LtTruck" & VehAge. <= 
            20]))
    Depreciation.Hh <- tapply(Depreciation., Houseid., sum)
    Depreciation.Hh[as.character(Data..$Houseid)]
}


GreenSTEP_$calcVehFuelElecCo2 <- function (Data.., AveFuelCo2e., AveElectricCo2e, CsharEffFactor = 1) 
{
    HasVeh.Hh <- Data..$Hhvehcnt >= 1
    Idx. <- rep(1:sum(HasVeh.Hh), Data..$Hhvehcnt[HasVeh.Hh])
    HcDvmt. <- unlist(Data..$HcVehDvmt[HasVeh.Hh])
    Mpg. <- unlist(Data..$VehMpg[HasVeh.Hh])
    VehType. <- unlist(Data..$VehType[HasVeh.Hh])
    FuelGallons. <- HcDvmt./Mpg.
    FuelCo2e. <- FuelGallons. * AveFuelCo2e.[VehType.]
    FuelGallons.Hh <- tapply(FuelGallons., Idx., function(x) sum(x, 
        na.rm = TRUE))
    FuelCo2e.Hh <- tapply(FuelCo2e., Idx., function(x) sum(x, 
        na.rm = TRUE))
    EvDvmt. <- unlist(Data..$EvVehDvmt[HasVeh.Hh])
    Mpkwh. <- unlist(Data..$VehMpkwh[HasVeh.Hh])
    ElecKwh. <- EvDvmt./Mpkwh.
    ElecCo2e. <- ElecKwh. * AveElectricCo2e
    ElecKwh.Hh <- tapply(ElecKwh., Idx., function(x) sum(x, na.rm = TRUE))
    ElecCo2e.Hh <- tapply(ElecCo2e., Idx., function(x) sum(x, 
        na.rm = TRUE))
    TotHcDvmt <- sum(HcDvmt., na.rm = TRUE)
    TotEvDvmt <- sum(EvDvmt., na.rm = TRUE)
    TotFuelGallons <- sum(FuelGallons.Hh)
    TotFuelCo2e <- sum(FuelCo2e.Hh)
    TotElecKwh <- sum(ElecKwh.Hh)
    TotElecCo2e <- sum(ElecCo2e.Hh)
    PropHcDvmt <- TotHcDvmt/(TotHcDvmt + TotEvDvmt)
    AveGpm <- CsharEffFactor * TotFuelGallons/TotHcDvmt
    AveFuelCo2eRate <- CsharEffFactor * TotFuelCo2e/TotHcDvmt
    if (TotEvDvmt == 0) {
        AveKwhpm <- 0
        AveElecCo2eRate <- 0
    }
    else {
        AveKwhpm <- CsharEffFactor * TotElecKwh/TotEvDvmt
        AveElecCo2eRate <- CsharEffFactor * TotElecCo2e/TotEvDvmt
    }
    ZcHcDvmt.Hh <- Data..$Dvmt[!HasVeh.Hh] * PropHcDvmt
    ZcEvDvmt.Hh <- Data..$Dvmt[!HasVeh.Hh] * (1 - PropHcDvmt)
    ZcFuelGallons.Hh <- ZcHcDvmt.Hh * AveGpm
    ZcFuelCo2e.Hh <- ZcHcDvmt.Hh * AveFuelCo2eRate
    ZcElecKwh.Hh <- ZcEvDvmt.Hh * AveKwhpm
    ZcElecCo2e.Hh <- ZcEvDvmt.Hh * AveElecCo2eRate
    AllFuelGallons.Hh <- numeric(nrow(Data..))
    AllFuelGallons.Hh[HasVeh.Hh] <- FuelGallons.Hh
    AllFuelGallons.Hh[!HasVeh.Hh] <- ZcFuelGallons.Hh
    AllFuelCo2e.Hh <- numeric(nrow(Data..))
    AllFuelCo2e.Hh[HasVeh.Hh] <- FuelCo2e.Hh
    AllFuelCo2e.Hh[!HasVeh.Hh] <- ZcFuelCo2e.Hh
    AllElecKwh.Hh <- numeric(nrow(Data..))
    AllElecKwh.Hh[HasVeh.Hh] <- ElecKwh.Hh
    AllElecKwh.Hh[!HasVeh.Hh] <- ZcElecKwh.Hh
    AllElecCo2e.Hh <- numeric(nrow(Data..))
    AllElecCo2e.Hh[HasVeh.Hh] <- ElecCo2e.Hh
    AllElecCo2e.Hh[!HasVeh.Hh] <- ZcElecCo2e.Hh
    list(FuelGallons = AllFuelGallons.Hh, FuelCo2e = AllFuelCo2e.Hh, 
        ElecKwh = AllElecKwh.Hh, ElecCo2e = AllElecCo2e.Hh)
}


GreenSTEP_$adjustHvyVehAgeDistribution <- function (CumDist., AdjRatio) 
{
    Ages. <- 0:(length(CumDist.) - 1)
    MaxAge <- Ages.[length(Ages.)]
    LowerIndex <- max(which(CumDist. < 0.95))
    UpperIndex <- LowerIndex + 1
    LowerValue <- CumDist.[LowerIndex]
    UpperValue <- CumDist.[UpperIndex]
    YearFraction <- (0.95 - LowerValue)/(UpperValue - LowerValue)
    Year95 <- Ages.[LowerIndex] + YearFraction
    Target95 <- Year95 * AdjRatio
    LowerShiftRatio <- Target95/Year95
    UpperShiftRatio <- (MaxAge - Target95)/(MaxAge - Year95)
    LowerAdjAges. <- Ages.[0:LowerIndex] * LowerShiftRatio
    UpperAgeSeq. <- (Ages.[UpperIndex]:MaxAge)
    UpperAdjAges. <- MaxAge - rev(UpperAgeSeq. - UpperAgeSeq.[1]) * 
        UpperShiftRatio
    AdjAges. <- c(LowerAdjAges., UpperAdjAges.)
    AdjCumDist. <- CumDist.
    for (i in 2:(length(AdjCumDist.) - 1)) {
        LowerIndex <- max(which(AdjAges. < Ages.[i]))
        UpperIndex <- LowerIndex + 1
        AdjProp <- (Ages.[i] - AdjAges.[LowerIndex])/(AdjAges.[UpperIndex] - 
            AdjAges.[LowerIndex])
        LowerValue <- CumDist.[LowerIndex]
        UpperValue <- CumDist.[UpperIndex]
        AdjCumDist.[i] <- LowerValue + AdjProp * (UpperValue - 
            LowerValue)
    }
    AdjDist. <- AdjCumDist.
    for (i in length(AdjDist.):2) {
        AdjDist.[i] <- AdjDist.[i] - AdjDist.[i - 1]
    }
    AdjDist.
}


GreenSTEP_$assignHvyVehFuelEconomy <- function (AgeDist.Ag, Mpg..Yr = TrkBusMpg..Yr, Type, CurrYear) 
{
    Mpg.Yr <- unlist(Mpg..Yr[, Type])
    Years <- names(Mpg.Yr) <- rownames(Mpg..Yr)
    StartYear <- as.numeric(CurrYear) - 32
    if (StartYear < 1975) {
        YrSeq. <- Years[1:which(Years == CurrYear)]
        NumMissingYr <- 1975 - StartYear
        YrSeq. <- c(rep("1975", NumMissingYr), YrSeq.)
    }
    else {
        YrSeq. <- Years[which(Years == StartYear):which(Years == 
            yr)]
    }
    VehMpg.Ag <- rev(Mpg.Yr[YrSeq.])
    names(VehMpg.Ag) <- as.character(0:32)
    VehMpg <- sum(VehMpg.Ag * AgeDist.Ag)
    VehMpg
}


GreenSTEP_$adjustAgeDistribution <- function( CumDist., AdjRatio ) {
		# Calculate the length of the original distribution
		DistLength <- length( CumDist. )
		# If 95th percentile age increases, add more ages on the right side of the distribution
		# to enable the distribution to be expanded in that direction
		if( AdjRatio > 1 ) CumDist. <- c( CumDist., rep(1,8) )
		# Calculate vehicle ages for the distribution
		Ages. <- 0:( length( CumDist. ) - 1 )
		MaxAge <- Ages.[ length( Ages. ) ]
		# Find decimal year which is equal to 95th percentile
		LowerIndex <- max( which( CumDist. < 0.95 ) )
		UpperIndex <- LowerIndex + 1
		LowerValue <- CumDist.[ LowerIndex ]
		UpperValue <- CumDist.[ UpperIndex ]
		YearFraction <- ( 0.95 - LowerValue ) / ( UpperValue - LowerValue )
		Year95 <- Ages.[ LowerIndex ] + YearFraction
		# Calculate the adjustment in years
		Target95 <- Year95 * AdjRatio
		LowerShiftRatio <- Target95 / Year95
		UpperShiftRatio <- ( MaxAge - Target95 ) / ( MaxAge - Year95 )
		LowerAdjAges. <- Ages.[ 0:LowerIndex ] * LowerShiftRatio
		UpperAgeSeq. <- ( Ages.[ UpperIndex ]:MaxAge )
		UpperAdjAges. <- MaxAge - rev( UpperAgeSeq. - UpperAgeSeq.[1] ) * UpperShiftRatio
		AdjAges. <- c( LowerAdjAges., UpperAdjAges. )
		# Calculate new cumulative proportions
		AdjCumDist. <- CumDist.
		for( i in 2:( length( AdjCumDist. ) - 1 ) ) {
     		LowerIndex <- max( which( AdjAges. < Ages.[i] ) )
     		UpperIndex <- LowerIndex + 1
     		AdjProp <- ( Ages.[i] - AdjAges.[ LowerIndex ] ) /
				( AdjAges.[ UpperIndex ] - AdjAges.[ LowerIndex ] )
			LowerValue <- CumDist.[ LowerIndex ]
			UpperValue <- CumDist.[ UpperIndex ]
			AdjCumDist.[i] <- LowerValue + AdjProp * ( UpperValue - LowerValue )
		}
		# Smooth out the cumulative distribution
		LowIdx <- 1
		HiIdx <- length( AdjCumDist. )
		SmoothTransition. <- smooth.spline( LowIdx:HiIdx, AdjCumDist.[LowIdx:HiIdx], df=4 )$y
		AdjCumDist.[ LowIdx:HiIdx ] <- SmoothTransition. 
		# Convert cumulative distribution to regular distribution
		AdjDist. <- AdjCumDist.
		for( i in length( AdjDist. ):2 ) {
			AdjDist.[i] <- AdjDist.[i] - AdjDist.[i-1]
		}
		# Truncate to original distribution length
		AdjDist. <- AdjDist.[ 1:DistLength ]
		# Eliminate any small negative values
		AdjDist.[ AdjDist. < 0 ] <- 0
		# Adjust so that sum of distribution exactly equals 1
		AdjDist. <- AdjDist. * ( 1 / sum( AdjDist. ) )
		# Return result
        AdjDist.
	}


GreenSTEP_$apportionDvmt <- function (Data.., DP_ = DvmtProp_) 
{
    VehDvmtPropOutput_ <- lapply(1:nrow(Data..), function(x) numeric(0))
    Nc <- sort(unique(Data..$Hhvehcnt))
    for (nc in Nc) {
        DataSub.. <- Data..[Data..$Hhvehcnt == nc, ]
        VehDvmtProp_ <- lapply(DataSub..$Houseid, function(x) numeric(nc))
        if (nc <= 2) {
            if (nc == 1) {
                VehDvmtProp_ <- lapply(VehDvmtProp_, function(x) x <- 1)
            }
            else {
                DvmtProp.2d <- DP_[["2Veh"]]
                NumSamples <- nrow(DataSub..)
                VehDvmtProp.2d <- matrix(0, nrow = NumSamples, 
                  ncol = nc)
                VehDvmtProp.2d[, 1] <- sample(DvmtProp.2d[, "Value"], 
                  NumSamples, replace = TRUE, prob = DvmtProp.2d[, 
                    "Prob"])
                VehDvmtProp.2d[, 2] <- 1 - VehDvmtProp.2d[, 1]
                for (i in 1:NumSamples) VehDvmtProp_[[i]] <- VehDvmtProp.2d[i, 
                  ]
            }
        }
        else {
            if (nc >= 5) {
                VehClassName <- "5PlusVeh"
            }
            else {
                VehClassName <- paste(nc, "Veh", sep = "")
            }
            DvmtProp.2d <- DP_[[VehClassName]]
            NumSamples <- nrow(DataSub..)
            VehDvmtProp.2d <- matrix(0, nrow = NumSamples, ncol = nc)
            VehDvmtProp.2d[, 1] <- sample(DvmtProp.2d[, "Value"], 
                NumSamples, replace = TRUE, prob = DvmtProp.2d[, 
                  "Prob"])
            for (i in 2:nc) {
                VehDvmtProp.2d[, i] <- apply(VehDvmtProp.2d, 
                  1, function(x) {
                    RemProb <- round(1 - sum(x), 2)
                    if (i == nc) {
                      Result <- RemProb
                    }
                    else {
                      if (RemProb == 0) {
                        Result <- 0
                      }
                      else {
                        if (RemProb == 0.05) {
                          Result <- 0.05
                        }
                        else {
                          IsPossProb. <- DvmtProp.2d[, "Value"] <= 
                            RemProb
                          Values. <- DvmtProp.2d[IsPossProb., 
                            "Value"]
                          Prob. <- DvmtProp.2d[IsPossProb., "Prob"]
                          Result <- sample(Values., 1, replace = TRUE, 
                            Prob.)
                        }
                      }
                    }
                    Result
                  })
            }
            for (i in 1:NumSamples) VehDvmtProp_[[i]] <- VehDvmtProp.2d[i, 
                ]
        }
        VehDvmtPropOutput_[Data..$Hhvehcnt == nc] <- VehDvmtProp_
    }
    VehDvmtPropOutput_
}


GreenSTEP_$assignEv <- function (Data.., EvRangeProp..Yr = EvRangeProp..Yr, CurrYear, 
    UseMaxDvmtCriterion = FALSE) 
{
    Ev.Yr3Ty <- array(0, dim = c(nrow(EvRangeProp..Yr), 3, 2), 
        dimnames = list(rownames(EvRangeProp..Yr), c("Range", 
            "PropEv", "Mpkwh"), c("Auto", "LtTruck")))
    Ev.Yr3Ty[, , 1] <- as.matrix(EvRangeProp..Yr[, 1:3])
    Ev.Yr3Ty[, , 2] <- as.matrix(EvRangeProp..Yr[, 4:6])
    Years <- rownames(Ev.Yr3Ty)
    StartYear <- as.numeric(CurrYear) - 32
    if (StartYear < 1975) {
        YrSeq. <- Years[1:which(Years == CurrYear)]
        NumMissingYr <- 1975 - StartYear
        YrSeq. <- c(rep("1975", NumMissingYr), YrSeq.)
    }
    else {
        YrSeq. <- Years[which(Years == StartYear):which(Years == 
            CurrYear)]
    }
    Ev.Ag3Ty <- Ev.Yr3Ty[rev(YrSeq.), , ]
    rownames(Ev.Ag3Ty) <- as.character(0:32)
    Veh_ <- list()
    Veh_$Houseid <- rep(Data..$Houseid, Data..$Hhvehcnt)
    Veh.. <- data.frame(Veh_)
    rm(Veh_)
    VehNum. <- unlist(sapply(Data..$Hhvehcnt, function(x) 1:x))
    Veh..$Vehid <- paste(Veh..$Houseid, VehNum., sep = "")
    rm(VehNum.)
    Veh..$VehType <- unlist(Data..$VehType)
    Veh..$Age <- as.character(unlist(Data..$VehAge))
    Veh..$Dvmt <- unlist(Data..$VehDvmt)
    Veh..$Dvmt95 <- unlist(calcVehDvmt(Data..$Dvmt95, Data..$DvmtProp))
    Veh..$Powertrain <- unlist(Data..$Powertrain)
    Veh..$VehMpg <- unlist(Data..$VehMpg)
    Veh..$VehMpkwh <- unlist(Data..$VehMpkwh)
    Veh..$EvVehDvmt <- unlist(Data..$EvVehDvmt)
    Veh..$HcVehDvmt <- unlist(Data..$HcVehDvmt)
    InitColumn. <- numeric(nrow(Veh..))
    Veh..$EvRange <- InitColumn.
    Veh..$EvRange[Veh..$VehType == "Auto"] <- Ev.Ag3Ty[Veh..$Age[Veh..$VehType == 
        "Auto"], "Range", "Auto"]
    Veh..$EvRange[Veh..$VehType == "LtTruck"] <- Ev.Ag3Ty[Veh..$Age[Veh..$VehType == 
        "LtTruck"], "Range", "LtTruck"]
    Veh..$EvPropEv <- InitColumn.
    Veh..$EvPropEv[Veh..$VehType == "Auto"] <- Ev.Ag3Ty[Veh..$Age[Veh..$VehType == 
        "Auto"], "PropEv", "Auto"]
    Veh..$EvPropEv[Veh..$VehType == "LtTruck"] <- Ev.Ag3Ty[Veh..$Age[Veh..$VehType == 
        "LtTruck"], "PropEv", "LtTruck"]
    Veh..$EvMpkwh <- InitColumn.
    Veh..$EvMpkwh[Veh..$VehType == "Auto"] <- Ev.Ag3Ty[Veh..$Age[Veh..$VehType == 
        "Auto"], "Mpkwh", "Auto"]
    Veh..$EvMpkwh[Veh..$VehType == "LtTruck"] <- Ev.Ag3Ty[Veh..$Age[Veh..$VehType == 
        "LtTruck"], "Mpkwh", "LtTruck"]
    rm(InitColumn.)
    IsEvCandidate. <- (Veh..$Dvmt95 <= Veh..$EvRange) & (Veh..$Powertrain == 
        "Phev")
    IsEv. <- logical(length(IsEvCandidate.))
    if (any(IsEvCandidate.)) {
        IsEv.[IsEvCandidate.] <- unlist(sapply(Veh..$EvPropEv[IsEvCandidate.], 
            function(x) {
                sample(c(TRUE, FALSE), 1, prob = c(x, 1 - x))
            }))
    }
    Veh..$VehMpg[IsEv.] <- NA
    Veh..$EvVehDvmt[IsEv.] <- Veh..$EvVehDvmt[IsEv.] + Veh..$HcVehDvmt[IsEv.]
    Veh..$HcVehDvmt[IsEv.] <- 0
    Veh..$VehMpkwh[IsEv.] <- Veh..$EvMpkwh[IsEv.]
    Veh..$Powertrain[IsEv.] <- "Ev"
    SplitIndex. <- rep(1:nrow(Data..), Data..$Hhvehcnt)
    EvVehDvmt_ <- split(Veh..$EvVehDvmt, SplitIndex.)
    HcVehDvmt_ <- split(Veh..$HcVehDvmt, SplitIndex.)
    VehMpg_ <- split(Veh..$VehMpg, SplitIndex.)
    VehMpkwh_ <- split(Veh..$VehMpkwh, SplitIndex.)
    Powertrain_ <- split(Veh..$Powertrain, SplitIndex.)
    list(EvVehDvmt_ = EvVehDvmt_, HcVehDvmt_ = HcVehDvmt_, VehMpg_ = VehMpg_, 
        VehMpkwh_ = VehMpkwh_, Powertrain_ = Powertrain_)
}


GreenSTEP_$assignFuelEconomy <- function (Data.., Mpg..Yr = AutoLtTrkMpg..Yr, CurrYear) 
{
    Years <- rownames(Mpg..Yr)
    StartYear <- as.numeric(CurrYear) - 32
    if (StartYear < 1975) {
        YrSeq. <- Years[1:which(Years == CurrYear)]
        NumMissingYr <- 1975 - StartYear
        YrSeq. <- c(rep("1975", NumMissingYr), YrSeq.)
    }
    else {
        YrSeq. <- Years[which(Years == StartYear):which(Years == 
            CurrYear)]
    }
    VehMpg.AgTy <- cbind(rev(Mpg..Yr[YrSeq., "Auto"]), rev(Mpg..Yr[YrSeq., 
        "LtTruck"]))
    colnames(VehMpg.AgTy) <- c("Auto", "LtTruck")
    rownames(VehMpg.AgTy) <- as.character(0:32)
    VehType. <- unlist(Data..$VehType)
    VehAge. <- as.character(unlist(Data..$VehAge))
    VehMpg. <- numeric(length(VehType.))
    VehMpg.[VehType. == "Auto"] <- VehMpg.AgTy[VehAge.[VehType. == 
        "Auto"], "Auto"]
    VehMpg.[VehType. == "LtTruck"] <- VehMpg.AgTy[VehAge.[VehType. == 
        "LtTruck"], "LtTruck"]
    ListIndex. <- rep(1:nrow(Data..), Data..$Hhvehcnt)
    VehMpg_ <- split(VehMpg., ListIndex.)
    VehMpg_
}


GreenSTEP_$assignPhev <- function (Data.., PhevRangeProp..Yr = PhevRangeProp..Yr, CurrYear, 
    PhevPropModel_ = PhevMilePropModel_, HevMpgProp..Yr = HevMpgProp..Yr, 
    OptimProp = 0) 
{
    Phev.Yr4Ty <- array(0, dim = c(nrow(PhevRangeProp..Yr), 4, 
        2), dimnames = list(rownames(PhevRangeProp..Yr), c("Range", 
        "PropPhev", "Mpkwh", "Mpg"), c("Auto", "LtTruck")))
    Phev.Yr4Ty[, , 1] <- as.matrix(PhevRangeProp..Yr[, 1:4])
    Phev.Yr4Ty[, , 2] <- as.matrix(PhevRangeProp..Yr[, 5:8])
    Years <- rownames(Phev.Yr4Ty)
    StartYear <- as.numeric(CurrYear) - 32
    if (StartYear < 1975) {
        YrSeq. <- Years[1:which(Years == CurrYear)]
        NumMissingYr <- 1975 - StartYear
        YrSeq. <- c(rep("1975", NumMissingYr), YrSeq.)
    }
    else {
        YrSeq. <- Years[which(Years == StartYear):which(Years == 
            CurrYear)]
    }
    Phev.Ag4Ty <- Phev.Yr4Ty[rev(YrSeq.), , ]
    rownames(Phev.Ag4Ty) <- as.character(0:32)
    Hev.Yr2Ty <- array(0, dim = c(nrow(HevMpgProp..Yr), 2, 2), 
        dimnames = list(rownames(HevMpgProp..Yr), c("PropHev", 
            "Mpg"), c("Auto", "LtTruck")))
    Hev.Yr2Ty[, , 1] <- as.matrix(HevMpgProp..Yr[, 1:2])
    Hev.Yr2Ty[, , 2] <- as.matrix(HevMpgProp..Yr[, 3:4])
    Years <- rownames(Hev.Yr2Ty)
    StartYear <- as.numeric(CurrYear) - 32
    if (StartYear < 1975) {
        YrSeq. <- Years[1:which(Years == CurrYear)]
        NumMissingYr <- 1975 - StartYear
        YrSeq. <- c(rep("1975", NumMissingYr), YrSeq.)
    }
    else {
        YrSeq. <- Years[which(Years == StartYear):which(Years == 
            CurrYear)]
    }
    Hev.Ag2Ty <- Hev.Yr2Ty[rev(YrSeq.), , ]
    rownames(Hev.Ag2Ty) <- as.character(0:32)
    Veh_ <- list()
    Veh_$Houseid <- rep(Data..$Houseid, Data..$Hhvehcnt)
    Veh.. <- data.frame(Veh_)
    rm(Veh_)
    VehNum. <- unlist(sapply(Data..$Hhvehcnt, function(x) 1:x))
    Veh..$Vehid <- paste(Veh..$Houseid, VehNum., sep = "")
    rm(VehNum.)
    Veh..$VehType <- unlist(Data..$VehType)
    Veh..$Age <- as.character(unlist(Data..$VehAge))
    Veh..$Dvmt <- unlist(Data..$VehDvmt)
    Veh..$Hhvehcnt <- rep(Data..$Hhvehcnt, Data..$Hhvehcnt)
    Veh..$Carshare <- rep(Data..$Carshare, Data..$Hhvehcnt)
    Veh..$Type <- rep(Data..$DevType, Data..$Hhvehcnt)
    Veh..$Type[Veh..$Type == "Metropolitan"] <- "Metro"
    Veh..$Type[Veh..$Type != "Metro"] <- "NonMetro"
    Veh..$LogIncome <- rep(log(Data..$Hhincttl), Data..$Hhvehcnt)
    Veh..$Htppopdn <- rep(Data..$Htppopdn, Data..$Hhvehcnt)
    Veh..$DrvAgePop <- rep(Data..$Hhsize - Data..$Age0to14, Data..$Hhvehcnt)
    Veh..$Age65Plus <- rep(Data..$Age65Plus, Data..$Hhvehcnt)
    Veh..$Tranmilescap <- rep(Data..$Tranmilescap, Data..$Hhvehcnt)
    Veh..$Urban <- rep(Data..$Urban, Data..$Hhvehcnt)
    InitColumn. <- numeric(nrow(Veh..))
    Veh..$PhevRange <- InitColumn.
    Veh..$PhevRange[Veh..$VehType == "Auto"] <- Phev.Ag4Ty[Veh..$Age[Veh..$VehType == 
        "Auto"], "Range", "Auto"]
    Veh..$PhevRange[Veh..$VehType == "LtTruck"] <- Phev.Ag4Ty[Veh..$Age[Veh..$VehType == 
        "LtTruck"], "Range", "LtTruck"]
    Veh..$PhevPropPhev <- InitColumn.
    Veh..$PhevPropPhev[Veh..$VehType == "Auto"] <- Phev.Ag4Ty[Veh..$Age[Veh..$VehType == 
        "Auto"], "PropPhev", "Auto"]
    Veh..$PhevPropPhev[Veh..$VehType == "LtTruck"] <- Phev.Ag4Ty[Veh..$Age[Veh..$VehType == 
        "LtTruck"], "PropPhev", "LtTruck"]
    Veh..$PhevMpkwh <- InitColumn.
    Veh..$PhevMpkwh[Veh..$VehType == "Auto"] <- Phev.Ag4Ty[Veh..$Age[Veh..$VehType == 
        "Auto"], "Mpkwh", "Auto"]
    Veh..$PhevMpkwh[Veh..$VehType == "LtTruck"] <- Phev.Ag4Ty[Veh..$Age[Veh..$VehType == 
        "LtTruck"], "Mpkwh", "LtTruck"]
    Veh..$PhevMpg <- InitColumn.
    Veh..$PhevMpg[Veh..$VehType == "Auto"] <- Phev.Ag4Ty[Veh..$Age[Veh..$VehType == 
        "Auto"], "Mpg", "Auto"]
    Veh..$PhevMpg[Veh..$VehType == "LtTruck"] <- Phev.Ag4Ty[Veh..$Age[Veh..$VehType == 
        "LtTruck"], "Mpg", "LtTruck"]
    rm(InitColumn.)
    InitColumn. <- numeric(nrow(Veh..))
    Veh..$HevPropHev <- InitColumn.
    Veh..$HevPropHev[Veh..$VehType == "Auto"] <- Hev.Ag2Ty[Veh..$Age[Veh..$VehType == 
        "Auto"], "PropHev", "Auto"]
    Veh..$HevPropHev[Veh..$VehType == "LtTruck"] <- Hev.Ag2Ty[Veh..$Age[Veh..$VehType == 
        "LtTruck"], "PropHev", "LtTruck"]
    Veh..$HevMpg <- InitColumn.
    Veh..$HevMpg[Veh..$VehType == "Auto"] <- Hev.Ag2Ty[Veh..$Age[Veh..$VehType == 
        "Auto"], "Mpg", "Auto"]
    Veh..$HevMpg[Veh..$VehType == "LtTruck"] <- Hev.Ag2Ty[Veh..$Age[Veh..$VehType == 
        "LtTruck"], "Mpg", "LtTruck"]
    rm(InitColumn.)
    IsPhev. <- rep(FALSE, nrow(Veh..))
    if (any(Veh..$PhevRange > 0)) {
        IsPhev. <- unlist(sapply(Veh..$PhevPropPhev, function(x) {
            sample(c(TRUE, FALSE), 1, prob = c(x, 1 - x))
        }))
    }
    IsHev. <- rep(FALSE, nrow(Veh..))
    IsHev.[!IsPhev.] <- unlist(sapply(Veh..$HevPropHev, function(x) {
        sample(c(TRUE, FALSE), 1, prob = c(x, 1 - x))
    }))[!IsPhev.]
    VehMpg. <- unlist(Data..$VehMpg)
    VehMpg.[IsPhev.] <- Veh..$PhevMpg[IsPhev.]
    VehMpg.[IsHev.] <- Veh..$HevMpg[IsHev.]
    if (OptimProp != 0) {
        Optimize. <- sample(c(TRUE, FALSE), nrow(Data..), replace = TRUE, 
            prob = c(OptimProp, 1 - OptimProp))
        VehMpgOp. <- VehMpg.
        AveVehDvmt <- mean(Veh..$Dvmt)
        PropElec. <- Veh..$PhevRange/AveVehDvmt
        PropElec.[PropElec. > 1] <- 1
        VehMpgOp.[IsPhev.] <- VehMpg.[IsPhev.] * (1 - PropElec.[IsPhev.]) + 
            Veh..$PhevMpkwh[IsPhev.] * 33.7 * PropElec.[IsPhev.]
        SplitIndex. <- rep(1:nrow(Data..), Data..$Hhvehcnt)
        VehMpgOp_ <- split(VehMpgOp., SplitIndex.)
        doOptimize <- function(x, y) {
            VehDvmt. <- unlist(x)
            VehMpg. <- unlist(y)
            VehDvmt2. <- VehDvmt.
            VehDvmt2.[is.na(VehMpg.)] <- NA
            VehMpg.[is.na(VehMpg.)] <- seq(1:sum(is.na(VehMpg.)))/100
            VehDvmt2.[is.na(VehDvmt2.)] <- seq(1:sum(is.na(VehDvmt2.)))/100
            VehDvmt.[match(rank(VehMpg., ties.method = "first"), 
                rank(VehDvmt2., ties.method = "first"))]
        }
        OptimDvmt_ <- mapply(doOptimize, Data..$VehDvmt[Optimize.], 
            VehMpgOp_[Optimize.])
        Data..$VehDvmt[Optimize.] <- OptimDvmt_
        Veh..$Dvmt <- unlist(Data..$VehDvmt)
    }
    DvmtProp_ <- lapply(Data..$VehDvmt, function(x) {
        x/sum(x)
    })
    if (sum(IsPhev.) >= 1) {
        Phev.. <- Veh..[IsPhev., ]
        ModelNames. <- paste("PropLE", round(Phev..$PhevRange/5) * 
            5, sep = "")
        getModel <- function(x, y) PhevPropModel_[[x]][y]
        Models. <- mapply(getModel, Phev..$Type, ModelNames.)
        Phev..$Model <- Models.
        rm(ModelNames., getModel)
        Intercept <- 1
        ElecDvmtProp_ <- by(Phev.., Models., function(x) {
            Result. <- eval(parse(text = unique(x$Model)), envir = x)
            names(Result.) <- x$Vehid
            Result.
        }, simplify = TRUE)
        ElecDvmtProp. <- numeric(nrow(Phev..))
        names(ElecDvmtProp.) <- Phev..$Vehid
        for (i in 1:length(ElecDvmtProp_)) {
            Prop. <- ElecDvmtProp_[[i]]
            Prop.[Prop. < 0] <- 0
            Prop.[Prop. > 1] <- 1
            ElecDvmtProp.[names(Prop.)] <- Prop.
        }
    }
    EvVehDvmt. <- Veh..$Dvmt * 0
    names(EvVehDvmt.) <- Veh..$Vehid
    HcVehDvmt. <- Veh..$Dvmt
    names(HcVehDvmt.) <- Veh..$Vehid
    if (sum(IsPhev.) >= 1) {
        ElecDvmt. <- ElecDvmtProp. * Phev..$Dvmt
        EvVehDvmt.[names(ElecDvmt.)] <- ElecDvmt.
        HcVehDvmt.[names(ElecDvmt.)] <- HcVehDvmt.[names(ElecDvmt.)] - 
            ElecDvmt.
        rm(Phev.., Models., Intercept, ElecDvmtProp_, ElecDvmtProp., 
            Prop., ElecDvmt.)
    }
    VehMpg. <- unlist(Data..$VehMpg)
    VehMpkwh. <- VehMpg. * NA
    VehMpg.[IsPhev.] <- Veh..$PhevMpg[IsPhev.]
    VehMpkwh.[IsPhev.] <- Veh..$PhevMpkwh[IsPhev.]
    VehMpg.[IsHev.] <- Veh..$HevMpg[IsHev.]
    Powertrain. <- rep("Ice", length(IsPhev.))
    Powertrain.[IsPhev.] <- "Phev"
    Powertrain.[IsHev.] <- "Hev"
    SplitIndex. <- rep(1:nrow(Data..), Data..$Hhvehcnt)
    EvVehDvmt_ <- split(EvVehDvmt., SplitIndex.)
    HcVehDvmt_ <- split(HcVehDvmt., SplitIndex.)
    VehMpg_ <- split(VehMpg., SplitIndex.)
    VehMpkwh_ <- split(VehMpkwh., SplitIndex.)
    Powertrain_ <- split(Powertrain., SplitIndex.)
    list(VehDvmt_ = Data..$VehDvmt, DvmtProp_ = DvmtProp_, EvVehDvmt_ = EvVehDvmt_, 
        HcVehDvmt_ = HcVehDvmt_, VehMpg_ = VehMpg_, VehMpkwh_ = VehMpkwh_, 
        Powertrain_ = Powertrain_)
}


GreenSTEP_$calcVehAgePropByInc <- function( Seed.AgIg, Margin.Ag, Margin.Ig, MaxIter=100,
		Closure=0.001 ) {
    		# Replace margin values of zero with 0.001
    		if( any( Margin.Ag ==0 ) ){
              	Margin.Ag[ Margin.Ag ==0 ] <- 0.0001
        	}
    		if( any( Margin.Ig ==0 ) ){
              	Margin.Ig[ Margin.Ig ==0 ] <- 0.0001
        	}
    		# Make sure sum of each margin is equal to 1
		Margin.Ag <- Margin.Ag * ( 1 / sum( Margin.Ag ) )
		Margin.Ig <- Margin.Ig * ( 1 / sum( Margin.Ig ) )
    		# Set initial values
    		VehAgIgProp.AgIg <- Seed.AgIg
            VehAgIgProp.AgIg[VehAgIgProp.AgIg == 0] <- 1e-9 #eric#
            
            
    		Iter <- 0
    		MarginChecks <- c( 1, 1 )
          # Iteratively proportion matrix until closure or iteration criteria are met
    		while( ( any( MarginChecks > Closure ) ) & ( Iter < MaxIter ) ) {
			Sums.Ag <- rowSums( VehAgIgProp.AgIg )
            	Coeff.Ag <- Margin.Ag / Sums.Ag
            	VehAgIgProp.AgIg <- sweep( VehAgIgProp.AgIg, 1, Coeff.Ag, "*" )
			MarginChecks[1] <- sum( abs( 1 - Coeff.Ag ) )
			Sums.Ig <- colSums( VehAgIgProp.AgIg )
            	Coeff.Ig <- Margin.Ig / Sums.Ig
            	VehAgIgProp.AgIg <- sweep( VehAgIgProp.AgIg, 2, Coeff.Ig, "*" )
			MarginChecks[2] <- sum( abs( 1 - Coeff.Ig ) )
        		Iter <- Iter + 1
        		}
		# Compute proportions for each income group
		sweep( VehAgIgProp.AgIg, 2, colSums( VehAgIgProp.AgIg ), "/" )
	}


GreenSTEP_$calcVehDvmt <- function (Dvmt., DvmtProp_) 
{
    doCalculation <- function(x, y) {
        DvmtProp. <- unlist(y)
        x * y
    }
    mapply(doCalculation, Dvmt., DvmtProp_)
}


GreenSTEP_$calcVehicleAges <- function( Data.., VProp_=VehProp_, AdjRatio=c( Auto=1, LtTruck=1 )  ) {

		# Compute the vehicle age distribution by income and type
		#--------------------------------------------------------
		# Calculate the distribution of vehicle types by income
		VehProp.IgTy <- calcVehPropByIncome( Data.. )
		# Compute the age margin
		Ty <- colnames( VProp_$AgCumProp.AgTy )
		VehProp.AgTy <- VProp_$AgCumProp.AgTy
		# Adjust the age distribution
		for( ty in Ty ) {
		     VehProp.AgTy[ , ty ] <- adjustAgeDistribution( VProp_$AgCumProp.AgTy[ , ty ],
		     AdjRatio[ ty ] )
		}
		# Compute the age distribution by income and type
		VehAgeProp.AgIgTy <- VProp_$AgIgProp.AgIgTy
		for( ty in Ty ) {
			VehAgeProp.AgIgTy[,,ty] <- calcVehAgePropByInc( VProp_$AgIgProp.AgIgTy[,,ty],
				VehProp.AgTy[,ty], VehProp.IgTy[,ty] )
		}

		# Apply ages to vehicles
		#-----------------------
		Ag <- 0:32
		# Identify the number of autos and light trucks by income group
		NumLtTrucks. <- sapply( Data..$VehType, function(x) sum( x == "LtTruck" ) )
		NumAutos. <- Data..$Hhvehcnt - NumLtTrucks.
		NumLtTruckSamples.Ig <- tapply( NumLtTrucks., Data..$IncGrp, sum )
        NumLtTruckSamples.Ig[is.na(NumLtTruckSamples.Ig)] <- 0
		NumAutoSamples.Ig <- tapply( NumAutos., Data..$IncGrp, sum )
        NumAutoSamples.Ig[is.na(NumAutoSamples.Ig)] <- 0
		# Create age samples for light trucks by income group
		LtTruckSamples_Ig. <- list()
		for( ig in Ig ) {
			prob=VehAgeProp.AgIgTy[ , ig, "LtTruck" ]#eric#
            prob[prob <= 0] <- 1e-9 #eric#
            LtTruckSamples_Ig.[[ig]] <- sample( Ag, NumLtTruckSamples.Ig[ig], replace=TRUE,
					prob=prob )#eric#
		}
		# Create age samples for autos by income group
		AutoSamples_Ig. <- list()
		for( ig in Ig ) {
            prob=VehAgeProp.AgIgTy[ , ig, "Auto" ]#eric#
            prob[prob <= 0] <- 1e-9 #eric#
            
            
			AutoSamples_Ig.[[ig]] <- sample( Ag, NumAutoSamples.Ig[ig], replace=TRUE,
					prob=prob)#eric#
		}
		# Associate light truck and auto ages with each household
		LtTruckAges_ <- as.list( rep( NA, nrow( Data.. ) ) )
		for( ig in Ig ) {
			IsIncGrp. <- Data..$IncGrp == ig
			HasLtTrucks. <- NumLtTrucks. != 0
			GetsAges. <- IsIncGrp. & HasLtTrucks.
            if (sum(GetsAges.) > 0){
                LtTruckAges_[ GetsAges. ] <- split( LtTruckSamples_Ig.[[ig]],
                    rep( 1:sum( GetsAges. ), NumLtTrucks.[ GetsAges. ] ) )
            }
		}
		# Associate auto ages with each household
		AutoAges_ <- as.list( rep( NA, nrow( Data.. ) ) )
		for( ig in Ig ) {
			IsIncGrp. <- Data..$IncGrp == ig
			HasAuto. <- NumAutos. != 0
			GetsAges. <- IsIncGrp. & HasAuto.
            if (sum(GetsAges.) > 0){
                AutoAges_[ GetsAges. ] <- split( AutoSamples_Ig.[[ig]],
                    rep( 1:sum( GetsAges. ), NumAutos.[ GetsAges. ] ) )
            }
		}

		# Return the result
		#------------------
		# Combine auto and light truck lists
		VehAge_ <- mapply( c, LtTruckAges_, AutoAges_ )
		VehAge_ <- lapply( VehAge_, function(x) x[ !is.na(x) ] )
		# Make list of vehicle types correspond to ages list
		VehType_ <- apply( cbind( NumLtTrucks., NumAutos. ), 1, function(x) {
			rep( c( "LtTruck", "Auto" ), x ) } )
		# Return result as a list
		list( VehType = VehType_, VehAge = VehAge_ )
	}


GreenSTEP_$calcVehPropByIncome <- function( Data.. ) {
		VehTab.IgTy <- table( rep( Data..$IncGrp, Data..$Hhvehcnt ), unlist( Data..$VehType ) )
		VehIgProp.IgTy <- sweep( VehTab.IgTy, 2, colSums( VehTab.IgTy ), "/" )
		VehIgProp.IgTy
	}


GreenSTEP_$DvmtProp_ <- structure(list("1Veh" = structure(list(Prob = c(0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1), Value = c(0.05, 
0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 
0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 1)), .Names = c("Prob", "Value"
), row.names = c(NA, -20L), class = "data.frame"), "2Veh" = structure(list(
    Prob = c(0.0191141576588452, 0.0226074347482204, 0.0278143949380438, 
    0.0343395728974427, 0.0464012654890588, 0.0545742156604271, 
    0.0638017400474559, 0.0713814922225152, 0.0815317690482468, 
    0.0787635117321382, 0.0781044028473503, 0.0815976799367255, 
    0.0713155813340365, 0.0638017400474558, 0.054640126548906, 
    0.0464012654890588, 0.0342736620089639, 0.0278143949380438, 
    0.0226733456366992, 0.0190482467703665), Value = c(0.05, 
    0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 
    0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 1)), .Names = c("Prob", 
"Value"), row.names = c(NA, -20L), class = "data.frame"), "3Veh" = structure(list(
    Prob = c(0.0531358885017422, 0.0593786295005807, 0.069541231126597, 
    0.0887049941927991, 0.0950929152148665, 0.100464576074332, 
    0.0979965156794425, 0.0948025551684089, 0.0792682926829268, 
    0.0654761904761905, 0.0582171893147502, 0.0426829268292683, 
    0.0315040650406504, 0.0223577235772358, 0.0161149825783972, 
    0.0114692218350755, 0.00609756097560975, 0.00450058072009292, 
    0.00261324041811846, 0.000580720092915216), Value = c(0.05, 
    0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 
    0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 1)), .Names = c("Prob", 
"Value"), row.names = c(NA, -20L), class = "data.frame"), "4Veh" = structure(list(
    Prob = c(0.0737439222042139, 0.10291734197731, 0.111426256077796, 
    0.129659643435981, 0.142625607779579, 0.112641815235008, 
    0.090356564019449, 0.0705024311183144, 0.0555105348460292, 
    0.036871961102107, 0.029578606158833, 0.0162074554294976, 
    0.0105348460291734, 0.00769854132901134, 0.0020259319286872, 
    0.00607779578606158, 0.000810372771474878, 0, 0.000405186385737439, 
    0.00040518638573744), Value = c(0.05, 0.1, 0.15, 0.2, 0.25, 
    0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 
    0.85, 0.9, 0.95, 1)), .Names = c("Prob", "Value"), row.names = c(NA, 
-20L), class = "data.frame"), "5PlusVeh" = structure(list(Prob = c(0.131578947368421, 
0.148421052631579, 0.187368421052632, 0.124210526315789, 0.128421052631579, 
0.0989473684210525, 0.0747368421052632, 0.0378947368421053, 0.0221052631578947, 
0.0210526315789474, 0.0105263157894737, 0.00210526315789474, 
0.00842105263157896, 0.00105263157894737, 0.00315789473684211, 
0, 0, 0, 0, 0), Value = c(0.05, 0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 
0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 
1)), .Names = c("Prob", "Value"), row.names = c(NA, -20L), class = "data.frame")), .Names = c("1Veh", 
"2Veh", "3Veh", "4Veh", "5PlusVeh"))




GreenSTEP_$PhevMilePropModel_ <- structure(list(Metro = structure(c("0.390063181486041 * Intercept + -0.0272911450763258 * LogIncome + 1.97124433315617e-06 * Htppopdn + 0.0275562023224662 * Hhvehcnt + 0.00018456559943105 * Tranmilescap + -0.0181762238290337 * DrvAgePop + 0.0226966938583728 * Age65Plus + 0.0150068477315338 * Urban", 
"0.66388122908653 * Intercept + -0.0434868228964424 * LogIncome + 3.13687709825703e-06 * Htppopdn + 0.0375455866440518 * Hhvehcnt + 0.000290317086689819 * Tranmilescap + -0.029401650347752 * DrvAgePop + 0.0362113549468232 * Age65Plus + 0.0240791561059939 * Urban", 
"0.859094471936257 * Intercept + -0.0529560397125791 * LogIncome + 3.82148985957379e-06 * Htppopdn + 0.0405751838742667 * Hhvehcnt + 0.000346288626609331 * Tranmilescap + -0.0368446578244063 * DrvAgePop + 0.0445635229064999 * Age65Plus + 0.0295530494696131 * Urban", 
"0.99814345350686 * Intercept + -0.0580799915946009 * LogIncome + 4.19906144111441e-06 * Htppopdn + 0.0405266259432163 * Hhvehcnt + 0.000374562586980932 * Tranmilescap + -0.0416603695113725 * DrvAgePop + 0.0494156722828185 * Age65Plus + 0.0326240020849322 * Urban", 
"1.09595773762673 * Intercept + -0.0602714459125582 * LogIncome + 4.36712367949912e-06 * Htppopdn + 0.0390109677658901 * Hhvehcnt + 0.000384275809588906 * Tranmilescap + -0.0445718873459917 * DrvAgePop + 0.0518413758320016 * Age65Plus + 0.0341003269457212 * Urban", 
"1.16389362794351 * Intercept + -0.0605152053438638 * LogIncome + 4.39248682435942e-06 * Htppopdn + 0.0367884568733656 * Hhvehcnt + 0.000381264159936269 * Tranmilescap + -0.0461134265716861 * DrvAgePop + 0.0525756077620909 * Age65Plus + 0.0344785744395224 * Urban", 
"1.21034524620326 * Intercept + -0.0595091970122218 * LogIncome + 4.32511899611597e-06 * Htppopdn + 0.034265747771352 * Hhvehcnt + 0.000370904340847475 * Tranmilescap + -0.0466650701535395 * DrvAgePop + 0.0521866270494135 * Age65Plus + 0.0340892981982023 * Urban", 
"1.24112121652646 * Intercept + -0.057710803681495 * LogIncome + 4.19686092206519e-06 * Htppopdn + 0.0316480594609356 * Hhvehcnt + 0.000356561222180551 * Tranmilescap + -0.0464628048369391 * DrvAgePop + 0.0510283560438478 * Age65Plus + 0.0331966703171579 * Urban", 
"1.26012023316445 * Intercept + -0.0553983331826238 * LogIncome + 4.03100010962085e-06 * Htppopdn + 0.0290614543055959 * Hhvehcnt + 0.000339438453083526 * Tranmilescap + -0.045716117966352 * DrvAgePop + 0.0493517231781958 * Age65Plus + 0.031998146380065 * Urban", 
"1.27041418221368 * Intercept + -0.0527847175544837 * LogIncome + 3.84397745662167e-06 * Htppopdn + 0.0265830897438155 * Hhvehcnt + 0.000321443529041737 * Tranmilescap + -0.0445825027907227 * DrvAgePop + 0.0473432444915131 * Age65Plus + 0.0305905422079086 * Urban", 
"1.27436044003942 * Intercept + -0.0500201852983351 * LogIncome + 3.64493946330764e-06 * Htppopdn + 0.0242393323635671 * Hhvehcnt + 0.000303253689542827 * Tranmilescap + -0.0431769952316359 * DrvAgePop + 0.0451513360783112 * Age65Plus + 0.0290604687815914 * Urban", 
"1.27348606339059 * Intercept + -0.0471891179504779 * LogIncome + 3.44013640357902e-06 * Htppopdn + 0.0220634108639415 * Hhvehcnt + 0.000285286598177522 * Tranmilescap + -0.0416029585685419 * DrvAgePop + 0.0428604720867076 * Age65Plus + 0.0274992531882947 * Urban", 
"1.26880226377623 * Intercept + -0.0443370240837755 * LogIncome + 3.23633220971467e-06 * Htppopdn + 0.0200527369225211 * Hhvehcnt + 0.000268120496530091 * Tranmilescap + -0.0399248481879838 * DrvAgePop + 0.0405574010457803 * Age65Plus + 0.0259373493386344 * Urban", 
"1.26168319116767 * Intercept + -0.0415484341510096 * LogIncome + 3.03696415992286e-06 * Htppopdn + 0.0182013117603493 * Hhvehcnt + 0.000251310203419689 * Tranmilescap + -0.0381739888154506 * DrvAgePop + 0.0382661511221822 * Age65Plus + 0.0244179286661377 * Urban", 
"1.25292313490321 * Intercept + -0.0388591858521626 * LogIncome + 2.84360387116129e-06 * Htppopdn + 0.0165110731387427 * Hhvehcnt + 0.000235008825026096 * Tranmilescap + -0.0363923740999608 * DrvAgePop + 0.0360196033451831 * Age65Plus + 0.0229384757566184 * Urban", 
"1.24324742543686 * Intercept + -0.0363064473117001 * LogIncome + 2.65847315564131e-06 * Htppopdn + 0.0149714245586786 * Hhvehcnt + 0.000220113912962308 * Tranmilescap + -0.0346083158678293 * DrvAgePop + 0.0338384061082135 * Age65Plus + 0.0215051036321611 * Urban", 
"1.23277724837082 * Intercept + -0.0338703808879272 * LogIncome + 2.4846353074756e-06 * Htppopdn + 0.0135704404934725 * Hhvehcnt + 0.000205990125313777 * Tranmilescap + -0.0328584230340134 * DrvAgePop + 0.0317440429355028 * Age65Plus + 0.0201205881685557 * Urban", 
"1.22202500550358 * Intercept + -0.03157294738481 * LogIncome + 2.32044180177378e-06 * Htppopdn + 0.0122961111301898 * Hhvehcnt + 0.000192518398526646 * Tranmilescap + -0.0311563388660655 * DrvAgePop + 0.0297350163989866 * Age65Plus + 0.0187859430595999 * Urban", 
"1.21114415134275 * Intercept + -0.0294100659612745 * LogIncome + 2.1653240041751e-06 * Htppopdn + 0.0111338651548042 * Hhvehcnt + 0.00017978382709698 * Tranmilescap + -0.029501551107797 * DrvAgePop + 0.0278221312606151 * Age65Plus + 0.0175218126630495 * Urban", 
"1.20032745395869 * Intercept + -0.0273805569056893 * LogIncome + 2.01928871955514e-06 * Htppopdn + 0.0100773623621271 * Hhvehcnt + 0.000167604797491429 * Tranmilescap + -0.027904890829727 * DrvAgePop + 0.0260112330452454 * Age65Plus + 0.0163379636833397 * Urban", 
"1.18968395407374 * Intercept + -0.0254803931973851 * LogIncome + 1.88163211911814e-06 * Htppopdn + 0.00911945743594172 * Hhvehcnt + 0.000156318398542033 * Tranmilescap + -0.0263728387065868 * DrvAgePop + 0.024307426111087 * Age65Plus + 0.0152308859288796 * Urban", 
"1.17932915240242 * Intercept + -0.0237076301127627 * LogIncome + 1.75204604248927e-06 * Htppopdn + 0.00825018246630439 * Hhvehcnt + 0.000146175406818929 * Tranmilescap + -0.0249061420513473 * DrvAgePop + 0.0227043881838175 * Age65Plus + 0.0142055010567026 * Urban", 
"1.16931035712639 * Intercept + -0.0220526763468845 * LogIncome + 1.63099242655767e-06 * Htppopdn + 0.00746493937561765 * Hhvehcnt + 0.000136672289041519 * Tranmilescap + -0.0235153375523755 * DrvAgePop + 0.0212013157702396 * Age65Plus + 0.0132329457358442 * Urban", 
"1.15964091257417 * Intercept + -0.0205076448606428 * LogIncome + 1.51820087161629e-06 * Htppopdn + 0.00675716018086025 * Hhvehcnt + 0.000127531501408441 * Tranmilescap + -0.0221965018074283 * DrvAgePop + 0.0197928229801452 * Age65Plus + 0.0123245108292063 * Urban", 
"1.15037679295309 * Intercept + -0.0190688504555475 * LogIncome + 1.41361478854937e-06 * Htppopdn + 0.00611665474405799 * Hhvehcnt + 0.000118832141389209 * Tranmilescap + -0.0209450135632845 * DrvAgePop + 0.0184758881821953 * Age65Plus + 0.0114774735399153 * Urban", 
"1.14145158833176 * Intercept + -0.017722021875995 * LogIncome + 1.31630727178039e-06 * Htppopdn + 0.00553792849712829 * Hhvehcnt + 0.0001107411011022 * Tranmilescap + -0.0197635841483784 * DrvAgePop + 0.0172489023727414 * Age65Plus + 0.0106920474261861 * Urban", 
"1.13298470656552 * Intercept + -0.0164716166527621 * LogIncome + 1.2254235555954e-06 * Htppopdn + 0.00501125143615278 * Hhvehcnt + 0.000103107817194894 * Tranmilescap + -0.0186424543862895 * DrvAgePop + 0.016097146800862 * Age65Plus + 0.00997038020938962 * Urban", 
"1.12494940789956 * Intercept + -0.0153097516330734 * LogIncome + 1.14100902956846e-06 * Htppopdn + 0.00453312152585083 * Hhvehcnt + 9.58224598534364e-05 * Tranmilescap + -0.0175796629906988 * DrvAgePop + 0.0150243501903727 * Age65Plus + 0.0093013790449212 * Urban", 
"1.11731542790353 * Intercept + -0.0142274508330531 * LogIncome + 1.06189358954358e-06 * Htppopdn + 0.0041009969626964 * Hhvehcnt + 8.8750920294726e-05 * Tranmilescap + -0.0165769952191149 * DrvAgePop + 0.0140292051225835 * Age65Plus + 0.00868893609316966 * Urban", 
"1.11009089282754 * Intercept + -0.0132217707238886 * LogIncome + 9.88884947284683e-07 * Htppopdn + 0.00370995335699998 * Hhvehcnt + 8.21652804255871e-05 * Tranmilescap + -0.0156313385288562 * DrvAgePop + 0.0131015976477731 * Age65Plus + 0.00811285497801394 * Urban"
), .Names = c("PropLE5", "PropLE10", "PropLE15", "PropLE20", 
"PropLE25", "PropLE30", "PropLE35", "PropLE40", "PropLE45", "PropLE50", 
"PropLE55", "PropLE60", "PropLE65", "PropLE70", "PropLE75", "PropLE80", 
"PropLE85", "PropLE90", "PropLE95", "PropLE100", "PropLE105", 
"PropLE110", "PropLE115", "PropLE120", "PropLE125", "PropLE130", 
"PropLE135", "PropLE140", "PropLE145", "PropLE150")), NonMetro = structure(c("0.326152698244207 * Intercept + -0.0209682046571831 * LogIncome + 4.29239151647109e-06 * Htppopdn + 0.025812040558214 * Hhvehcnt + -0.0186001947492112 * DrvAgePop + 0.0184262619260516 * Age65Plus", 
"0.547138572196245 * Intercept + -0.0327079955334398 * LogIncome + 6.48689099996445e-06 * Htppopdn + 0.0351959006595146 * Hhvehcnt + -0.0290907235338213 * DrvAgePop + 0.0284714479026878 * Age65Plus", 
"0.707118581312879 * Intercept + -0.0397414983609202 * LogIncome + 7.7176335007218e-06 * Htppopdn + 0.0387579917321945 * Hhvehcnt + -0.0358046652223848 * DrvAgePop + 0.0345904001362965 * Age65Plus", 
"0.825839119622172 * Intercept + -0.0438978965147822 * LogIncome + 8.38589067684818e-06 * Htppopdn + 0.0396988032855804 * Hhvehcnt + -0.0401524748147776 * DrvAgePop + 0.0382856457292479 * Age65Plus", 
"0.914784586356363 * Intercept + -0.0461405835563559 * LogIncome + 8.70474424150759e-06 * Htppopdn + 0.0393052029861062 * Hhvehcnt + -0.0428858040015211 * DrvAgePop + 0.0403941673886553 * Age65Plus", 
"0.982184121985709 * Intercept + -0.0471223894836227 * LogIncome + 8.80328164969613e-06 * Htppopdn + 0.0382195631535146 * Hhvehcnt + -0.0444864512360455 * DrvAgePop + 0.0413973190945841 * Age65Plus", 
"1.03341235610162 * Intercept + -0.0472320896275198 * LogIncome + 8.75247204160435e-06 * Htppopdn + 0.0367493056287633 * Hhvehcnt + -0.045276305704393 * DrvAgePop + 0.0416458487728673 * Age65Plus", 
"1.072411557584 * Intercept + -0.0467461695970973 * LogIncome + 8.60051788465337e-06 * Htppopdn + 0.0350818959335245 * Hhvehcnt + -0.0454730768644656 * DrvAgePop + 0.0413613120246724 * Age65Plus", 
"1.1019425053558 * Intercept + -0.0458470186064906 * LogIncome + 8.38323727197598e-06 * Htppopdn + 0.0333295620267142 * Hhvehcnt + -0.0452270689083564 * DrvAgePop + 0.0407008924966838 * Age65Plus", 
"1.12415056362654 * Intercept + -0.0446691530982126 * LogIncome + 8.12080246785769e-06 * Htppopdn + 0.0315591556914757 * Hhvehcnt + -0.0446584333897954 * DrvAgePop + 0.0397757763383126 * Age65Plus", 
"1.14069425692144 * Intercept + -0.0433154406225899 * LogIncome + 7.83236754733304e-06 * Htppopdn + 0.0298183294524854 * Hhvehcnt + -0.0438507199519848 * DrvAgePop + 0.0386772048413272 * Age65Plus", 
"1.15268355519894 * Intercept + -0.0418440797767803 * LogIncome + 7.53257540278515e-06 * Htppopdn + 0.0281317159716504 * Hhvehcnt + -0.0428705998244542 * DrvAgePop + 0.0374631842301465 * Age65Plus", 
"1.16105360561615 * Intercept + -0.0403002444531061 * LogIncome + 7.2263011422168e-06 * Htppopdn + 0.0265097129363202 * Hhvehcnt + -0.0417756681296079 * DrvAgePop + 0.036174703433931 * Age65Plus", 
"1.16666319444326 * Intercept + -0.0387334620604446 * LogIncome + 6.91879962742231e-06 * Htppopdn + 0.0249695238968356 * Hhvehcnt + -0.040600580147607 * DrvAgePop + 0.034841600277006 * Age65Plus", 
"1.17002814302186 * Intercept + -0.0371631811241065 * LogIncome + 6.61526456947462e-06 * Htppopdn + 0.0235132748315217 * Hhvehcnt + -0.0393782175028432 * DrvAgePop + 0.0334942201489911 * Age65Plus", 
"1.1715383283229 * Intercept + -0.0356013420959863 * LogIncome + 6.31729216978232e-06 * Htppopdn + 0.0221348954100974 * Hhvehcnt + -0.038125258208109 * DrvAgePop + 0.0321564350092671 * Age65Plus", 
"1.17152899458098 * Intercept + -0.0340581538842785 * LogIncome + 6.02723951841198e-06 * Htppopdn + 0.020836121108686 * Hhvehcnt + -0.0368622648304007 * DrvAgePop + 0.0308390089334306 * Age65Plus", 
"1.17036230069286 * Intercept + -0.0325489328137012 * LogIncome + 5.7477798955702e-06 * Htppopdn + 0.0196114061975979 * Hhvehcnt + -0.0356011286787337 * DrvAgePop + 0.0295505750765098 * Age65Plus", 
"1.16834864367122 * Intercept + -0.0310876259543089 * LogIncome + 5.48005263624149e-06 * Htppopdn + 0.0184566454350776 * Hhvehcnt + -0.0343481896023773 * DrvAgePop + 0.0282958791889669 * Age65Plus", 
"1.16567512576142 * Intercept + -0.0296784621607057 * LogIncome + 5.22319166070364e-06 * Htppopdn + 0.0173725870399846 * Hhvehcnt + -0.033112006280347 * DrvAgePop + 0.0270750708507229 * Age65Plus", 
"1.16249580617694 * Intercept + -0.0283236016795018 * LogIncome + 4.9784212636411e-06 * Htppopdn + 0.0163539542205095 * Hhvehcnt + -0.0319004440644225 * DrvAgePop + 0.0258949670690074 * Age65Plus", 
"1.15894519268638 * Intercept + -0.0270267755261014 * LogIncome + 4.74560387100242e-06 * Htppopdn + 0.0153965176480348 * Hhvehcnt + -0.030709844722174 * DrvAgePop + 0.0247598634155093 * Age65Plus", 
"1.15514804494918 * Intercept + -0.0257893128064199 * LogIncome + 4.52292031944867e-06 * Htppopdn + 0.0145001336393763 * Hhvehcnt + -0.0295491907222143 * DrvAgePop + 0.0236654636226894 * Age65Plus", 
"1.15107053565728 * Intercept + -0.0245997418249261 * LogIncome + 4.31000159452972e-06 * Htppopdn + 0.0136590226489701 * Hhvehcnt + -0.0284226703089901 * DrvAgePop + 0.0226209684778687 * Age65Plus", 
"1.14687239578227 * Intercept + -0.0234667343584284 * LogIncome + 4.10756279678247e-06 * Htppopdn + 0.0128700306202217 * Hhvehcnt + -0.0273264817385209 * DrvAgePop + 0.0216225938598523 * Age65Plus", 
"1.14258457957716 * Intercept + -0.0223853962941352 * LogIncome + 3.91448296137229e-06 * Htppopdn + 0.0121307766133243 * Hhvehcnt + -0.0262670812147768 * DrvAgePop + 0.0206655419923362 * Age65Plus", 
"1.13823210697416 * Intercept + -0.0213527311213644 * LogIncome + 3.73048132521776e-06 * Htppopdn + 0.0114385293237061 * Hhvehcnt + -0.0252445300070359 * DrvAgePop + 0.0197521745606588 * Age65Plus", 
"1.13386309701426 * Intercept + -0.0203677135916248 * LogIncome + 3.55599623105125e-06 * Htppopdn + 0.0107889804225101 * Hhvehcnt + -0.0242601492291369 * DrvAgePop + 0.0188793987516276 * Age65Plus", 
"1.12954482237073 * Intercept + -0.0194326745238413 * LogIncome + 3.3902196808067e-06 * Htppopdn + 0.0101791746927149 * Hhvehcnt + -0.0233109823564983 * DrvAgePop + 0.018046326924661 * Age65Plus", 
"1.12526280005625 * Intercept + -0.0185418653019124 * LogIncome + 3.23270406614418e-06 * Htppopdn + 0.00960778289875828 * Hhvehcnt + -0.0223995210447667 * DrvAgePop + 0.0172547161013344 * Age65Plus"
), .Names = c("PropLE5", "PropLE10", "PropLE15", "PropLE20", 
"PropLE25", "PropLE30", "PropLE35", "PropLE40", "PropLE45", "PropLE50", 
"PropLE55", "PropLE60", "PropLE65", "PropLE70", "PropLE75", "PropLE80", 
"PropLE85", "PropLE90", "PropLE95", "PropLE100", "PropLE105", 
"PropLE110", "PropLE115", "PropLE120", "PropLE125", "PropLE130", 
"PropLE135", "PropLE140", "PropLE145", "PropLE150"))), .Names = c("Metro", 
"NonMetro"))


GreenSTEP_$predictLtTruckOwn <- function (Data.., Model_, TruckProp = NA) 
{
    OwnModel <- Model_$OwnModel
    Data..$LogDen <- log(Data..$Htppopdn)
    TargetTruckProp <- TruckProp
    LtTruckFactorLo <- -100
    LtTruckFactorMd <- 0
    LtTruckFactorHi <- 100
    Itr <- 0
    Intercept <- 1
    notConverged <- function(TruckProp, EstTruckProp) {
        Diff <- abs(TruckProp - EstTruckProp)
        Diff > 1e-04
    }
    calcVehProbs <- function(Factor) {
        LtTruckResults. <- Factor + eval(parse(text = OwnModel), 
            envir = Data..)
        LtTruckOdds. <- exp(LtTruckResults.)
        LtTruckOdds./(1 + LtTruckOdds.)
    }
    LtTruckProbsMd. <- calcVehProbs(LtTruckFactorMd)
    EstTruckProp <- sum(Data..$Hhvehcnt * LtTruckProbsMd.)/sum(Data..$Hhvehcnt)
    if (!is.na(TruckProp)) {
        while (notConverged(TruckProp, EstTruckProp)) {
            LtTruckProbsLo. <- calcVehProbs(LtTruckFactorLo)
            LtTruckProbsMd. <- calcVehProbs(LtTruckFactorMd)
            LtTruckProbsHi. <- calcVehProbs(LtTruckFactorHi)
            EstTruckPropLo <- sum(Data..$Hhvehcnt * LtTruckProbsLo.)/sum(Data..$Hhvehcnt)
            EstTruckPropMd <- sum(Data..$Hhvehcnt * LtTruckProbsMd.)/sum(Data..$Hhvehcnt)
            EstTruckPropHi <- sum(Data..$Hhvehcnt * LtTruckProbsHi.)/sum(Data..$Hhvehcnt)
            if (TruckProp < EstTruckPropMd) {
                LtTruckFactorHi <- LtTruckFactorMd
                LtTruckFactorMd <- mean(c(LtTruckFactorHi, LtTruckFactorLo))
            }
            if (TruckProp > EstTruckPropMd) {
                LtTruckFactorLo <- LtTruckFactorMd
                LtTruckFactorMd <- mean(c(LtTruckFactorLo, LtTruckFactorHi))
            }
            EstTruckProp <- EstTruckPropMd
            rm(EstTruckPropLo, EstTruckPropMd, EstTruckPropHi)
            if (Itr > 100) 
                break
            Itr <- Itr + 1
        }
    }
    VehType_ <- apply(cbind(Data..$Hhvehcnt, LtTruckProbsMd.), 
        1, function(x) {
            NumVeh <- x[1]
            Prob <- x[2]
            sample(c("LtTruck", "Auto"), NumVeh, replace = TRUE, 
                prob = c(Prob, 1 - Prob))
        })
    VehType_
}


GreenSTEP_$predictPropDvmt <- function (Data.., Model_, Type) 
{
    if (!(Type %in% c("Metro", "NonMetro"))) {
        stop("Type must be either 'Metro' or 'NonMetro'")
    }
    ZeroDvmtModel <- Model_[[Type]]$ZeroDvmtModel
    DvmtModel <- Model_[[Type]]$DvmtModel
    Error <- Model_[[Type]]$Error
    Pow <- Model_[[Type]]$Pow
    Data..$Hhincttl[Data..$Hhincttl <= 0] <- 1
    Data..$LogIncome <- log(Data..$Hhincttl)
    Hhvehcnt. <- Data..$Hhvehcnt
    Intercept <- 1
    PowDvmt. <- as.vector(eval(parse(text = DvmtModel), envir = Data..))
    ZeroDvmtOdds. <- as.vector(exp(eval(parse(text = ZeroDvmtModel), 
        envir = Data..)))
    ZeroDvmtProbs. <- ZeroDvmtOdds./(1 + ZeroDvmtOdds.)
    calcDvmt <- function(PowDvmt, ZeroDvmtProb, Hhvehcnt, N) {
        PowDvmt. <- rnorm(N, PowDvmt, sd = Error)
        PowDvmt.[PowDvmt. < 0] <- 0
        Dvmt. <- PowDvmt.^(1/Pow)
        Dvmt. <- trunc(Dvmt.)
        ZeroDvmt. <- sample(c(0, 1), N, replace = TRUE, prob = c(ZeroDvmtProb, 
            1 - ZeroDvmtProb))
        Dvmt. <- Dvmt. * ZeroDvmt.
        VehProp_ <- list()
        for (i in 1:N) {
            VehProp_[[i]] <- apportionDvmt(Hhvehcnt)
        }
        VehDvmt_ <- mapply("*", Dvmt., VehProp_)
        Dvmt. <- unlist(VehDvmt_)
        rm(VehProp_, VehDvmt_)
        Th <- seq(5, 150, 5)
        Props. <- numeric(length(Th))
        names(Props.) <- paste("PropLE", Th, sep = "")
        for (th in Th) {
            Name <- paste("PropLE", th, sep = "")
            NumDaysGTRange <- sum(Dvmt. > th)
            InRangeDvmt <- sum(Dvmt.[Dvmt. <= th]) + NumDaysGTRange * 
                th
            Props.[Name] <- InRangeDvmt/sum(Dvmt.)
        }
        Props.
    }
    mapply(calcDvmt, PowDvmt., ZeroDvmtProbs., Hhvehcnt., 400)
}


GreenSTEP_$calcWalkTrips <- function (Data.., WalkModel_) 
{
    DidWalkOdds. <- as.vector(exp(eval(parse(text = WalkModel_$DidWalkModel), 
        envir = Data..)))
    DidWalkProbs. <- DidWalkOdds./(1 + DidWalkOdds.)
    NumWalk. <- as.vector(eval(parse(text = WalkModel_$WalkTripModel), 
        envir = Data..))
    NumWalk.[NumWalk. < 0] <- 0
    DidWalkProbs. * NumWalk.
}


GreenSTEP_$WalkModel_ <- structure(list(DidWalkModel = "-1.21066766871103 + 0.130845643916829 * Age0to14 + -0.463154736448479 * VehPerDrvAgePop + 0.281019577975873 * Age20to29 + -0.198000902229723 * Age65Plus + 4.23105883989303e-05 * Htppopdn + 0.205175883756414 * Urban + 5.83091447069155e-06 * Hhincttl + 0.0677194330520021 * Age0to14 * VehPerDrvAgePop + -0.287988201982759 * VehPerDrvAgePop * Age20to29 + 0.0868220110118606 * VehPerDrvAgePop * Age65Plus", 
    WalkTripModel = "1.70185498861348 + 0.573329906382655 * Hhsize + -0.173226028440749 * Age65Plus + -0.268332019039829 * VehPerDrvAgePop + 5.29303333505953e-05 * Htppopdn + 0.167602453780896 * Urban + -1.91552487327468e-06 * Hhincttl + -0.424486950597434 * Age15to19 * VehPerDrvAgePop"), .Names = c("DidWalkModel", 
"WalkTripModel"))



